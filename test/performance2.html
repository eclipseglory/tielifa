<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Performance Test</title>
    <script src="test.js"></script>
</head>
<body>
<div>Use chrome "Performance" , open the "Rendering" tab , check the "FPS mete" option to see the FPS</div>
</body>
<script type="module">
    import CanvasRenderingContextWebgl2D from "../src/webgl/CanvasRenderingContextWebgl2D.js";

    createOneFullCanvas();
    let ctx = new CanvasRenderingContextWebgl2D(webgl, {projectionType: 1});
    // let ctx = webgl.getContext('2d');
    let rotation = 0;
    let graphicsArray = [];

    function draw(ctx) {
        let row = 30;
        let column = 10;
        let w = ctx.canvas.width / row;
        let h = ctx.canvas.height / column;
        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
        for (let i = 0; i < row; i++) {
            for (let j = 0; j < column; j++) {
                ctx.save();
                ctx.translate(i * w, j * h);

                ctx.translate(w / 2, h / 2);
                if (i % 2 == 0) {
                    ctx.rotate(rotation);

                }
                if (i % 3 == 0) {
                    ctx.rotate(rotation / 2);
                }
                // if (ctx.rotateX && ctx.rotateY) {
                //     ctx.rotateX(rotation / 2);
                //     ctx.rotateY(rotation);
                // }
                let graphics = graphicsArray[i * column + j];
                ctx.translate(-w / 2, -h / 2);
                ctx.applyCurrentTransformForVDO(graphics.originalVDO,graphics.vdo);
                ctx.drawGraphics(graphics);
                // ctx.drawImage(img, i * w, j * h, w, h);
                ctx.restore();
            }
        }
        if (ctx.update) {
            ctx.update();
        }
    }

    function test() {
        draw(ctx);
        rotation = rotation + Math.PI / 180;
        requestAnimationFrame(test);
    }

    function defineGraphics() {
        let row = 30;
        let column = 30;
        let w = ctx.canvas.width / row;
        let h = ctx.canvas.height / column;

        for (let i = 0; i < row; i++)
            for (let j = 0; j < column; j++) {
                ctx.startGraphics();
                ctx.drawImage(img, 0, 0, w, h);
                let graphics = ctx.endGraphics();
                let vdo = ctx.copyGraphicsVDO(graphics);
                graphics.originalVDO = vdo;
                graphicsArray.push(graphics);
            }
    }

    let img = new Image();
    img.onload = function (evt) {
        defineGraphics();
        test();
    };
    img.src = "images/heart1.png";

</script>
</html>