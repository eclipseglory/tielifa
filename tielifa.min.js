!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.WebGL2D=e():(t.tielifa=t.tielifa||{},t.tielifa.WebGL2D=e())}(window,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=3)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();var a=2*Math.PI,i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.instance=null}return n(t,null,[{key:"equals",value:function(t,e){return Math.abs(t-e)<=1e-5}},{key:"getDistance",value:function(t,e){var r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)}},{key:"clamp",value:function(t,e,r){return t>r?r:t<e?e:t}},{key:"getInsance",value:function(){return null==this.instance&&(this.instance=new t),this.instance}},{key:"overlaps",value:function(t,e){var r=t,n=e;return r.left<=n.right&&r.right>=n.left&&r.bottom>=n.top&&r.top<=n.bottom}},{key:"isHit",value:function(e,r){var n=!1,a=e.left,i=e.top;return t.isInTheRect(a,i,r)&&(n=!0),a=e.left,i=e.top+e.height,t.isInTheRect(a,i,r)&&(n=!0),a=e.left+e.width,i=e.top,t.isInTheRect(a,i,r)&&(n=!0),a=e.left+e.width,i=e.top+e.height,t.isInTheRect(a,i,r)&&(n=!0),n||(a=r.left,i=r.top,t.isInTheRect(a,i,e)&&(n=!0),a=r.left,i=r.top+r.height,t.isInTheRect(a,i,e)&&(n=!0),a=r.left+r.width,i=r.top,t.isInTheRect(a,i,e)&&(n=!0),a=r.left+r.width,i=r.top+r.height,t.isInTheRect(a,i,e)&&(n=!0)),n}},{key:"isInTheRect",value:function(t,e,r){var n=r.left,a=r.top,i=r.width,u=r.height;return t>n&&t<n+i&&e>a&&e<a+u}},{key:"PI2",get:function(){return a}},{key:"EPSILON",get:function(){return 1e-5}}]),t}();e.default=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,a=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(0),u=(n=i)&&n.__esModule?n:{default:n};var o=void 0,s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return a(t,null,[{key:"perspective",value:function(t,e,r,n){var a=Math.tan(.5*Math.PI-.5*t),i=1/(r-n),u=this.identity();return u[0]=a/e,u[5]=a,u[10]=(r+n)*i,u[11]=-1,u[14]=r*n*i*2,[a/e,0,0,0,0,a,0,0,0,0,(r+n)*i,-1,0,0,r*n*i*2,0]}},{key:"orthoProjection",value:function(t,e,r,n,a,i){return new Float32Array([2/(r-t),0,0,0,0,2/(e-n),0,0,0,0,2/(a-i),0,(t+r)/(t-r),(n+e)/(n-e),(a+i)/(a-i),1])}},{key:"copy",value:function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}},{key:"equals",value:function(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],o=t[4],s=t[5],l=t[6],f=t[7],h=t[8],c=t[9],d=t[10],v=t[11],y=t[12],x=t[13],g=t[14],b=t[15],m=e[0],p=e[1],k=e[2],M=e[3],T=e[4],I=e[5],w=e[6],P=e[7],A=e[8],_=e[9],E=e[10],S=e[11],D=e[12],L=e[13],R=e[14],C=e[15];return Math.abs(r-m)<=u.default.EPSILON*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(n-p)<=u.default.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-k)<=u.default.EPSILON*Math.max(1,Math.abs(a),Math.abs(k))&&Math.abs(i-M)<=u.default.EPSILON*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(o-T)<=u.default.EPSILON*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(s-I)<=u.default.EPSILON*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(l-w)<=u.default.EPSILON*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(f-P)<=u.default.EPSILON.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(h-A)<=u.default.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(c-_)<=u.default.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(d-E)<=u.default.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(v-S)<=u.default.EPSILON*Math.max(1,Math.abs(v),Math.abs(S))&&Math.abs(y-D)<=u.default.EPSILON*Math.max(1,Math.abs(y),Math.abs(D))&&Math.abs(x-L)<=u.default.EPSILON*Math.max(1,Math.abs(x),Math.abs(L))&&Math.abs(g-R)<=u.default.EPSILON*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(b-C)<=u.default.EPSILON*Math.max(1,Math.abs(b),Math.abs(C))}},{key:"exactEquals",value:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}},{key:"projection",value:function(t,e,r){var n=this.identity();return n[0]=2/t,n[5]=-2/e,n[10]=2/r,n[12]=-1,n[13]=1,n[15]=1,n}},{key:"identity",value:function(){var t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}},{key:"identityMatrix",value:function(t){var e=t;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}},{key:"translationMatrix",value:function(t,e,r,n){var a=t;a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=e,a[13]=r,a[14]=n,a[15]=1}},{key:"translation",value:function(t,e,r){var n=this.identity();return n[12]=t,n[13]=e,n[14]=r,n}},{key:"rotationZMatrix",value:function(t,e){var r=t;r[2]=0,r[3]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1;var n=Math.cos(e),a=Math.sin(e);r[0]=n,r[1]=a,r[4]=-a,r[5]=n}},{key:"rotationZ",value:function(t){var e=Math.cos(t),r=Math.sin(t),n=this.identity();return n[0]=e,n[1]=r,n[4]=-r,n[5]=e,n}},{key:"rotationXMatrix",value:function(t,e){var r=t;r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[7]=0,r[8]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1;var n=Math.cos(e),a=Math.sin(e);r[5]=n,r[6]=a,r[9]=-a,r[10]=n}},{key:"rotationX",value:function(t){var e=Math.cos(t),r=Math.sin(t),n=this.identity();return n[5]=e,n[6]=r,n[9]=-r,n[10]=e,n}},{key:"rotationYMatrix",value:function(t,e){var r=t;r[1]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1;var n=Math.cos(e),a=Math.sin(e);r[0]=n,r[2]=-a,r[8]=a,r[10]=n}},{key:"rotationY",value:function(t){var e=Math.cos(t),r=Math.sin(t),n=this.identity();return n[0]=e,n[2]=-r,n[8]=r,n[10]=e,n}},{key:"scalingMatrix",value:function(t,e,r,n){var a=t;a[0]=e,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=r,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=n,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1}},{key:"scaling",value:function(t,e,r){var n=this.identity();return n[0]=t,n[5]=e,n[10]=r,n}},{key:"multiplyWithVertex",value:function(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],u=t[4],o=t[5],s=t[6],l=t[7],f=t[8],h=t[9],c=t[10],d=t[11],v=t[12],y=t[13],x=t[14],g=t[15],b=e[0],m=e[1],p=e[2],k=e[3];return null==p&&(p=0),null==k&&(k=1),[b*r+m*u+p*f+k*v,b*n+m*o+p*h+k*y,b*a+m*s+p*c+k*x,b*i+m*l+p*d+k*g]}},{key:"multiply",value:function(t,e,r){var n=e[0],a=e[1],i=e[2],u=e[3],o=e[4],s=e[5],l=e[6],f=e[7],h=e[8],c=e[9],d=e[10],v=e[11],y=e[12],x=e[13],g=e[14],b=e[15],m=r[0],p=r[1],k=r[2],M=r[3];return t[0]=m*n+p*o+k*h+M*y,t[1]=m*a+p*s+k*c+M*x,t[2]=m*i+p*l+k*d+M*g,t[3]=m*u+p*f+k*v+M*b,m=r[4],p=r[5],k=r[6],M=r[7],t[4]=m*n+p*o+k*h+M*y,t[5]=m*a+p*s+k*c+M*x,t[6]=m*i+p*l+k*d+M*g,t[7]=m*u+p*f+k*v+M*b,m=r[8],p=r[9],k=r[10],M=r[11],t[8]=m*n+p*o+k*h+M*y,t[9]=m*a+p*s+k*c+M*x,t[10]=m*i+p*l+k*d+M*g,t[11]=m*u+p*f+k*v+M*b,m=r[12],p=r[13],k=r[14],M=r[15],t[12]=m*n+p*o+k*h+M*y,t[13]=m*a+p*s+k*c+M*x,t[14]=m*i+p*l+k*d+M*g,t[15]=m*u+p*f+k*v+M*b,t}},{key:"TEMP_MAT4",get:function(){return null==o&&(o=[t.identity(),t.identity(),t.identity(),t.identity()]),o}},{key:"EPSILON",get:function(){return u.default.EPSILON}}]),t}();e.default=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=u(r(11)),i=u(r(13));function u(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type=e,this.vertexData=null,this.textureIndex=-1}return n(t,[{key:"getVertexData",value:function(t){return null==this.vertexData?this.vertexData=new a.default(this.type,t):this.vertexData.resize(t),this.vertexData}},{key:"collectVertexData",value:function(t,e,r,n){1!=this.type?0!=this.type||this.collectVertexDataForStroke(t,e,r,n):this.collectVertexDataForFill(t,e,r,n)}},{key:"collectVertexDataForStroke",value:function(t,e,r,n){for(var a=0;a<t.length;a++)for(var i=t[a],u=0;u<i.subPathNumber;u++){var o=i.subPathArray[u],s=o.pointsNumber;if(!(s<2)){o.isClosed&&s++;for(var l=this.getVertexData(s),f=0;f<s;f++){var h=f%o.pointsNumber;l.addMatrixIdData(o.getPoint(h).matrixIdData),l.addVertexData(o.getPoint(h).value,e,r,n)}}}}},{key:"collectVertexDataForFill",value:function(t,e,r,n){for(var a=0;a<t.length;a++){var i=t[a];if(0!=i.subPathNumber)for(var u=0;u<i.subPathNumber;u++){var o=i.subPathArray[u];o.pointsNumber<3||this.organizeVertexForFill(o,e,r,n)}}}},{key:"organizeVertexForFill",value:function(t,e,r,n){for(var a=new Array(2*t.pointsNumber),u=0;u<t.pointsNumber;u++){var o=t.getPoint(u),s=2*u;a[s]=o.x,a[s+1]=o.y}for(var l=i.default.earcut(a),f=this.getVertexData(l.length),h=0;h<l.length;h++){var c=l[h];f.addMatrixIdData(t.getPoint(c).matrixIdData),n[0]instanceof Array?f.addVertexData(t.getPoint(c).value,e,r,n[c]):f.addVertexData(t.getPoint(c).value,e,r,n)}}}],[{key:"ACTION_STROKE",get:function(){return 0}},{key:"ACTION_FILL",get:function(){return 1}}]),t}();e.default=o},function(t,e,r){t.exports=r(4)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=d(r(5)),i=d(r(6)),u=d(r(7)),o=d(r(8)),s=d(r(9)),l=d(r(10)),f=d(r(2)),h=d(r(15)),c=d(r(0));function d(t){return t&&t.__esModule?t:{default:t}}var v=Symbol("对应的Canvas"),y=Symbol("状态栈"),x=Symbol("状态数组，记录全部状态"),g=Symbol("路径列表"),b=Symbol("绘制动作List"),m=function(){function t(e,r){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),null!=r&&null!=r||(r=[]),this[v]=e,null==e||null==e)throw new Error("TempCanvas can not be undefined or null");if(this.gl=e.getContext("webgl"),null==this.gl)throw new Error("Current canvas doesnt support WebGL");this[y]=[],this[x]=[],this[g]=[],this[b]=[],this.webglRender=new h.default(this.gl)}return n(t,[{key:"clean",value:function(){this[g].length=0,this.webglRender.clean()}},{key:"clearRect",value:function(t,e,r,n){this.clean()}},{key:"beginPath",value:function(){this.currentPath.clean()}},{key:"closePath",value:function(){var t=this.currentPath;if(0!=t.subPathNumber){var e=t.lastSubPath;e.close();var r=e.getPoint(0),n=new s.default(r);t.addSubPath(n)}}},{key:"lineTo",value:function(t,e,r){null==r&&(r=0);var n=this.currentContextState,a=this.currentPath.lastSubPath,i=new o.default(t,e,r);i.contextStateIndex=n.id,i.transformMatrixIndex=n.transformMatrixId,n.fireDirty(),a.pushPoint(i)}},{key:"moveTo",value:function(t,e,r){null==r&&(r=0);var n=this.currentContextState,a=this.currentPath,i=new o.default(t,e,r);i.contextStateIndex=n.id,i.transformMatrixIndex=n.transformMatrixId,n.fireDirty();var u=new s.default(i);a.addSubPath(u)}},{key:"rect",value:function(t,e,r,n,a){null==a&&(a=0),this.moveTo(t,e,a),this.lineTo(t+r,e,a),this.lineTo(t+r,e+n,a),this.lineTo(t,e+n,a),this.currentPath.lastSubPath.type=s.default.TYPE_RECTANGLE,this.closePath()}},{key:"ellipse",value:function(t,e,r,n,a,i,u,o){if(null==a&&(a=0),r<0||n<0)throw new Error("半径必须不小于0. Radius should not be smaller than zero. BanJing BiXu BuXiaoYu Ling");if(0!=r&&0!=n){null==o&&(o=!1);var l=this.currentPath.lastSubPath;null==l&&(l=new s.default,this.currentPath.addSubPath(l)),((i=g(i))>(u=g(u))&&!o||i<u&&o)&&((i<0||u<0)&&((u-=2*Math.PI)==i||Math.abs(u-i)<=c.default.EPSILON)&&(u-=2*Math.PI),(i>0||u>0)&&((u+=2*Math.PI)==i||Math.abs(u-i)<=c.default.EPSILON)&&(u+=2*Math.PI));var f=Math.max(r,n),h=2*Math.asin(1/f),d=0;o&&(h*=-1);for(var v=i;Math.abs(v)<Math.abs(u);v+=h,d++){var y=b(t,e,r,n,v);this.lineTo(y.x,y.y)}var x=b(t,e,r,n,u);this.lineTo(x.x,x.y)}function g(t){var e=2*Math.PI,r=Math.floor(Math.abs(t/e))+1;return Math.abs(t)>e&&r++,t<0&&!o&&(t+=r*e),t>0&&o&&(t-=r*e),t}function b(t,e,r,n,i){var u=Math.cos(i),o=Math.sin(i),s=o/u,l=Math.sqrt(n*n*r*r/(n*n+r*r*s*s)),f=s*l;if(u*l<0&&(l*=-1),o*f<0&&(f*=-1),l+=t,f+=e,0!=a){var h=(l-t)*Math.cos(a)-(f-e)*Math.sin(a)+t,c=(f-e)*Math.cos(a)+(l-t)*Math.sin(a)+e;l=h,f=c}return{x:l,y:f}}}},{key:"arc",value:function(t,e,r,n,a,i){this.ellipse(t,e,r,r,0,n,a,i)}},{key:"save",value:function(){var t=this.currentContextState.clone();this[y].push(t),this[x].push(t),t.id=this[x].length-1}},{key:"restore",value:function(){0!=this[y].length&&this[y].pop()}},{key:"translate",value:function(t,e,r){this.currentContextState.translate(t,e,r)}},{key:"rotate",value:function(t){this.currentContextState.rotateZ(t)}},{key:"rotateX",value:function(t){this.currentContextState.rotateX(t)}},{key:"rotateY",value:function(t){this.currentContextState.rotateY(t)}},{key:"scale",value:function(t,e,r){this.currentContextState.scale(t,e,r)}},{key:"drawImage",value:function(t,e,r,n,a,i,u,o,s){var l=this.webglRender.textureManager.getTexture(t,this.gl,!0),h=new f.default(f.default.ACTION_FILL);h.textureIndex=l.index;var c=void 0,d=void 0,v=void 0,y=void 0,x=void 0,m=void 0,p=void 0,k=void 0;3==arguments.length&&(c=e,d=r,v=e+t.width,y=r+t.height,x=l.x,p=l.x+l.width,m=l.y,k=l.y+l.height),5==arguments.length&&(c=e,d=r,v=e+n,y=r+a,x=l.x,p=l.x+l.width,m=l.y,k=l.y+l.height),9==arguments.length&&(c=i,d=u,v=i+o,y=u+s,x=l.x+e,p=l.x+e+n,m=l.y+r,k=l.y+r+a),this.beginPath(),this.rect(c,d,v-c,y-d);var M=this.currentContextState.globalAlpha,T=this[g];this[b].push(h);var I=new Array(4);I[0]=[x,m],I[1]=[p,m],I[2]=[p,k],I[3]=[x,k];h.collectVertexData(T,[255,255,255],M,I)}},{key:"fill",value:function(){var t=l.default.getInstance().convertStringToColor(this.currentContextState.fillStyle),e=this.currentContextState.globalAlpha,r=this[g],n=new f.default(f.default.ACTION_FILL);this[b].push(n),n.collectVertexData(r,t,e,[0,0])}},{key:"fillRect",value:function(t,e,r,n){this.beginPath(),this.rect(t,e,r,n),this.fill()}},{key:"stroke",value:function(){var t=l.default.getInstance().convertStringToColor(this.currentContextState.strokeStyle),e=this.currentContextState.globalAlpha,r=this[g],n=new f.default(f.default.ACTION_STROKE);this[b].push(n),n.collectVertexData(r,t,e,[0,0])}},{key:"fillOrStroke",value:function(t,e){null!=t&&(this.fillStyle=t,this.fill()),null!=e&&(this.strokeStyle=e,this.stroke())}},{key:"drawRectangle",value:function(t,e,r,n,a,i){this.beginPath(),this.rect(t,e,r,n),this.closePath(),this.save(),this.fillOrStroke(a,i),this.restore()}},{key:"drawEllipse",value:function(t,e,r,n,a,i,u){this.beginPath(),this.ellipse(t,e,r,n,u,0,c.default.PI2,!1),this.closePath(),this.save(),this.fillOrStroke(a,i),this.restore()}},{key:"drawCircle",value:function(t,e,r,n,a){this.drawEllipse(t,e,r,r,n,a,0)}},{key:"draw",value:function(t,e,r){this.webglRender.initRending(),this.webglRender.executeRenderAction(this[b],this[x]),this[b].length=0}},{key:"currentContextState",get:function(){if(0==this[y].length){var t=new a.default(new i.default);this[y].push(t),this[x].push(t),t.id=this[x].length-1}return this[y][this[y].length-1]}},{key:"currentPath",get:function(){return 0==this[g].length&&this[g].push(new u.default),this[g][this[g].length-1]}},{key:"canvas",get:function(){return this[v]}},{key:"strokeStyle",set:function(t){this.currentContextState.strokeStyle=t},get:function(){return this.currentContextState.strokeStyle}},{key:"fillStyle",set:function(t){this.currentContextState.fillStyle=t},get:function(){return this.currentContextState.fillStyle}},{key:"globalAlpha",set:function(t){this.currentContextState.globalAlpha=t},get:function(){return this.currentContextState.globalAlpha}}]),t}();e.default=m},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=u(r(1)),i=u(r(0));function u(t){return t&&t.__esModule?t:{default:t}}Symbol("变换矩阵");var o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvasDrawingStyle=e,this.matrixIndex=0,this.fillStyle="#000000",this.strokeStyle="#000000",this.globalAlpha=1,this.id=-1,this.matrixArray=[],this.matrixArray.push(a.default.identity()),this.dirty=!1}return n(t,[{key:"fireDirty",value:function(){this.dirty=!0}},{key:"setTransformMatrix",value:function(t){var e=this.transformMatrix.matrix;a.default.copy(t,e)}},{key:"checkDirty",value:function(){if(this.dirty){var t=a.default.identity(),e=this.transformMatrix.matrix;a.default.copy(e,t),this.matrixArray.push(t),this.dirty=!1}}},{key:"applyTransform",value:function(t){this.checkDirty();var e=this.transformMatrix.matrix;a.default.multiply(e,e,t)}},{key:"translate",value:function(t,e,r){if(void 0===r&&(r=0),!(i.default.equals(t,0)&&i.default.equals(e,0)&&i.default.equals(r,0))){var n=a.default.TEMP_MAT4[0];a.default.translationMatrix(n,t,e,r),this.applyTransform(n)}}},{key:"rotateZ",value:function(t){if(!i.default.equals(t,0)){var e=a.default.TEMP_MAT4[0];a.default.rotationZMatrix(e,t),this.applyTransform(e)}}},{key:"rotateX",value:function(t){if(!i.default.equals(t,0)){var e=a.default.TEMP_MAT4[0];a.default.rotationXMatrix(e,t),this.applyTransform(e)}}},{key:"rotateY",value:function(t){if(!i.default.equals(t,0)){var e=a.default.TEMP_MAT4[0];a.default.rotationYMatrix(e,t),this.applyTransform(e)}}},{key:"scale",value:function(t,e,r){if(void 0===r&&(r=1),!(i.default.equals(t,1)&&i.default.equals(e,1)&&i.default.equals(r,1))){var n=a.default.TEMP_MAT4[0];a.default.scalingMatrix(n,t,e,r),this.applyTransform(n)}}},{key:"clone",value:function(){var e=new t(this.canvasDrawingStyle.clone());return e.fillStyle=this.fillStyle,e.strokeStyle=this.strokeStyle,e.globalAlpha=this.globalAlpha,e.matrixIndex=this.matrixIndex,e.setTransformMatrix(this.transformMatrix.matrix),e}},{key:"transformMatrixId",get:function(){return this.matrixArray.length-1}},{key:"transformMatrix",get:function(){var t=this.matrixArray.length-1;return{matrix:this.matrixArray[t],id:t}}}]),t}();e.default=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();var a=Symbol("线宽度,默认1"),i=Symbol('线连接样式，"butt", "round", "square" (默认: "butt")'),u=Symbol('线连接样式，"round", "bevel", "miter" (默认: "miter")'),o=Symbol("默认10"),s=Symbol('文字字体大小等，默认"10px sans-serif"'),l=Symbol('文字对齐,"start", "end", "left", "right", "center" (默认: "start")'),f=Symbol('文字纵向对齐，"top", "hanging", "middle", "alphabetic", "ideographic", "bottom" (默认: "alphabetic")'),h=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this[a]=1,this[i]="butt",this[u]="miter",this[o]=10,this.font="10px sans-serif",this.textAlign="start",this.textBaseline="alphabetic"}return n(t,[{key:"clone",value:function(){var e=new t;return e.textBaseline=this.textBaseline,e.textAlign=this.textAlign,e.font=this.font,e.lineCap=this.lineCap,e.lineJoin=this.lineJoin,e.lineWidth=this.lineWidth,e}},{key:"lineWidth",get:function(){return this[a]},set:function(t){this[a]=t}},{key:"lineCap",get:function(){return this[i]},set:function(t){this[i]=t}},{key:"lineJoin",get:function(){return this[u]},set:function(t){this[u]=t}},{key:"miterLimit",get:function(){return this[o]},set:function(t){this[o]=t}},{key:"font",get:function(){return this[s]},set:function(t){this[s]=t}},{key:"textAlign",get:function(){return this[l]},set:function(t){this[l]=t}},{key:"textBaseline",get:function(){return this[f]},set:function(t){this[f]=t}}]),t}();e.default=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.subPathArray=[]}return n(t,[{key:"addSubPath",value:function(t){this.subPathArray.push(t)}},{key:"clean",value:function(){this.subPathArray=[]}},{key:"subPathNumber",get:function(){return this.subPathArray.length}},{key:"lastSubPath",get:function(){if(0!=this.subPathNumber)return this.subPathArray[this.subPathNumber-1]}}]),t}();e.default=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();var a=Symbol("存放坐标值的Float32数组"),i=Symbol("坐标转换矩阵索引"),u=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this[a]=new Float32Array(3),this[i]=new Uint16Array(2),this[a][0]=e,this[a][1]=r,this[a][2]=n}return n(t,[{key:"matrixIdData",get:function(){return this[i]}},{key:"contextStateIndex",get:function(){return this[i][0]},set:function(t){this[i][0]=t}},{key:"transformMatrixIndex",get:function(){return this[i][1]},set:function(t){this[i][1]=t}},{key:"value",get:function(){return this[a]},set:function(t){this[a][0]=t[0],this[a][1]=t[1],this[a][2]=t[2]}},{key:"x",get:function(){return this[a][0]},set:function(t){this[a][0]=t}},{key:"y",get:function(){return this[a][1]},set:function(t){this[a][1]=t}},{key:"z",get:function(){return this[a][2]},set:function(t){this[a][2]=t}}]),t}();e.default=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();var a=2,i=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pointsArray=[],null!=e&&null!=e&&this.pushPoint(e),this.isClosed=!1,this.type=r||a}return n(t,[{key:"close",value:function(){this.isClosed=!0}},{key:"getPoint",value:function(t){return this.pointsArray[t]}},{key:"clean",value:function(){this.pointsArray=[],this.isClosed=!1}},{key:"pushPoint",value:function(t){this.pointsArray.push(t)}},{key:"popPoint",value:function(){this.pointsArray.pop()}},{key:"pointsNumber",get:function(){return this.pointsArray.length}}],[{key:"TYPE_RECTANGLE",get:function(){return 0}},{key:"TYPE_POLYGON",get:function(){return a}},{key:"TYPE_TRIANGLE",get:function(){return 1}},{key:"TYPE_ELLIPSE",get:function(){return 3}}]),t}();e.default=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();var a={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},i=void 0,u=function(){function t(){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i)return i;for(var e in i=this,this.colorMap={},a){var r=a[e],n=this.convertHEXToVet3(r);this.colorMap[r]=n}}return n(t,[{key:"convertStringToColor",value:function(e){if(e=e.toLowerCase(),t.isHEXString(e)){var r=this.colorMap[e];return null!=r?r:(r=this.convertHEXToVet3(e),this.colorMap[e]=r,r)}return this.convertKeywordToVet3(e)}},{key:"convertKeywordToVet3",value:function(e){var r=t.ColorMap[e];if(r){var n=this.colorMap[r];return null!=n?n:(n=this.convertHEXToVet3(r),this.colorMap[r]=n,n)}return[0,0,0]}},{key:"convertHEXToVet3",value:function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}}],[{key:"getInstance",value:function(){return i||(i=new t),i}},{key:"isHEXString",value:function(t){return!(!t||7!=t.length||0!=t.indexOf("#"))}},{key:"ColorMap",get:function(){return a}}]),t}();e.default=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,a=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(12),u=(n=i)&&n.__esModule?n:{default:n};var o=[{type:u.default.TYPE_FLOAT32,count:3},{type:u.default.TYPE_FLOAT32,count:2},{type:u.default.TYPE_UINT8,count:4},{type:u.default.TYPE_FLOAT32,count:2}],s=32,l=[{type:u.default.TYPE_FLOAT32,count:1}],f=4,h=(u.default.TYPE_UINT16,function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type=e,this.dataBuffer=new u.default(o,r*s),this.matrixIndexBuffer=new u.default(l,r*f),this.matrixIdArray=[]}return a(t,[{key:"resize",value:function(t){this.dataBuffer.addLength(t*s),this.matrixIndexBuffer.addLength(t*f)}},{key:"addVertexData",value:function(t,e,r,n){this.dataBuffer.putVertexData(t,e,r,n)}},{key:"addMatrixIdData",value:function(t){this.matrixIdArray.push(t)}},{key:"getMatrixIdData",value:function(t){return this.matrixIdArray[t]}},{key:"getContextStateIndex",value:function(t){return this.matrixIdArray[t][0]}},{key:"getMatrixIndex",value:function(t){return this.matrixIdArray[t][1]}},{key:"putMatrixId",value:function(t){this.matrixIndexBuffer.put(t)}},{key:"vertexNumber",get:function(){return this.bufferSize/s}},{key:"bufferSize",get:function(){return this.dataBuffer.currentIndex}}],[{key:"VERTEX_BYTE_SIZE",get:function(){return s}},{key:"TYPE_FILL",get:function(){return 0}},{key:"TYPE_STROKE",get:function(){return 1}}]),t}());e.default=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();var a=19200,i=Symbol("当前buffer数据所在的字节索引"),u=Symbol("单个数据块字节大小"),o=Symbol("ArrayBuffer的数据存放结构"),s=Symbol("当前所在结构中的索引"),l=void 0,f=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),void 0===r&&(r=a),this.buffer=new ArrayBuffer(r),this.dv=new DataView(this.buffer),this.byteDv=new Uint8Array(this.buffer),this[o]=e;var n=this;!function(t){if(null==t)return console.warn("DataStructure没有指定，默认单个float32数据进行存放。DataStructure必须是一个数组，其内部结构为 [...{type:type,count:count,byteSize:size},...]"),n[u]=4,void(n[o]=void 0);if(!(t instanceof Array))return console.warn("DataStructure必须是一个数组，其内部结构为 [...{type:type,count:count,byteSize:size},...]"),n[u]=4,void(n[o]=void 0);for(var e=0,r=0,a=0,i=0;i<t.length;i++){var s=t[i];s.byteSize=n.getByteSize(s.type)*s.count,s.startByte=r,a=r+s.byteSize,s.endByte=a-1,e+=s.byteSize,r=a}n[u]=e}(this[o]),this[s]=0,this[i]=0}return n(t,[{key:"flush",value:function(t){if(null!=t)t!=this.buffer.byteLength&&(this.buffer=new ArrayBuffer(t),this.dv=new DataView(this.buffer),this.byteDv=new Uint8Array(this.buffer));else for(var e=0;e<this.buffer.byteLength;e++)this.byteDv[e]=0;this[s]=0,this[i]=0}},{key:"getByteSize",value:function(t){switch(t){case 8:return 8;case 1:case 5:case 2:return 1;case 6:case 3:return 2;case 4:case 7:case 0:return 4}return 0}},{key:"put",value:function(e){if(e instanceof Array)for(var r=0;r<e.length;r++)this.put(e[r]);else if(void 0===this.dataStructure)this.resizeBuffer(4),this.dv.setFloat32(this.currentIndex,e,t.littleEndian),this[i]+=this.singleDataFragmentByteSize;else{var n=this.dataStructure[this[s]],a=this.getByteSize(n.type);this.resizeBuffer(a),this.setValue(n.type,e);var u=this.currentIndex%this.singleDataFragmentByteSize;if(0==u)return void(this[s]=0);u>n.endByte&&this[s]++}}},{key:"get",value:function(e,r){var n=t.littleEndian;switch(r){case 8:return this.dv.getFloat64(e,n);case 1:return this.dv.getUint8(e);case 5:return this.dv.getInt8(e);case 2:return this.dv.getUint8(e);case 6:return this.dv.getInt16(e,n);case 3:return this.dv.getUint16(e,n);case 4:return this.dv.getFloat32(e,n);case 7:return this.dv.getInt32(e,n);case 0:return this.dv.getUint32(e,n)}}},{key:"setValue",value:function(e,r){var n=t.littleEndian,a=this.currentIndex;switch(e){case 8:this.dv.setFloat64(a,r,n),this[i]+=8;break;case 1:this.dv.setUint8(a,r),this[i]+=1;break;case 5:this.dv.setInt8(a,r),this[i]+=1;break;case 2:this.dv.setUint8(a,r),this[i]+=1;break;case 6:this.dv.setInt16(a,r,n),this[i]+=2;break;case 3:this.dv.setUint16(a,r,n),this[i]+=2;break;case 4:this.dv.setFloat32(a,r,n),this[i]+=4;break;case 7:this.dv.setInt32(a,r,n),this[i]+=4;break;case 0:this.dv.setUint32(a,r,n),this[i]+=4}}},{key:"addLength",value:function(t){var e=this.byteDv,r=new Uint8Array(new ArrayBuffer(this.buffer.byteLength+t));r.set(e),this.buffer=r.buffer,this.dv=new DataView(this.buffer),this.byteDv=new Uint8Array(this.buffer)}},{key:"resizeBuffer",value:function(t){void 0===t&&(t=this.singleDataFragmentByteSize),this[i]+t>this.buffer.byteLength&&this.addLength(t)}},{key:"clean",value:function(){this.buffer=new ArrayBuffer(this.buffer.byteLength),this.dv=new DataView(this.buffer),this.byteDv=new Uint8Array(this.buffer),this[i]=0,this[s]=0}},{key:"getVertex",value:function(t){if(t>this.currentIndex||t<0)throw new Error("Index Error");return[this.dv.getFloat32(t),this.dv.getFloat32(t+4),this.dv.getFloat32(t+8)]}},{key:"modifyVertex",value:function(e,r){var n=t.littleEndian;if(r>this.currentIndex||r<0)throw new Error("Index Error");this.dv.setFloat32(r,e[0],n),this.dv.setFloat32(r+4,e[1],n),this.dv.setFloat32(r+8,e[2],n)}},{key:"putVertexData",value:function(e,r,n,a){this.resizeBuffer(this.singleDataFragmentByteSize);var u=t.littleEndian,o=this.currentIndex;this.dv.setFloat32(o,e[0],u),this.dv.setFloat32(o+4,e[1],u),this.dv.setFloat32(o+8,e[2],u),this.dv.setFloat32(o+16,0,u),this.dv.setUint8(o+20,r[0]),this.dv.setUint8(o+21,r[1]),this.dv.setUint8(o+22,r[2]),this.dv.setUint8(o+23,Math.floor(100*n)),this.dv.setFloat32(o+24,a[0],u),this.dv.setFloat32(o+28,a[1],u),this[i]+=this.singleDataFragmentByteSize}},{key:"dataStructure",get:function(){return this[o]}},{key:"currentIndex",get:function(){return this[i]}},{key:"bufferByteLength",get:function(){return this.buffer.byteLength}},{key:"singleDataFragmentByteSize",get:function(){return this[u]}},{key:"vertexCount",get:function(){return this.currentIndex/this.singleDataFragmentByteSize}},{key:"length",get:function(){return this.buffer.byteLength}}],[{key:"TYPE_FLOAT32",get:function(){return 4}},{key:"TYPE_FLOAT64",get:function(){return 8}},{key:"TYPE_UINT8",get:function(){return 2}},{key:"TYPE_UINT16",get:function(){return 3}},{key:"TYPE_UINT32",get:function(){return 0}},{key:"TYPE_INT8",get:function(){return 5}},{key:"TYPE_INT16",get:function(){return 6}},{key:"TYPE_INT32",get:function(){return 7}},{key:"TYPE_UINT8CLAMPED",get:function(){return 1}},{key:"littleEndian",get:function(){if(void 0===l){var t=new ArrayBuffer(2),e=new Uint8Array(t),r=new Uint16Array(t);e[0]=170,e[1]=187,48042===r[0]&&(l=!0),43707===r[0]&&(l=!1)}return l}}]),t}();e.default=f},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,a=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(14),u=(n=i)&&n.__esModule?n:{default:n};var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return a(t,null,[{key:"earcut",value:function(t,e,r){r=r||2;var n=e&&e.length,a=n?e[0]*r:t.length,i=this.linkedList(t,0,a,r,!0),u=[];if(!i||i.next===i.prev)return u;var o=void 0,s=void 0,l=void 0,f=void 0,h=void 0,c=void 0,d=void 0;if(n&&(i=this.eliminateHoles(t,e,i,r)),t.length>80*r){o=l=t[0],s=f=t[1];for(var v=r;v<a;v+=r)(h=t[v])<o&&(o=h),(c=t[v+1])<s&&(s=c),h>l&&(l=h),c>f&&(f=c);d=0!==(d=Math.max(l-o,f-s))?1/d:0}return this.earcutLinked(i,u,r,o,s,d),u}},{key:"linkedList",value:function(e,r,n,a,i){var u,o;if(i===t.signedArea(e,r,n,a)>0)for(u=r;u<n;u+=a)o=this.insertNode(u,e[u],e[u+1],o);else for(u=n-a;u>=r;u-=a)o=this.insertNode(u,e[u],e[u+1],o);return o&&t.equals(o,o.next)&&(this.removeNode(o),o=o.next),o}},{key:"filterPoints",value:function(e,r){if(!e)return e;r||(r=e);var n,a=e;do{if(n=!1,a.steiner||!t.equals(a,a.next)&&0!==t.area(a.prev,a,a.next))a=a.next;else{if(this.removeNode(a),(a=r=a.prev)===a.next)break;n=!0}}while(n||a!==r);return r}},{key:"earcutLinked",value:function(t,e,r,n,a,i,u){if(t){!u&&i&&this.indexCurve(t,n,a,i);for(var o,s,l=t;t.prev!==t.next;)if(o=t.prev,s=t.next,i?this.isEarHashed(t,n,a,i):this.isEar(t))e.push(o.i/r),e.push(t.i/r),e.push(s.i/r),this.removeNode(t),t=s.next,l=s.next;else if((t=s)===l){u?1===u?(t=this.cureLocalIntersections(t,e,r),this.earcutLinked(t,e,r,n,a,i,2)):2===u&&this.splitEarcut(t,e,r,n,a,i):this.earcutLinked(this.filterPoints(t),e,r,n,a,i,1);break}}}},{key:"isEar",value:function(e){var r=e.prev,n=e,a=e.next;if(this.area(r,n,a)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(this.pointInTriangle(r.x,r.y,n.x,n.y,a.x,a.y,i.x,i.y)&&t.area(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}},{key:"isEarHashed",value:function(e,r,n,a){var i=e.prev,u=e,o=e.next;if(this.area(i,u,o)>=0)return!1;for(var s=i.x<u.x?i.x<o.x?i.x:o.x:u.x<o.x?u.x:o.x,l=i.y<u.y?i.y<o.y?i.y:o.y:u.y<o.y?u.y:o.y,f=i.x>u.x?i.x>o.x?i.x:o.x:u.x>o.x?u.x:o.x,h=i.y>u.y?i.y>o.y?i.y:o.y:u.y>o.y?u.y:o.y,c=this.zOrder(s,l,r,n,a),d=this.zOrder(f,h,r,n,a),v=e.prevZ,y=e.nextZ;v&&v.z>=c&&y&&y.z<=d;){if(v!==e.prev&&v!==e.next&&this.pointInTriangle(i.x,i.y,u.x,u.y,o.x,o.y,v.x,v.y)&&t.area(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,y!==e.prev&&y!==e.next&&this.pointInTriangle(i.x,i.y,u.x,u.y,o.x,o.y,y.x,y.y)&&t.area(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;v&&v.z>=c;){if(v!==e.prev&&v!==e.next&&this.pointInTriangle(i.x,i.y,u.x,u.y,o.x,o.y,v.x,v.y)&&t.area(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;y&&y.z<=d;){if(y!==e.prev&&y!==e.next&&this.pointInTriangle(i.x,i.y,u.x,u.y,o.x,o.y,y.x,y.y)&&t.area(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}},{key:"cureLocalIntersections",value:function(e,r,n){var a=e;do{var i=a.prev,u=a.next.next;!t.equals(i,u)&&this.intersects(i,a,a.next,u)&&this.locallyInside(i,u)&&this.locallyInside(u,i)&&(r.push(i.i/n),r.push(a.i/n),r.push(u.i/n),this.removeNode(a),this.removeNode(a.next),a=e=u),a=a.next}while(a!==e);return a}},{key:"splitEarcut",value:function(t,e,r,n,a,i){var u=t;do{for(var o=u.next.next;o!==u.prev;){if(u.i!==o.i&&this.isValidDiagonal(u,o)){var s=this.splitPolygon(u,o);return u=this.filterPoints(u,u.next),s=this.filterPoints(s,s.next),this.earcutLinked(u,e,r,n,a,i),void this.earcutLinked(s,e,r,n,a,i)}o=o.next}u=u.next}while(u!==t)}},{key:"eliminateHoles",value:function(t,e,r,n){var a,i,u,o,s,l=[];for(a=0,i=e.length;a<i;a++)u=e[a]*n,o=a<i-1?e[a+1]*n:t.length,(s=this.linkedList(t,u,o,n,!1))===s.next&&(s.steiner=!0),l.push(this.getLeftmost(s));for(l.sort(this.compareX),a=0;a<l.length;a++)this.eliminateHole(l[a],r),r=this.filterPoints(r,r.next);return r}},{key:"compareX",value:function(t,e){return t.x-e.x}},{key:"eliminateHole",value:function(t,e){if(e=this.findHoleBridge(t,e)){var r=this.splitPolygon(e,t);this.filterPoints(r,r.next)}}},{key:"findHoleBridge",value:function(t,e){var r,n=e,a=t.x,i=t.y,u=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var o=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=a&&o>u){if(u=o,o===a){if(i===n.y)return n;if(i===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(a===u)return r.prev;var s,l=r,f=r.x,h=r.y,c=1/0;for(n=r.next;n!==l;)a>=n.x&&n.x>=f&&a!==n.x&&this.pointInTriangle(i<h?a:u,i,f,h,i<h?u:a,i,n.x,n.y)&&((s=Math.abs(i-n.y)/(a-n.x))<c||s===c&&n.x>r.x)&&this.locallyInside(n,t)&&(r=n,c=s),n=n.next;return r}},{key:"indexCurve",value:function(t,e,r,n){var a=t;do{null===a.z&&(a.z=this.zOrder(a.x,a.y,e,r,n)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==t);a.prevZ.nextZ=null,a.prevZ=null,this.sortLinked(a)}},{key:"sortLinked",value:function(t){var e,r,n,a,i,u,o,s,l=1;do{for(r=t,t=null,i=null,u=0;r;){for(u++,n=r,o=0,e=0;e<l&&(o++,n=n.nextZ);e++);for(s=l;o>0||s>0&&n;)0!==o&&(0===s||!n||r.z<=n.z)?(a=r,r=r.nextZ,o--):(a=n,n=n.nextZ,s--),i?i.nextZ=a:t=a,a.prevZ=i,i=a;r=n}i.nextZ=null,l*=2}while(u>1);return t}},{key:"zOrder",value:function(t,e,r,n,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*a)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*a)|e<<8))|e<<4))|e<<2))|e<<1))<<1}},{key:"getLeftmost",value:function(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}},{key:"pointInTriangle",value:function(t,e,r,n,a,i,u,o){return(a-u)*(e-o)-(t-u)*(i-o)>=0&&(t-u)*(n-o)-(r-u)*(e-o)>=0&&(r-u)*(i-o)-(a-u)*(n-o)>=0}},{key:"isValidDiagonal",value:function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!this.intersectsPolygon(t,e)&&this.locallyInside(t,e)&&this.locallyInside(e,t)&&this.middleInside(t,e)}},{key:"area",value:function(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}},{key:"equals",value:function(t,e){return t.x===e.x&&t.y===e.y}},{key:"intersects",value:function(e,r,n,a){return!!(t.equals(e,r)&&t.equals(n,a)||t.equals(e,a)&&t.equals(n,r))||t.area(e,r,n)>0!=t.area(e,r,a)>0&&t.area(n,a,e)>0!=t.area(n,a,r)>0}},{key:"intersectsPolygon",value:function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&this.intersects(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}},{key:"locallyInside",value:function(e,r){return area(e.prev,e,e.next)<0?t.area(e,r,e.next)>=0&&t.area(e,e.prev,r)>=0:t.area(e,r,e.prev)<0||t.area(e,e.next,r)<0}},{key:"middleInside",value:function(t,e){var r=t,n=!1,a=(t.x+e.x)/2,i=(t.y+e.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&a<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}},{key:"splitPolygon",value:function(t,e){var r=new u.default(t.i,t.x,t.y),n=new u.default(e.i,e.x,e.y),a=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=a,a.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}},{key:"insertNode",value:function(t,e,r,n){var a=new u.default(t,e,r);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}},{key:"removeNode",value:function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}},{key:"signedArea",value:function(t,e,r,n){for(var a=0,i=e,u=r-n;i<r;i+=n)a+=(t[u]-t[i])*(t[i+1]+t[u+1]),u=i;return a}},{key:"deviation",value:function(t,e,r,n){var a=e&&e.length,i=a?e[0]*r:t.length,u=Math.abs(this.signedArea(t,0,i,r));if(a)for(var o=0,s=e.length;o<s;o++){var l=e[o]*r,f=o<s-1?e[o+1]*r:t.length;u-=Math.abs(this.signedArea(t,l,f,r))}var h=0;for(o=0;o<n.length;o+=3){var c=n[o]*r,d=n[o+1]*r,v=n[o+2]*r;h+=Math.abs((t[c]-t[v])*(t[d+1]-t[c+1])-(t[c]-t[d])*(t[v+1]-t[c+1]))}return 0===u&&0===h?0:Math.abs((h-u)/u)}},{key:"flatten",value:function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,a=0;a<t.length;a++){for(var i=0;i<t[a].length;i++)for(var u=0;u<e;u++)r.vertices.push(t[a][i][u]);a>0&&(n+=t[a-1].length,r.holes.push(n))}return r}}]),t}();e.default=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.i=e,this.x=r,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=o(r(16)),i=o(r(2)),u=o(r(1));function o(t){return t&&t.__esModule?t:{default:t}}var s=Symbol("WebGL的program"),l=Symbol("转换矩阵变量可用的最大数量"),f=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gl=e,this.firstTIMEDEBUG=!0,this.DEBUG_DRAW_COUNT=0,this.configured=!1;var r=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS);this[l]=Math.floor((r-7)/4),this[l]=10,this.textureManager=null,this.lightPosition=[0,0,1],this.init()}return n(t,[{key:"clean",value:function(){this.DEBUG_DRAW_COUNT=0,this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}},{key:"initRending",value:function(){var t=this.gl;t.viewport(0,0,t.canvas.width,t.canvas.height)}},{key:"rendVertexArray",value:function(t,e,r,n,a){this.gl;switch(this.setLightPosition(this.lightPosition),t){case i.default.ACTION_FILL:this.fillRendVertexArray(e,r,n,a);break;case i.default.ACTION_STROKE:this.strokeRendVertexArray(e,r,n,a)}}},{key:"setUniformTransformMatrix",value:function(t,e){this.gl.uniformMatrix4fv(this.shaderInformation.transformMatrixArray[e],!1,t)}},{key:"configVerticesBufferData",value:function(t,e,r){var n=0,a=0;null==e&&(e=0);for(var i=0;i<t.length;i++)n+=t[i].bufferSize,i==t.length-1&&null!=r?a+=r+1:a+=t[i].vertexNumber;a-=e;var u=this.gl;this.prepareVertexDatas(n),this.prepareMatrixIndexDatas(n/8);for(var o=0,s=0,l=0;l<t.length;l++){var f=t[l];u.bindBuffer(u.ARRAY_BUFFER,this.shaderInformation.verticesBuffer),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,o,f.dataBuffer.buffer),u.bindBuffer(u.ARRAY_BUFFER,this.shaderInformation.matrixIndexBuffer),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,s,f.matrixIndexBuffer.buffer),o+=f.dataBuffer.currentIndex,s+=f.matrixIndexBuffer.currentIndex}return a}},{key:"fillRendVertexArray",value:function(t,e,r,n){if(null==e&&(e=0),0!=t.length){this.configTexture(n);var a=this.configVerticesBufferData(t,e,r);a<3||(this.gl.drawArrays(this.gl.TRIANGLES,0,a),this.DEBUG_DRAW_COUNT++)}}},{key:"strokeRendVertexArray",value:function(t,e,r){if(null==e&&(e=0),0!=t.length){this.configTexture();var n=this.configVerticesBufferData(t,e,r);n<2||(this.gl.drawArrays(this.gl.LINE_STRIP,0,n),this.DEBUG_DRAW_COUNT++)}}},{key:"executeRenderAction",value:function(t,e){for(var r=1,n=void 0,a=[],o={},s=0;s<t.length;s++){var l=t[s];if(null==n&&(n=l),l.type!=i.default.ACTION_STROKE)if(l.type==n.type){l.textureIndex!=n.textureIndex&&-1!=l.textureIndex&&-1!=n.textureIndex&&(this.rendVertexArray(n.type,a,void 0,void 0,n.textureIndex),a=[],n=l,r=1,o={}),-1==n.textureIndex&&-1!=l.textureIndex&&(n=l),a.push(l.vertexData);for(var f=0;f<l.vertexData.vertexNumber;f++){var h=l.vertexData.getMatrixIndex(f),c=l.vertexData.getContextStateIndex(f),d=c+"-"+h,v=o[d];if(null==v)if((v=r)+1>this.maxTransformMatrixNum){if(0==f){a.pop(),this.rendVertexArray(n.type,a,void 0,void 0,n.textureIndex),o={},r=1,a=[],n=void 0,s--;break}var y=e[c].matrixArray[h],x=l.vertexData.dataBuffer.getVertex(f*l.vertexData.dataBuffer.singleDataFragmentByteSize);x=u.default.multiplyWithVertex(y,x),l.vertexData.dataBuffer.modifyVertex(x,f*l.vertexData.dataBuffer.singleDataFragmentByteSize),l.vertexData.matrixIndexBuffer.put(0)}else{var g=e[c].matrixArray[h];o[d]=v,this.setUniformTransformMatrix(g,v),l.vertexData.matrixIndexBuffer.put(v),r++}else l.vertexData.matrixIndexBuffer.put(v)}}else this.rendVertexArray(n.type,a),r=1,s--,n=void 0,a=[];else{n!=l&&null!=n&&this.rendVertexArray(n.type,a,void 0,void 0,n.textureIndex),(a=[]).push(l.vertexData),r=1,o={},n=l;for(var b=0;b<l.vertexData.vertexNumber;b++){var m=l.vertexData.getMatrixIndex(b),p=l.vertexData.getContextStateIndex(b),k=p+"-"+m,M=o[k];if(null==M)if((M=r)+1>this.maxTransformMatrixNum){var T=e[p].matrixArray[m],I=l.vertexData.dataBuffer.getVertex(b*l.vertexData.dataBuffer.singleDataFragmentByteSize);I=u.default.multiplyWithVertex(T,I),l.vertexData.dataBuffer.modifyVertex(I,b*l.vertexData.dataBuffer.singleDataFragmentByteSize),l.vertexData.matrixIndexBuffer.put(0)}else{var w=e[p].matrixArray[m];o[k]=M,this.setUniformTransformMatrix(w,M),l.vertexData.matrixIndexBuffer.put(M),r++}else l.vertexData.matrixIndexBuffer.put(M)}this.rendVertexArray(l.type,a),o={},a=[],r=1}}0!=a.length&&null!=n&&this.rendVertexArray(n.type,a,0,void 0,n.textureIndex)}},{key:"configTexture",value:function(t){null==t&&(t=-1);var e=this.gl,r=this.shaderInformation;e.uniform1i(r.textureLocation,0);var n=void 0,a=void 0;-1==t?(n=r.blackTexture,a={width:1,height:1}):(n=this.textureManager.textureArray[t],a=this.textureManager.imageDataArray[t]),e.uniform2f(r.singleCanvas,a.width,a.height),e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,n)}},{key:"prepareVertexDatas",value:function(t){var e=this.gl,r=this.shaderInformation;e.enableVertexAttribArray(r.vertexAttribute),e.enableVertexAttribArray(r.colorAttribute),e.enableVertexAttribArray(r.textureCoordAttribute),e.bindBuffer(e.ARRAY_BUFFER,r.verticesBuffer),e.bufferData(e.ARRAY_BUFFER,t,e.DYNAMIC_DRAW);var n=3,a=e.FLOAT,i=0;e.vertexAttribPointer(r.vertexAttribute,n,a,!1,32,i),a=e.UNSIGNED_BYTE,n=4,i=20,e.vertexAttribPointer(r.colorAttribute,n,a,!1,32,i),a=e.FLOAT,n=2,i+=4,e.vertexAttribPointer(r.textureCoordAttribute,n,a,!1,32,i)}},{key:"prepareMatrixIndexDatas",value:function(t){var e=this.gl,r=this.shaderInformation;e.enableVertexAttribArray(r.transformMatrixIndex),e.bindBuffer(e.ARRAY_BUFFER,r.matrixIndexBuffer),e.bufferData(e.ARRAY_BUFFER,t,e.DYNAMIC_DRAW);var n=e.FLOAT;e.vertexAttribPointer(r.transformMatrixIndex,1,n,!1,4,0)}},{key:"setLightPosition",value:function(t){this.gl.uniform3f(this.shaderInformation.lightPosition,t[0],t[1],t[2])}},{key:"createShaderProgram",value:function(){var t=this.gl,e=this.loadShader(t.VERTEX_SHADER,this.getVertexShaderSource(this.maxTransformMatrixNum)),r=this.loadShader(t.FRAGMENT_SHADER,"\n  // 片断着色器没有默认精度，所以我们需要设置一个精度\n  // mediump代表“medium precision”（中等精度）\n  precision mediump float;\n  varying vec4 currentColor;\n  varying vec2 v_texcoord;\n  varying vec3 normal;\n  uniform vec2 singleCanvas;\n  uniform vec3 u_lightPosition;\n  uniform sampler2D u_texture;\n  void main() {\n        vec3 r_normal = normalize(normal);\n        vec2 coord = vec2(v_texcoord.x / singleCanvas.x , v_texcoord.y/singleCanvas.y);\n        vec4 color = currentColor;    \n        vec3 r_lightLocation = normalize(u_lightPosition);    \n        gl_FragColor = color * texture2D(u_texture,coord);\n        gl_FragColor.rgb *= abs(dot(r_normal,r_lightLocation));\n  }\n  "),n=t.createProgram();return t.attachShader(n,e),t.attachShader(n,r),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)?(t.useProgram(n),n):(console.error("无法初始化Program: "+t.getProgramInfoLog(n)),t.deleteProgram(n),null)}},{key:"init",value:function(){var t=this.gl;this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.BLEND),this.gl.disable(this.gl.DEPTH_TEST),this[s]=this.createShaderProgram();var e=this[s];this.shaderInformation=this.initShaderInformation(e),this.textureManager=new a.default(801,801,10,4),this.textureManager.maxHeight=t.getParameter(this.gl.MAX_TEXTURE_SIZE),this.textureManager.maxWidth=this.textureManager.maxHeight;t.canvas.clientWidth,t.canvas.clientHeight;var r=u.default.orthoProjection(0,0,t.canvas.width,t.canvas.height,-1e3,1e3);t.uniformMatrix4fv(this.shaderInformation.perspectiveMatrix,!1,r)}},{key:"initShaderInformation",value:function(t){var e=this.gl,r=e.getAttribLocation(t,"u_texCoord");e.enableVertexAttribArray(r);var n=e.getAttribLocation(t,"a_position");e.enableVertexAttribArray(n);var a=e.getAttribLocation(t,"transform_matrix_index");e.enableVertexAttribArray(a);var i=e.getAttribLocation(t,"color");e.enableVertexAttribArray(i);for(var o=e.getUniformLocation(t,"perspective_matrix"),s=new Array(this.maxTransformMatrixNum),l=0;l<s.length;l++)s[l]=e.getUniformLocation(t,"transform_matrix_array["+l+"]");e.uniformMatrix4fv(s[0],!1,u.default.identity());var f=e.getUniformLocation(t,"singleCanvas"),h=e.getUniformLocation(t,"u_lightPosition"),c=e.getUniformLocation(t,"u_texture"),d=e.createBuffer(),v=e.createBuffer(),y=e.createTexture();e.bindTexture(e.TEXTURE_2D,y);var x=new Uint8Array([255,255,255,255]);return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,x),e.bindTexture(e.TEXTURE_2D,null),{lightPosition:h,vertexAttribute:n,colorAttribute:i,textureCoordAttribute:r,verticesBuffer:d,matrixIndexBuffer:v,perspectiveMatrix:o,transformMatrixArray:s,transformMatrixIndex:a,singleCanvas:f,textureLocation:c,blackTexture:y,webgl:e}}},{key:"loadShader",value:function(t,e){var r=this.gl,n=r.createShader(t);return r.shaderSource(n,e),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS)?n:(console.error("着色器编译错误: "+r.getShaderInfoLog(n)),r.deleteShader(n),null)}},{key:"getVertexShaderSource",value:function(t){return" attribute vec4 color;\n     attribute vec4 a_position;\n     attribute vec2 u_texCoord;\n     attribute float transform_matrix_index;\n     varying vec2 v_texcoord;\n     varying vec4 currentColor;\n     varying vec3 normal;\n     uniform mat4 perspective_matrix;\n     uniform mat4 transform_matrix_array["+t+"];\n     void main() {\n             normal = vec3(0,0,1);\n             v_texcoord = u_texCoord;\n            // 切换坐标系到投影坐标系中\n            vec4 new_position = transform_matrix_array[int(transform_matrix_index)] * a_position;\n            normal = mat3(transform_matrix_array[int(transform_matrix_index)]) * normal;\n            vec4 finalPosition = perspective_matrix* new_position;\n            currentColor = vec4 (color.xyz/255.0,color.w/100.0);\n            gl_Position = finalPosition;\n    }"}},{key:"maxTransformMatrixNum",get:function(){return this[l]}}]),t}();e.default=f},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,a=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(17),u=(n=i)&&n.__esModule?n:{default:n};var o=Symbol("图片缓存"),s=Symbol("texture缓存"),l=function(){function t(e,r,n,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.maxWidth=e||1,this.maxHeight=r||1,this.maxTextureNum=n||1,this[o]=[],this[s]=[],this.imageDataArray=new Array(this.maxTextureNum),this.textureArray=new Array(this.maxTextureNum),this.space=a||3}return a(t,[{key:"getTexture",value:function(t,e,r){var n=this.imageCatch.indexOf(t);return-1==n?this.registerImageData(t,e,r):this[s][n]}},{key:"registerImageData",value:function(t,e,r){if(null!=t&&null!=t){null==r&&(r=!1);var n=0,a=0,i=t.width,o=t.height;if(i>this.maxWidth||o>this.maxHeight)throw new Error("图片大小超过了最大限制："+this.maxWidth+" x "+this.maxHeight);if(-1==this.imageCatch.indexOf(t)){var l=new u.default,f=l.getContext("2d");f.clearRect(0,0,l.width,l.height);for(var h=-1,c=0;c<this.imageDataArray.length;c++){var d=this.imageDataArray[c];if(null==d)d={imageData:void 0,startX:0,startY:0,width:0,height:0},this.imageDataArray[c]=d,l.width=t.width,l.height=t.height+1,n=0,a=1,f.fillStyle="#ffffff",f.fillRect(0,0,1,1),f.drawImage(t,0,1),d.imageData=f.getImageData(0,0,l.width,l.height),d.startX=l.width+this.space,d.startY=1,d.width=l.width,d.height=l.height;else{var v=t.width,y=t.height;if(n=d.startX,a=d.startY,n+v>this.maxWidth?(n=0,a=d.height+this.space,l.width=Math.max(d.width,v),l.height=a+y,console.log("换行")):(l.width=Math.max(d.width,n+v),l.height=Math.max(d.height,a+y),console.log("不换行")),a+y>this.maxHeight){console.log("图片超过贴图内存最大尺寸");continue}f.putImageData(d.imageData,0,0),f.drawImage(t,n,a),d.imageData=f.getImageData(0,0,l.width,l.height),d.startX=n+v+this.space,d.startY=a,d.width=l.width,d.height=l.height}h=c;break}if(-1!=h){this.imageCatch.push(t);var x={x:n,y:a,width:i,height:o,index:h};return r&&this.createTexture(e,h,l),this[s].push(x),x}}}else console.error("Image can not be null")}},{key:"createAllTexture",value:function(t){if(null!=t)for(var e=new u.default,r=(e.getContext("2d"),0);r<this.textureArray.length;r++)this.createTexture(t,r,e)}},{key:"createTexture",value:function(e,r,n){if(null!=e&&null!=r&&-1!=r){null==n&&(n=new u.default);var a=n.getContext("2d"),i=this.textureArray[r],o=this.imageDataArray[r];null!=o&&(n.width=o.width,n.height=o.height,a.putImageData(o.imageData,0,0),null==i&&(i=e.createTexture(),this.textureArray[r]=i),e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),t.isPOT(n.width)&&t.isPOT(n.height)?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(e.TEXTURE_2D)):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.bindTexture(e.TEXTURE_2D,null))}}},{key:"imageCatch",get:function(){return this[o]}}],[{key:"isPOT",value:function(t){return t>0&&0==(t-1&t)}}]),t}();e.default=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),document.createElement("canvas")}}]).default});