!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.tielifa=e():t.tielifa=e()}(window,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=10)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var a=2*Math.PI,i=void 0,u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.instance=null}return r(t,null,[{key:"equals",value:function(t,e){return Math.abs(t-e)<=1e-5}},{key:"getDistance",value:function(t,e){var n=t.x-e.x,r=t.y-e.y,a=0;return null!=t.z&&null!=e.z&&(a=t.z-e.z),Math.sqrt(n*n+r*r+a*a)}},{key:"clamp",value:function(t,e,n){return t>n?n:t<e?e:t}},{key:"getInsance",value:function(){return null==this.instance&&(this.instance=new t),this.instance}},{key:"overlaps",value:function(t,e){var n=t,r=e;return n.left<=r.right&&n.right>=r.left&&n.bottom>=r.top&&n.top<=r.bottom}},{key:"isHit",value:function(e,n){var r=!1,a=e.left,i=e.top;return t.isInTheRect(a,i,n)&&(r=!0),a=e.left,i=e.top+e.height,t.isInTheRect(a,i,n)&&(r=!0),a=e.left+e.width,i=e.top,t.isInTheRect(a,i,n)&&(r=!0),a=e.left+e.width,i=e.top+e.height,t.isInTheRect(a,i,n)&&(r=!0),r||(a=n.left,i=n.top,t.isInTheRect(a,i,e)&&(r=!0),a=n.left,i=n.top+n.height,t.isInTheRect(a,i,e)&&(r=!0),a=n.left+n.width,i=n.top,t.isInTheRect(a,i,e)&&(r=!0),a=n.left+n.width,i=n.top+n.height,t.isInTheRect(a,i,e)&&(r=!0)),r}},{key:"isInTheRect",value:function(t,e,n){var r=n.left,a=n.top,i=n.width,u=n.height;return t>r&&t<r+i&&e>a&&e<a+u}},{key:"PI2",get:function(){return a}},{key:"EPSILON",get:function(){return 1e-5}},{key:"littleEndian",get:function(){if(void 0===i){var t=new ArrayBuffer(2),e=new Uint8Array(t),n=new Uint16Array(t);e[0]=170,e[1]=187,48042===n[0]&&(i=!0),43707===n[0]&&(i=!1)}return i}}]),t}();e.default=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(0),u=(r=i)&&r.__esModule?r:{default:r};var l=void 0,o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return a(t,null,[{key:"perspective2",value:function(t,e,n,r,a,i){return[2*a/(n-t),0,0,0,0,2*a/(e-r),0,0,(n+t)/(n-t),(r+e)/(e-r),(-a-i)/(i-a),-1,0,0,-a*i*2/(i-a),0]}},{key:"perspective3",value:function(e,n,r,a,i,u){var l=this.perspective(e,n/r,a,i,u),o=t.TEMP_MAT4[0];return t.translationMatrix(o,-n/2,-r/2,0),t.multiply(l,l,o),l}},{key:"isIdentity",value:function(t){return!(1!==t[0]||0!==t[1]||0!==t[2]||0!==t[3]||0!==t[4]||1!==t[5]||0!==t[6]||0!==t[7]||0!==t[8]||0!==t[9]||1!==t[10]||0!==t[11]||0!==t[12]||0!==t[13]||0!==t[14]||1!==t[15])}},{key:"perspective",value:function(t,e,n,r,a){var i=Math.tan(.5*Math.PI-.5*t);u.default.equals(i,1)&&(i=1);var l=1/(n-r),o=void 0;return null!=a?(this.identityMatrix(a),o=a):o=this.identity(),o[0]=i/e,o[5]=-i,o[10]=(n+r)*l,o[11]=-1,o[14]=n*r*l*2,o}},{key:"orthoProjection",value:function(t,e,n,r,a,i,u){return null!=u?(this.identityMatrix(u),u[0]=2/(n-t),u[5]=2/(e-r),u[10]=2/(a-i),u[12]=(t+n)/(t-n),u[13]=(r+e)/(r-e),u[14]=(a+i)/(a-i),u):new Float32Array([2/(n-t),0,0,0,0,2/(e-r),0,0,0,0,2/(a-i),0,(t+n)/(t-n),(r+e)/(r-e),(a+i)/(a-i),1])}},{key:"copy",value:function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}},{key:"equals",value:function(t,e){var n=t[0],r=t[1],a=t[2],i=t[3],l=t[4],o=t[5],s=t[6],f=t[7],h=t[8],c=t[9],d=t[10],y=t[11],v=t[12],g=t[13],x=t[14],b=t[15],p=e[0],m=e[1],k=e[2],M=e[3],w=e[4],P=e[5],T=e[6],S=e[7],D=e[8],I=e[9],_=e[10],A=e[11],E=e[12],N=e[13],C=e[14],O=e[15];return Math.abs(n-p)<=u.default.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(r-m)<=u.default.EPSILON*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(a-k)<=u.default.EPSILON*Math.max(1,Math.abs(a),Math.abs(k))&&Math.abs(i-M)<=u.default.EPSILON*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(l-w)<=u.default.EPSILON*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(o-P)<=u.default.EPSILON*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(s-T)<=u.default.EPSILON*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(f-S)<=u.default.EPSILON.EPSILON*Math.max(1,Math.abs(f),Math.abs(S))&&Math.abs(h-D)<=u.default.EPSILON*Math.max(1,Math.abs(h),Math.abs(D))&&Math.abs(c-I)<=u.default.EPSILON*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(d-_)<=u.default.EPSILON*Math.max(1,Math.abs(d),Math.abs(_))&&Math.abs(y-A)<=u.default.EPSILON*Math.max(1,Math.abs(y),Math.abs(A))&&Math.abs(v-E)<=u.default.EPSILON*Math.max(1,Math.abs(v),Math.abs(E))&&Math.abs(g-N)<=u.default.EPSILON*Math.max(1,Math.abs(g),Math.abs(N))&&Math.abs(x-C)<=u.default.EPSILON*Math.max(1,Math.abs(x),Math.abs(C))&&Math.abs(b-O)<=u.default.EPSILON*Math.max(1,Math.abs(b),Math.abs(O))}},{key:"exactEquals",value:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}},{key:"projection",value:function(t,e,n){var r=this.identity();return r[0]=2/t,r[5]=-2/e,r[10]=2/n,r[12]=-1,r[13]=1,r[15]=1,r}},{key:"identity",value:function(){var t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}},{key:"identityMatrix",value:function(t){var e=t;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}},{key:"translationMatrix",value:function(t,e,n,r){var a=t;a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=e,a[13]=n,a[14]=r,a[15]=1}},{key:"translation",value:function(t,e,n){var r=this.identity();return r[12]=t,r[13]=e,r[14]=n,r}},{key:"rotationZMatrix",value:function(t,e){var n=t;n[2]=0,n[3]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1;var r=Math.cos(e),a=Math.sin(e);n[0]=r,n[1]=a,n[4]=-a,n[5]=r}},{key:"rotationZ",value:function(t){var e=Math.cos(t),n=Math.sin(t),r=this.identity();return r[0]=e,r[1]=n,r[4]=-n,r[5]=e,r}},{key:"rotationXMatrix",value:function(t,e){var n=t;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[7]=0,n[8]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1;var r=Math.cos(e),a=Math.sin(e);n[5]=r,n[6]=a,n[9]=-a,n[10]=r}},{key:"rotationX",value:function(t){var e=Math.cos(t),n=Math.sin(t),r=this.identity();return r[5]=e,r[6]=n,r[9]=-n,r[10]=e,r}},{key:"rotationYMatrix",value:function(t,e){var n=t;n[1]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1;var r=Math.cos(e),a=Math.sin(e);n[0]=r,n[2]=-a,n[8]=a,n[10]=r}},{key:"rotationY",value:function(t){var e=Math.cos(t),n=Math.sin(t),r=this.identity();return r[0]=e,r[2]=-n,r[8]=n,r[10]=e,r}},{key:"scalingMatrix",value:function(t,e,n,r){var a=t;a[0]=e,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=n,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=r,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1}},{key:"scaling",value:function(t,e,n){var r=this.identity();return r[0]=t,r[5]=e,r[10]=n,r}},{key:"multiplyWithVertex",value:function(t,e,n){var r=t[0],a=t[1],i=t[2],u=t[3],l=t[4],o=t[5],s=t[6],f=t[7],h=t[8],c=t[9],d=t[10],y=t[11],v=t[12],g=t[13],x=t[14],b=t[15],p=e[0],m=e[1],k=e[2],M=e[3];return null==k&&(k=0),null==M&&(M=1),n[0]=p*r+m*l+k*h+M*v,n[1]=p*a+m*o+k*c+M*g,n[2]=p*i+m*s+k*d+M*x,n[3]=p*u+m*f+k*y+M*b,n}},{key:"multiply",value:function(t,e,n){var r=e[0],a=e[1],i=e[2],u=e[3],l=e[4],o=e[5],s=e[6],f=e[7],h=e[8],c=e[9],d=e[10],y=e[11],v=e[12],g=e[13],x=e[14],b=e[15],p=n[0],m=n[1],k=n[2],M=n[3];return t[0]=p*r+m*l+k*h+M*v,t[1]=p*a+m*o+k*c+M*g,t[2]=p*i+m*s+k*d+M*x,t[3]=p*u+m*f+k*y+M*b,p=n[4],m=n[5],k=n[6],M=n[7],t[4]=p*r+m*l+k*h+M*v,t[5]=p*a+m*o+k*c+M*g,t[6]=p*i+m*s+k*d+M*x,t[7]=p*u+m*f+k*y+M*b,p=n[8],m=n[9],k=n[10],M=n[11],t[8]=p*r+m*l+k*h+M*v,t[9]=p*a+m*o+k*c+M*g,t[10]=p*i+m*s+k*d+M*x,t[11]=p*u+m*f+k*y+M*b,p=n[12],m=n[13],k=n[14],M=n[15],t[12]=p*r+m*l+k*h+M*v,t[13]=p*a+m*o+k*c+M*g,t[14]=p*i+m*s+k*d+M*x,t[15]=p*u+m*f+k*y+M*b,t}},{key:"inverse",value:function(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],u=e[4],l=e[5],o=e[6],s=e[7],f=e[8],h=e[9],c=e[10],d=e[11],y=e[12],v=e[13],g=e[14],x=e[15],b=n*l-r*u,p=n*o-a*u,m=n*s-i*u,k=r*o-a*l,M=r*s-i*l,w=a*s-i*o,P=f*v-h*y,T=f*g-c*y,S=f*x-d*y,D=h*g-c*v,I=h*x-d*v,_=c*x-d*g,A=b*_-p*I+m*D+k*S-M*T+w*P;return A?(A=1/A,t[0]=(l*_-o*I+s*D)*A,t[1]=(a*I-r*_-i*D)*A,t[2]=(v*w-g*M+x*k)*A,t[3]=(c*M-h*w-d*k)*A,t[4]=(o*S-u*_-s*T)*A,t[5]=(n*_-a*S+i*T)*A,t[6]=(g*m-y*w-x*p)*A,t[7]=(f*w-c*m+d*p)*A,t[8]=(u*I-l*S+s*P)*A,t[9]=(r*S-n*I-i*P)*A,t[10]=(y*M-v*m+x*b)*A,t[11]=(h*m-f*M-d*b)*A,t[12]=(l*T-u*D-o*P)*A,t[13]=(n*D-r*T+a*P)*A,t[14]=(v*p-y*k-g*b)*A,t[15]=(f*k-h*p+c*b)*A,t):null}},{key:"TEMP_MAT4",get:function(){return null==l&&(l=[t.identity(),t.identity(),t.identity(),t.identity()]),l}},{key:"EPSILON",get:function(){return u.default.EPSILON}}]),t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(0),u=(r=i)&&r.__esModule?r:{default:r};var l=void 0,o=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.value=new Float32Array(4),this.x=e||0,this.y=n||0,this.z=r||0,this.value[3]=1}return a(t,[{key:"x",get:function(){return this.value[0]},set:function(t){this.value[0]=t}},{key:"y",get:function(){return this.value[1]},set:function(t){this.value[1]=t}},{key:"z",get:function(){return this.value[2]},set:function(t){this.value[2]=t}},{key:"magnitude",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}}],[{key:"dot",value:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}},{key:"normalize",value:function(t,e){var n=e.magnitude;u.default.equals(0,n)?(t.x=0,t.y=0,t.z=0):(t.x=e.x/n,t.y=e.y/n,t.z=e.z/n)}},{key:"plus",value:function(t,e,n){return t.x=e.x+n.x,t.y=e.y+n.y,t.z=e.z+n.z,t}},{key:"multiplyValue",value:function(t,e,n){return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t}},{key:"copy",value:function(t,e){e.x=t.x,e.y=t.y,e.z=t.z}},{key:"cross",value:function(t,e,n){return t.x=e.y*n.z-e.z*n.y,t.y=e.z*n.x-e.x*n.z,t.z=e.x*n.y-e.y*n.x,t}},{key:"TEMP_VECTORS",get:function(){return null==l&&(l=[new t,new t,new t,new t]),l}}]),t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=l(n(2)),i=l(n(6)),u=l(n(4));l(n(0));function l(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return r(t,null,[{key:"getProjectionPointOnLine",value:function(t,e,n){var r=u.default.TEMP_VECTORS[0];r.x=n.x-e.x,r.y=n.y-e.y,u.default.normalize(r,r);var a=u.default.TEMP_VECTORS[1];a.x=t.x-e.x,a.y=t.y-e.y;var i=u.default.dot(a,r);u.default.multiplyValue(r,r,i);var l={x:0,y:0};return u.default.plus(l,r,e),l}},{key:"cubicBezier",value:function(t,e,n,r,a,i,u,l,o,s){var f=1-t,h=f*f*f*e;h+=3*f*f*t*r,h+=3*f*t*t*i,h+=t*t*t*l;var c=f*f*f*n;return c+=3*f*f*t*a,c+=3*f*t*t*u,c+=t*t*t*o,(s=s||[0,0])[0]=h,s[1]=c,s}},{key:"quadraticBezier",value:function(t,e,n,r,a,i,u,l){var o=1-t,s=o*o*e;s+=2*o*t*r,s+=t*t*i,(l=l||[0,0])[0]=s;var f=o*o*n;return f+=2*o*t*a,f+=t*t*u,l[1]=f,l}},{key:"arcConversionEndpointToCenter",value:function(t,e,n,r,a,l,o){var s=[(t-n)/2,(e-r)/2,1],f=i.default.TEMP_MAT3[0];0!=o&&(i.default.rotate(f,-o),i.default.multiplyWithVertex(f,f,s),s[0]=f[0],s[1]=f[1]);var h=a*a*l*l/(a*a*s[1]*s[1]+l*l*s[0]*s[0]);if((h=Math.abs(h-1))<0)throw new Error("radius is small, the ellipse does not across these two points");var c=Math.sqrt(h),d=1;c*=d;var y=[a*s[1]/l,-l*s[0]/a,0];y[0]*=c,y[1]*=c;var v=[y[0],y[1],1];0!=o&&(i.default.rotate(f,o),i.default.multiplyWithVertex(f,f,v));var g=v[0]+(t+n)/2,x=v[1]+(e+r)/2,b=u.default.TEMP_VECTORS[0];b.x=1,b.y=0;var p=u.default.TEMP_VECTORS[1];p.x=(s[0]-y[0])/a,p.y=(s[1]-y[1])/l;var m=Math.abs(Math.acos(u.default.dot(b,p)/(b.magnitude*p.magnitude)));b.x*p.y<0&&(m*=-1),b.x=(-s[0]-y[0])/a,b.y=(-s[1]-y[1])/l;var k=Math.acos(u.default.dot(b,p)/(b.magnitude*p.magnitude));return{x:g,y:x,theta:m,deltaTheta:k=Math.abs(k%(2*Math.PI))}}},{key:"getEllipsePointWithRadian",value:function(t,e,n,r,u,l,o){o=o||[0,0];var s=a.default.TEMP_VECTORS[0];if(s.x=n*Math.cos(u),s.y=r*Math.sin(u),s.z=0,0!=l){var f=i.default.TEMP_MAT3[0];i.default.rotate(f,l),i.default.multiplyWithVertex(f,f,s.value),s.x=f[0],s.y=f[1]}return o[0]=s.x+t,o[1]=s.y+e,o}},{key:"calculateIntersectionOfPlane",value:function(t,e,n,r,i,u){var l=a.default.dot(t,e);if(0==Math.abs(l))return null;var o=a.default.TEMP_VECTORS[0];o.x=r.x-n.x,o.y=r.y-n.y,o.z=r.z-n.z;var s=a.default.dot(o,t)/l,f=s>0?1:-1,h=s;null!=u&&Math.abs(s)>u&&(h=u*f),s=h,a.default.multiplyValue(o,e,s),a.default.plus(i,o,n)}},{key:"calculateIntersectionOfTowLines",value:function(t,e,n,r){var a=t.x,i=t.y,u=e.x,l=e.y,o=n.x,s=n.y,f=r.x,h=r.y,c=(a-u)*(s-h)-(i-l)*(o-f);if(0!=c){var d=(a*l-i*u)*(o-f)-(a-u)*(o*h-s*f),y=(a*l-i*u)*(s-h)-(i-l)*(o*h-s*f);return{x:d/=c,y:y/=c}}}}]),t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(0),u=(r=i)&&r.__esModule?r:{default:r};var l=Symbol("二维向量值数组,0是x，1是y"),o=void 0,s=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this[l]=new Float32Array(3),null==e&&null==e||(this.x=e),null==n&&null==n||(this.y=n),this[l][2]=1}return a(t,[{key:"x",get:function(){return this[l][0]},set:function(t){this[l][0]=t}},{key:"y",get:function(){return this[l][1]},set:function(t){this[l][1]=t}},{key:"value",get:function(){return this[l]},set:function(t){this[l][0]=t[0],this[l][1]=t[1]}},{key:"radian",get:function(){return Math.atan2(this.y,this.x)}},{key:"magnitude",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}],[{key:"rotate",value:function(t,e,n){var r=Math.cos(n),a=Math.sin(n);t||(t={x:0,y:0});var i=e.x*a+e.y*r,u=e.x*r-e.y*a;return t.x=u,t.y=i,t}},{key:"rotateAbout",value:function(t,e,n,r){var a=Math.cos(r),i=Math.sin(r);return t||(t={}),t.x=n.x+((e.x-n.x)*a-(e.y-n.y)*i),t.y=n.y+((e.x-n.x)*i+(e.y-n.y)*a),t}},{key:"normalize",value:function(t,e){var n=e.magnitude;return null==t?t=e.clone():t!=e&&(t.x=e.x,t.y=e.y),0==n?(t.x=0,t.y=0,t):(t.x=t.x/n,t.y=t.y/n,t)}},{key:"multiplyValue",value:function(t,e,n){var r=e.x*n,a=e.y*n;t.x=r,t.y=a}},{key:"dot",value:function(t,e){return t.x*e.x+t.y*e.y}},{key:"cross",value:function(t,e){return t.x*e.y-t.y*e.x}},{key:"crossZ",value:function(t,e,n){return t.x=e.y*n,t.y=-e.x*n,t}},{key:"zCrossVector",value:function(t,e,n){return t.x=-e*n.y,t.y=e*n.x,t}},{key:"plus",value:function(t,e,n){return t.x=e.x+n.x,t.y=e.y+n.y,t}},{key:"sub",value:function(t,e,n){return t.x=e.x-n.x,t.y=e.y-n.y,t}},{key:"TEMP_VECTORS",get:function(){return null==o&&(o=[new t(0,0),new t(0,0),new t(0,0),new t(0,0)]),o}}]),a(t,[{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"subtract",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"multiply",value:function(t){return this.x*=t,this.y*=t,this}},{key:"split",value:function(e,n){var r=Math.max(e,n),a=Math.min(e,n);console.log(r,a);var i=Math.PI-(r-a),u=this.magnitude/Math.sin(i),l=r-this.radian,o=Math.PI-l-i,s=u*Math.sin(o),f=u*Math.sin(l),h=t.createVector(f,a),c=t.createVector(s,r);h.add(c)}},{key:"splitWithRightAngle",value:function(e){this.rotate(-e);var n=new t(this.x,0),r=new t(0,this.y);return n.rotate(e),r.rotate(e),this.rotate(e),{hVector:n,vVector:r}}},{key:"reverse",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"rotate",value:function(t){var e=this.radian+t,n=this.magnitude;this.x=Math.abs(n)*Math.cos(e),this.y=Math.abs(n)*Math.sin(e)}},{key:"clone",value:function(){return new t(this.x,this.y)}}],[{key:"createVector",value:function(e,n){var r=Math.abs(e)*Math.cos(n);Math.abs(r)<u.default.EPSILON&&(r=0);var a=Math.abs(e)*Math.sin(n);return Math.abs(a)<u.default.EPSILON&&(a=0),new t(r,a)}}]),t}();e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=l(n(2)),i=l(n(3)),u=l(n(0));function l(t){return t&&t.__esModule?t:{default:t}}var o=new a.default(0,0,0),s=new a.default(0,0,0),f=new Float32Array(1),h=new a.default,c=new a.default(0,0,0),d=new a.default(0,0,0),y=new a.default(0,0,0),v=new a.default(0,0,0),g=new a.default(0,0,0),x=new a.default(0,0,0),b=new a.default(0,0,0),p=new a.default(0,0,0),m=new a.default(0,0,0),k=new a.default(0,0,0),M=new a.default(0,0,0),w=new a.default(0,0,0),P=new a.default(0,0,0),T=new a.default(0,0,0),S=new a.default(0,0,0),D=new a.default(0,0,0),I=new a.default(0,0,0),_=new a.default,A=new a.default(0,0,0),E=new a.default(0,0,0),N=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return r(t,null,[{key:"generateRectanglesPoints",value:function(t,e,n,r,u){null==t&&(t=1);var l=(r=r||{}).setPoint,E=r.addPoint,N=[];if(null==l&&(l=function(t,e){N[e*=3]=t.x,N[e+1]=t.y,N[e+2]=t.z}),null==E&&(E=function(t){N.push(t.x),N.push(t.y),N.push(t.z)}),f[0]=t/2,0,null==u||u.getPointsNum()<2)return 0;h.x=n[0],h.y=n[1],h.z=n[2];var C=u.getPointsNum(),O={r1:null,r2:null,r3:null,r4:null},L=C-1;a.default.normalize(h,h),e&&L++;for(var F=0;F<L;F++){o.x=u.getX(F),o.y=u.getY(F),o.z=u.getZ(F);var R=F+1;R>=C&&(R=0),s.x=u.getX(R),s.y=u.getY(R),s.z=u.getZ(R),A.x=s.x-o.x,A.y=s.y-o.y,A.z=s.z-o.z;var B=a.default.TEMP_VECTORS[0];a.default.cross(B,A,h),a.default.normalize(B,B),B.x*=f[0],B.y*=f[0],B.z*=f[0],a.default.plus(g,B,o),a.default.plus(x,B,s),B.x=-B.x,B.y=-B.y,B.z=-B.z,a.default.plus(b,B,s),a.default.plus(p,B,o);var z=O.r1,V=O.r4,j=O.r2,U=O.r3;null!=z&&this.updateConnectPoints(z,j,U,V,g,x,b,p,F,A,h,N,l),E(g,F,0),E(x,F,1),E(b,F,2),E(p,F,3),c.value[0]=g.value[0],c.value[1]=g.value[1],c.value[2]=g.value[2],d.value[0]=x.value[0],d.value[1]=x.value[1],d.value[2]=x.value[2],y.value[0]=b.value[0],y.value[1]=b.value[1],y.value[2]=b.value[2],v.value[0]=p.value[0],v.value[1]=p.value[1],v.value[2]=p.value[2],0==F&&(m.value[0]=g.value[0],m.value[1]=g.value[1],m.value[2]=g.value[2],k.value[0]=x.value[0],k.value[1]=x.value[1],k.value[2]=x.value[2],M.value[0]=b.value[0],M.value[1]=b.value[1],M.value[2]=b.value[2],w.value[0]=p.value[0],w.value[1]=p.value[1],w.value[2]=p.value[2]),F+1==L&&(P.value[0]=g.value[0],P.value[1]=g.value[1],P.value[2]=g.value[2],T.value[0]=x.value[0],T.value[1]=x.value[1],T.value[2]=x.value[2],S.value[0]=b.value[0],S.value[1]=b.value[1],S.value[2]=b.value[2],D.value[0]=p.value[0],D.value[1]=p.value[1],D.value[2]=p.value[2]),O.r1=c,O.r2=d,O.r3=y,O.r4=v}if(e){var G=4*L;I.x=T.x-P.x,I.y=T.y-P.y,I.z=T.z-P.z;var H=I;a.default.normalize(H,H);var W=a.default.TEMP_VECTORS[1];W.x=m.x-k.x,W.y=m.y-k.y,W.z=m.z-k.z;var Y=_;a.default.cross(Y,W,h),a.default.normalize(Y,Y);var q=a.default.TEMP_VECTORS[0];i.default.calculateIntersectionOfPlane(Y,H,T,k,q),null!=q&&(l(q,0),l(q,G-3)),H.x=S.x-D.x,H.y=S.y-D.y,H.z=S.z-D.z,a.default.normalize(H,H),i.default.calculateIntersectionOfPlane(Y,H,S,w,q),null!=q&&(l(q,3),l(q,G-2))}return 0==N.length?L:N}},{key:"setPointValue",value:function(t,e,n,r,a){a[r*=3]=t,a[r+1]=e,a[r+2]=n}},{key:"updateRectPoint",value:function(t,e,n,r,a){var i=(n*=4)+1,u=i+1;null!=t&&a(t,i),null!=e&&a(e,u)}},{key:"updateConnectPoints",value:function(t,e,n,r,l,o,s,f,h,c,d,y,v){var g=2*u.default.getDistance(e,l),x=a.default.TEMP_VECTORS[0],b=I;b.x=e.x-t.x,b.y=e.y-t.y,b.z=e.z-t.z,a.default.normalize(b,b);var p=_;a.default.cross(p,c,d),a.default.normalize(p,p);var m=a.default.dot(p,b);if(Math.abs(m)<u.default.EPSILON)return l.x=e.x,l.y=e.y,l.z=e.z,f.x=n.x,f.y=n.y,void(f.z=n.z);i.default.calculateIntersectionOfPlane(p,b,e,l,E,g),null!=E&&(l.x=E.x,l.y=E.y,l.z=E.z),b.x=n.x-r.x,b.y=n.y-r.y,b.z=n.z-r.z,a.default.normalize(b,b),i.default.calculateIntersectionOfPlane(p,b,n,f,x,g),null!=x&&(f.x=x.x,f.y=x.y,f.z=x.z),this.updateRectPoint(E,x,h-1,y,v)}},{key:"addPoint",value:function(t,e){e.push(t.x),e.push(t.y),e.push(t.z)}}]),t}();e.default=N},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var a=void 0,i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return r(t,null,[{key:"projection",value:function(t,e){var n=this.identity();return n[0]=2/t,n[4]=-2/e,n[6]=-1,n[7]=1,n[8]=1,n}},{key:"identity",value:function(t){return null==t?((t=new Float32Array(9))[0]=1,t[4]=1,t[8]=1):(t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1),t}},{key:"translate",value:function(t,e,n){var r=void 0,a=void 0,i=void 0;return 3==arguments.length&&(i=t,this.identity(i),r=e,a=n),2==arguments.length&&(r=t,a=e,i=this.identity()),i[6]=r,i[7]=a,i}},{key:"rotate",value:function(t,e){var n=void 0,r=void 0;2==arguments.length&&(r=t,this.identity(r),n=e),1==arguments.length&&(n=t,r=this.identity());var a=Math.cos(n),i=Math.sin(n);return r[0]=a,r[1]=i,r[3]=-i,r[4]=a,r}},{key:"scale",value:function(t,e,n){var r=void 0,a=void 0,i=void 0;return 3==arguments.length&&(i=t,this.identity(i),r=e,a=n),2==arguments.length&&(r=t,a=e,i=this.identity()),i[0]=r,i[4]=a,i}},{key:"copy",value:function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]}},{key:"multiplyWithVertex",value:function(e,n,r){var a=void 0,i=void 0,u=void 0;3==arguments.length&&(a=n,i=e,u=r),2==arguments.length&&(a=e,u=n),null==i&&(i=t.identity());var l=a[0],o=a[1],s=a[2],f=a[3],h=a[4],c=a[5],d=a[6],y=a[7],v=a[8],g=u[0],x=u[1],b=u[2];return null==b&&(b=1),i[0]=g*l+x*f+b*d,i[1]=g*o+x*h+b*y,i[2]=g*s+x*c+b*v,i}},{key:"multiply",value:function(t,e,n){var r=e[0],a=e[1],i=e[2],u=e[3],l=e[4],o=e[5],s=e[6],f=e[7],h=e[8],c=n[0],d=n[1],y=n[2],v=n[3],g=n[4],x=n[5],b=n[6],p=n[7],m=n[8];return t[0]=c*r+d*u+y*s,t[1]=c*a+d*l+y*f,t[2]=c*i+d*o+y*h,t[3]=v*r+g*u+x*s,t[4]=v*a+g*l+x*f,t[5]=v*i+g*o+x*h,t[6]=b*r+p*u+m*s,t[7]=b*a+p*l+m*f,t[8]=b*i+p*o+m*h,t}},{key:"TEMP_MAT3",get:function(){return null==a&&(a=[t.identity(),t.identity(),t.identity(),t.identity()]),a}}]),t}();e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=u(n(23)),i=u(n(8));function u(t){return t&&t.__esModule?t:{default:t}}var l=Symbol("图片缓存"),o=Symbol("texture缓存"),s=Symbol("贴图表"),f=function(){function t(e,n,r,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.maxWidth=e||1,this.maxHeight=n||1,this.maxTextureNum=r||1,this[l]=[],this[o]=[],this[s]={},this.imageDataArray=new Array(this.maxTextureNum),this.textureArray=new Array(this.maxTextureNum),this.space=a||3}return r(t,[{key:"getMapLength",value:function(t){var e=0,n=void 0;for(n in t)t.hasOwnProperty(n)&&e++;return e}},{key:"getTexture",value:function(t,e,n){var r=this.imageCatch.indexOf(t);return-1==r?this.registerImageData(null,t,e,n):this[o][r]}},{key:"getTextureById",value:function(t,e){var n=this[s][t];return null!=e&&null!=n?n.splitedTextures[e]:n}},{key:"registerTexture",value:function(t,e,n,r,a,u){if(t=t||this.getMapLength(this[s]).toString(),null==n){if(null!=r){(n="undefined"!=typeof wx?wx.createImage():new Image).tid=t,n.crossOrigin="";var l=this;n.onload=function(t){var n=t.target,r=l.registerImageData(n.tid,n,e,!0);if(a){if(u){var o=u.column,s=u.row,f=s*o;f>1&&(r.splitedTextures.length=0);for(var h=n.width/o,c=n.height/s,d=0;d<f;d++){var y=Math.floor(d/o),v=Math.floor(d%o)*h,g=y*c,x=new i.default({id:n.tid+"_"+d,x:v+r.x,y:g+r.y,width:h,height:c,page:r.page});r.splitedTextures.push(x)}}a.success&&a.success(r)}},n.onerror=function(){a&&a.failed&&a.failed()},n.src=r}}else{var o=this.registerImageData(t,n,e,!0);a&&a.success&&a.success(o)}a&&a.complete&&a.complete()}},{key:"registerImageData",value:function(t,e,n,r){if(null!=e&&null!=e){null==r&&(r=!1);var u=0,l=0,f=e.width,h=e.height;if(f>this.maxWidth||h>this.maxHeight)throw new Error("图片大小超过了最大限制："+this.maxWidth+" x "+this.maxHeight);if(-1==this.imageCatch.indexOf(e)){var c=new a.default,d=c.getContext("2d");d.clearRect(0,0,c.width,c.height);for(var y=-1,v=0;v<this.imageDataArray.length;v++){var g=this.imageDataArray[v];if(null==g)g={imageData:void 0,startX:0,startY:0,width:0,height:0},this.imageDataArray[v]=g,c.width=e.width,c.height=e.height+1,u=0,l=1,d.fillStyle="#ffffff",d.fillRect(0,0,1,1),d.drawImage(e,0,1),g.imageData=d.getImageData(0,0,c.width,c.height),g.startX=c.width+this.space,g.startY=1,g.width=c.width,g.height=c.height;else{var x=e.width,b=e.height;if(u=g.startX,l=g.startY,u+x>this.maxWidth?(u=0,l=g.height+this.space,c.width=Math.max(g.width,x),c.height=l+b):(c.width=Math.max(g.width,u+x),c.height=Math.max(g.height,l+b)),l+b>this.maxHeight){console.error("图片超过贴图内存最大尺寸");continue}d.putImageData(g.imageData,0,0),d.drawImage(e,u,l),g.imageData=d.getImageData(0,0,c.width,c.height),g.startX=u+x+this.space,g.startY=l,g.width=c.width,g.height=c.height}y=v;break}if(-1!=y){this.imageCatch.push(e);var p=new i.default;return p.id=t,p.x=u,p.y=l,p.width=f,p.height=h,p.page=y,r&&this.createTexture(n,y,c),this[s][t]=p,this[o].push(p),p}}}else console.error("Image can not be null")}},{key:"createAllTexture",value:function(t){if(null!=t)for(var e=new a.default,n=0;n<this.textureArray.length;n++)this.createTexture(t,n,e)}},{key:"createTexture",value:function(e,n,r){if(null!=e&&null!=n&&-1!=n){null==r&&(r=new a.default);var i=r.getContext("2d"),u=this.textureArray[n],l=this.imageDataArray[n];null!=l&&(r.width=l.width,r.height=l.height,i.putImageData(l.imageData,0,0),null==u&&(u=e.createTexture(),this.textureArray[n]=u),e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),t.isPOT(r.width)&&t.isPOT(r.height)?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(e.TEXTURE_2D)):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.bindTexture(e.TEXTURE_2D,null))}}},{key:"cleanImageData",value:function(){this.imageCatch.length=0;for(var t=0;t<this.imageDataArray.length;t++){var e=this.imageDataArray[t];e&&(e.imageData=null)}}},{key:"imageCatch",get:function(){return this[l]}}],[{key:"isPOT",value:function(t){return t>0&&0==(t-1&t)}}]),t}();e.default=f},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.id=e.id,null!=e.x?this.x=e.x:this.x=-1,null!=e.y?this.y=e.y:this.y=-1,null!=e.width?this.width=e.width:this.width=-1,null!=e.height?this.height=e.height:this.height=-1,this.page=e.page||0,this.index=this.page,this.splitedTextures=[]}return r(t,[{key:"index",get:function(){return this.page},set:function(t){this.page=t}}]),t}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var a=void 0,i=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.singleDataByteLength=n,this.buffer=new ArrayBuffer(e*n),this.dv=new DataView(this.buffer),this.currentIndex=0,this.isLittleEndian=t.littleEndian()}return r(t,[{key:"init",value:function(){this.currentIndex=0}},{key:"getData",value:function(t,e,n){t*=this.singleDataByteLength,null==e&&(e=4),null==n&&(n=0),t+=n;var r=this.isLittleEndian;switch(e){case 8:return this.dv.getFloat64(t,r);case 1:return this.dv.getUint8(t);case 5:return this.dv.getInt8(t);case 2:return this.dv.getUint8(t);case 6:return this.dv.getInt16(t,r);case 3:return this.dv.getUint16(t,r);case 4:return this.dv.getFloat32(t,r);case 7:return this.dv.getInt32(t,r);case 0:return this.dv.getUint32(t,r)}}},{key:"setData",value:function(t,e,n,r){var a=this.isLittleEndian;switch(null==r&&(r=0),null==n&&(n=4),e*=this.singleDataByteLength,e+=r,n){case 8:this.dv.setFloat64(e,t,a);break;case 1:this.dv.setUint8(e,t);break;case 5:this.dv.setInt8(e,t);break;case 2:this.dv.setUint8(e,t);break;case 6:this.dv.setInt16(e,t,a);break;case 3:this.dv.setUint16(e,t,a);break;case 4:this.dv.setFloat32(e,t,a);break;case 7:this.dv.setInt32(e,t,a);break;case 0:this.dv.setUint32(e,t,a)}}},{key:"resize",value:function(t){if(t<this.totalByteLength)throw Error("new length should not less than old length");var e=this.buffer;this.buffer=new ArrayBuffer(t);var n=new Uint8Array(e);new Uint8Array(this.buffer).set(n,0),this.dv=new DataView(this.buffer)}},{key:"totalByteLength",get:function(){return this.buffer.byteLength}}],[{key:"littleEndian",value:function(){if(null==a){var t=new ArrayBuffer(2),e=new Uint8Array(t),n=new Uint16Array(t);return e[0]=170,e[1]=187,48042===n[0]&&(a=!0),43707===n[0]&&(a=!1),a}return a}},{key:"TYPE_FLOAT32",get:function(){return 4}},{key:"TYPE_FLOAT64",get:function(){return 8}},{key:"TYPE_UINT8",get:function(){return 2}},{key:"TYPE_UINT16",get:function(){return 3}},{key:"TYPE_UINT32",get:function(){return 0}},{key:"TYPE_INT8",get:function(){return 5}},{key:"TYPE_INT16",get:function(){return 6}},{key:"TYPE_INT32",get:function(){return 7}},{key:"TYPE_UINT8CLAMPED",get:function(){return 1}}]),t}();e.default=i},function(t,e,n){t.exports=n(11)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=c(n(12)),i=c(n(4)),u=c(n(2)),l=c(n(6)),o=c(n(1)),s=c(n(3)),f=c(n(7)),h=c(n(0));function c(t){return t&&t.__esModule?t:{default:t}}var d="color:yellow;background-color:grey",y={};!function t(e,n){var a=function(a){var i=e[a],u=i;"object"==(void 0===u?"undefined":r(u))&&t(i,u={}),Object.defineProperty(n,a,{get:function(){return u}})};for(var i in e)a(i)}({version:"1.0.1",WebGL2D:a.default,Vector2:i.default,Vector3:u.default,Mat3:l.default,Mat4:o.default,GeometryTools:s.default,TextureManager:f.default,Tools:h.default},y),console.group("%c ☭ TieLiFa (version 1.0.1) ☭ ",d),console.log("%c Developer 👨 → 老脸叔叔(Old Face Uncle) ",d),console.log("%c Email 📧 → 947734830@qq.com or deaocy@yeah.net ",d),console.log("%c Link 🔗 → http://github.com/eclipseglory/tielifa ",d),console.groupEnd(),e.default=y},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=w(n(13)),i=w(n(14)),u=w(n(15)),l=w(n(16)),o=w(n(17)),s=w(n(19)),f=w(n(22)),h=w(n(0)),c=w(n(1)),d=w(n(24)),y=w(n(25)),v=w(n(26)),g=w(n(2)),x=w(n(3)),b=w(n(4)),p=w(n(27)),m=w(n(29)),k=w(n(5)),M=w(n(8));function w(t){return t&&t.__esModule?t:{default:t}}var P=Symbol("对应的Canvas"),T=Symbol("状态栈"),S=Symbol("路径列表"),D=Symbol("绘制动作List"),I=Symbol("子Path缓存"),_=" ".charCodeAt(0),A=new Float32Array(4),E=new Float32Array(4),N=[255,255,255],C=[new Float32Array(4),new Float32Array(4),new Float32Array(4),new Float32Array(4)],O=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),null!=n&&null!=n||(n=[]);for(var r=0;r<C.length;r++)C[r][3]=1;if(A[2]=1,A[3]=1,E[3]=1,this[P]=e,null==e||null==e)throw new Error("canvas can not be undefined or null");if(this.gl=e.getContext("webgl"),null==this.gl)throw new Error("Current canvas doesnt support WebGL");var a=n.FOV||20,i=Math.tan(a*Math.PI/180);this.defaultDepth=-e.height/(2*i),this.maxBufferByteLength=n.maxMemorySize||1048576,this[T]=[],this[S]=[],this[D]=[],this[I]=[],this.webglRender=new f.default(this.gl,n.maxTransformNum,n.maxTextureSize,n.projectionType,a,n.enableLight,n.enableDepthTest);var u=this.maxBufferByteLength/32;this.verticesData=new d.default(u),this.indexData=new m.default(u),this.fragmentData=new y.default(u),this.transformMatrixData=new v.default(u),this.webglRender.verticesData=this.verticesData,this.webglRender.fragmentData=this.fragmentData,this.webglRender.transformMatrixData=this.transformMatrixData,this.webglRender.indexData=this.indexData,this.currentFaceNormal=new Float32Array(4),this.currentFaceNormal[2]=1,this._tempPathArray=null,this._tempActionList=null,this._tempGraphics=null,this._painedGraphicsMap={},this.fontManager=new p.default,this.tempVDOArrays={verticesData:null,fragmentData:null,indexData:null,transformMatrixData:null},this.currentVDOArrays={verticesData:this.verticesData,fragmentData:this.fragmentData,indexData:this.indexData,transformMatrixData:this.transformMatrixData}}return r(t,[{key:"clean",value:function(){this[S].length=0,this.webglRender.clean()}},{key:"clearRect",value:function(t,e,n,r){this.clean()}},{key:"beginPath",value:function(){this.currentPath.clean()}},{key:"closePath",value:function(){var t=this.currentPath;if(0!=t.subPathNumber){var e=t.lastSubPath;e.close();var n=e.getPointX(0),r=e.getPointX(0),a=e.getPointX(0),i=e.getPointStateId(0),u=new l.default;u.addPoint(n,r,a,i),t.addSubPath(u)}}},{key:"lineTo",value:function(t,e,n){null==n&&(n=0);var r=this.currentPath;if(null==r.lastSubPath){var a=new l.default;return r.addSubPath(a),void this.addPointInLastSubPath(t,e,n,!0)}this.addPointInLastSubPath(t,e,n,!0)}},{key:"addPointInPath",value:function(t,e,n,r,a){var i=this.currentContextState,u=i.transformMatrix;if(a&&!c.default.isIdentity(u)){var l=C[0];l[0]=t,l[1]=e,l[2]=n,l[3]=1,c.default.multiplyWithVertex(u,l,l),t=l[0],e=l[1],n=l[2]}r.addPoint(t,e,n,i.id)}},{key:"addPointInLastSubPath",value:function(t,e,n,r){this.addPointInPath(t,e,n,this.currentPath.lastSubPath,r)}},{key:"moveTo",value:function(t,e,n){null==n&&(n=0);var r=this.currentContextState,a=this.currentPath,i=a.lastSubPath;if(null!=i&&i.pointsNumber<2){var u=r.transformMatrix,o=C[0];o[0]=t,o[1]=e,o[2]=n,o[3]=1;var s=c.default.multiplyWithVertex(u,o,o);0!=i.pointsNumber?i.setPoint(0,s[0],s[1],s[2],r.id):i.addPoint(s[0],s[1],s[2],r.id)}else{var f=new l.default;a.addSubPath(f),this.addPointInLastSubPath(t,e,n,!0)}}},{key:"rect",value:function(t,e,n,r,a){null==a&&(a=0),this.moveTo(t,e,a),this.lineTo(t+n,e,a),this.lineTo(t+n,e+r,a),this.lineTo(t,e+r,a),this.closePath()}},{key:"bezierCurveTo",value:function(t,e,n,r,a,i){var u,l=t,o=e,s=this.currentPath,f=(this.currentContextState,s.lastSubPath),h=C[0];h[0]=t,h[1]=e,h[2]=0,h[3]=1;var d=this.currentContextState.transformMatrix;c.default.multiplyWithVertex(d,h,h),t=h[0],e=h[1],u=h[2],h[0]=n,h[1]=r,h[2]=0,h[3]=1,c.default.multiplyWithVertex(d,h,h),n=h[0],r=h[1],h[0]=a,h[1]=i,h[2]=0,h[3]=1,c.default.multiplyWithVertex(d,h,h),a=h[0],i=h[1];var y=t,v=e;if(null==f)this.moveTo(l,o);else{var g=f.pointsNumber-1,b=f.getPointX(g),p=f.getPointY(g);b!=t&&p!=e&&(y=b,v=p)}var m=6*(a-3*n+3*t-y),k=6*(i-3*r+3*e-v),M=1/(m*m+k*k);Math.pow(M,1/6);for(var w=C[0],P=.01;P<=1;P+=.01)x.default.cubicBezier(P,y,v,t,e,n,r,a,i,w),this.addPointInLastSubPath(w[0],w[1],u,!1);this.addPointInLastSubPath(a,i,u,!1)}},{key:"quadraticCurveTo",value:function(t,e,n,r){var a=this.currentPath,i=(this.currentContextState,a.lastSubPath),u=C[0];u[0]=t,u[1]=e,u[2]=0,u[3]=1;var o=this.currentContextState.transformMatrix;c.default.multiplyWithVertex(o,u,u),t=u[0],e=u[1];var s=u[2];u[0]=n,u[1]=r,u[2]=0,u[3]=1,c.default.multiplyWithVertex(o,u,u),n=u[0],r=u[1];var f=u[2],h=t,d=e;if(null==i){var y=new l.default;a.addSubPath(y),this.addPointInLastSubPath(t,e,s,!1)}else{var v=i.pointsNumber-1,g=i.getPointX(v),b=i.getPointY(v);g!=t&&b!=e&&(h=g,d=b)}if(h!=t||d!=e){for(var p=2*(n-2*t+h),m=2*(r-2*e+d),k=1/(p*p+m*m),M=Math.pow(k,.25),w=C[0],P=M;P<=1;P+=M)x.default.quadraticBezier(P,h,d,t,e,n,r,w),this.addPointInLastSubPath(w[0],w[1],s,!1);this.addPointInLastSubPath(n,r,f,!1)}else this.addPointInLastSubPath(n,r,f,!1)}},{key:"arcTo",value:function(t,e,n,r,a){if(a<0)throw new Error("IndexError: Radius value wrong");var i=this.currentPath.lastSubPath,u=0,o=0;if(null==i)return i=new l.default,this.currentPath.addSubPath(i),void this.moveTo(t,e);var s=i.getPointX(i.pointsNumber-1),f=i.getPointY(i.pointsNumber-1),d=i.getPointZ(i.pointsNumber-1),y=C[0];y[0]=s,y[1]=f,y[2]=d,y[3]=1;var v=this.currentContextState.transformMatrix,g=c.default.TEMP_MAT4[0];if(c.default.copy(v,g),c.default.inverse(g,g),c.default.multiplyWithVertex(g,y,y),h.default.equals(s,t)&&h.default.equals(f,e)||h.default.equals(t,n)&&h.default.equals(e,r)||0==a)this.lineTo(t,e);else{u=y[0],o=y[1];var p=new b.default(u-t,o-e),m=new b.default(n-t,r-e);b.default.normalize(p,p),b.default.normalize(m,m);var k=new b.default;b.default.plus(k,p,m),b.default.normalize(k,k);var M=Math.acos(b.default.dot(p,k));if(h.default.equals(2*M%Math.PI,0))this.lineTo(t,e);else{var w=a/Math.sin(M),P=k.x*w+t,T=k.y*w+e,S={x:P,y:T},D={x:t,y:e},I={x:u,y:o},_={x:n,y:r},A=x.default.getProjectionPointOnLine(S,D,I),E=x.default.getProjectionPointOnLine(S,D,_),N=new b.default(A.x-P,A.y-T),O=new b.default(E.x-P,E.y-T);b.default.normalize(N,N),b.default.normalize(O,O);var L=Math.atan2(N.y,N.x),F=L;F=V(F);var R=Math.atan2(O.y,O.x),B=R;B=V(B);var z=!1;Math.abs(F-B)>Math.PI&&(z=!0),this.arc(P,T,a,L,R,z)}}function V(t){var e=2*Math.PI,n=Math.floor(Math.abs(t/e));return t<0&&(t+=n*e),t>=e&&(t-=n*e),t}}},{key:"ellipse",value:function(t,e,n,r,a,i,u,o){if(n<0||r<0)throw new Error("IndexError.半径必须不小于0. Radius should not be smaller than zero. BanJing BiXu BuXiaoYu Ling");if(0!=n&&0!=r){null==o&&(o=!1);var s=this.currentPath.lastSubPath;null==s&&(s=new l.default,this.currentPath.addSubPath(s));var f=c.default.TEMP_MAT4[0];c.default.translationMatrix(f,t,e,0);var d=this.currentContextState.transformMatrix;c.default.multiply(f,d,f);var y=c.default.TEMP_MAT4[1];c.default.rotationZMatrix(y,a),c.default.multiply(f,f,y),c.default.identityMatrix(y),y[0]=n,y[5]=r,c.default.multiply(f,f,y);var v=C[0];v[0]=0,v[1]=0,v[2]=0,v[3]=1,c.default.multiplyWithVertex(d,v,v);var x=v[0],b=v[1];v[0]=1,v[1]=0,v[2]=0,v[3]=1,c.default.multiplyWithVertex(d,v,v);var p=v[0],m=v[1],k=(p-x)*(p-x)+(m-b)*(m-b);k=Math.sqrt(k);var M=Math.max(n*k,r*k),w=2*Math.asin(1/M),P=new g.default;if(((i=O(i))>(u=O(u))&&!o||i<u&&o)&&((i<0||u<0)&&((u-=2*Math.PI)==i||Math.abs(u-i)<=h.default.EPSILON)&&(u-=2*Math.PI),(i>0||u>0)&&((u+=2*Math.PI)==i||Math.abs(u-i)<=h.default.EPSILON)&&(u+=2*Math.PI)),o)for(var T=i;T>u;T-=w){if(Math.abs(T-i)>=h.default.PI2)return;var S=Math.sin(T),D=Math.cos(T);P.x=D,P.y=S,P.z=0,c.default.multiplyWithVertex(f,P.value,P.value),this.addPointInLastSubPath(P.x,P.y,P.z,!1)}else for(var I=i;I<u;I+=w){if(Math.abs(I-i)>=h.default.PI2)return;var _=Math.sin(I),A=Math.cos(I);P.x=A,P.y=_,P.z=0,c.default.multiplyWithVertex(f,P.value,P.value),this.addPointInLastSubPath(P.x,P.y,P.z,!1)}var E=Math.sin(u),N=Math.cos(u);P.x=N,P.y=E,P.z=0,c.default.multiplyWithVertex(f,P.value,P.value),this.addPointInLastSubPath(P.x,P.y,P.z,!1)}function O(t){var e=2*Math.PI,n=Math.floor(Math.abs(t/e))+1;return t<0&&!o&&(t+=n*e),t>0&&o&&(t-=n*e),t}}},{key:"arc",value:function(t,e,n,r,a,i){this.ellipse(t,e,n,n,0,r,a,i)}},{key:"save",value:function(){var t=this.currentContextState.clone();this[T].push(t)}},{key:"restore",value:function(){0!=this[T].length&&this[T].pop()}},{key:"translate",value:function(t,e,n){this.currentContextState.translate(t,e,n)}},{key:"rotate",value:function(t){this.currentContextState.rotateZ(t)}},{key:"rotateX",value:function(t){this.currentContextState.rotateX(t)}},{key:"rotateY",value:function(t){this.currentContextState.rotateY(t)}},{key:"scale",value:function(t,e,n){this.currentContextState.scale(t,e,n)}},{key:"setTransform",value:function(t,e,n,r,a,i){c.default.identityMatrix(this.currentContextState.transformMatrix);var u=this.currentContextState.transformMatrix;u[0]=t,u[1]=e,u[4]=n,u[5]=r,u[12]=a,u[13]=i,u[14]=0}},{key:"transform",value:function(t,e,n,r,a,i){var u=c.default.TEMP_MAT4[0];c.default.identityMatrix(u),u[0]=t,u[1]=e,u[4]=n,u[5]=r,u[12]=a,u[13]=i,this.currentContextState.applyTransform(u)}},{key:"applyTransformMatrix",value:function(t){this.currentContextState.applyTransform(t)}},{key:"drawImage",value:function(t,e,n,r,a,i,u,l,o,f,h){f=f||0;var c=void 0;c=t instanceof M.default?t:this.webglRender.textureManager.getTexture(t,this.gl,!0);var d=new s.default(s.default.ACTION_FILL);d.textureIndex=c.index;var y=void 0,v=void 0,g=void 0,x=void 0,b=void 0,p=void 0,m=void 0,k=void 0;3==arguments.length&&(y=e,v=n,g=e+t.width,x=n+t.height,b=c.x,m=c.x+c.width,p=c.y,k=c.y+c.height),4==arguments.length&&(y=e,v=n,g=e+t.width,x=n+t.height,b=c.x,m=c.x+c.width,p=c.y,k=c.y+c.height,f=r),5==arguments.length&&(y=e,v=n,g=e+r,x=n+a,b=c.x,m=c.x+c.width,p=c.y,k=c.y+c.height),6==arguments.length&&(y=e,v=n,g=e+r,x=n+a,b=c.x,m=c.x+c.width,p=c.y,k=c.y+c.height,f=i),9!=arguments.length&&10!=arguments.length&&11!=arguments.length||(y=i,v=u,g=i+l,x=u+o,b=c.x+e,m=c.x+e+r,p=c.y+n,k=c.y+n+a),this.beginPath(),this.rect(y,v,g-y,x-v,f),this.currentPath.subPathArray[this.currentPath.subPathNumber-2].isRegularRect=!0;var w=this.currentContextState.globalAlpha,P=this[S];this[D].push(d);var T=new Array(4);T[0]=[b,p],T[1]=[m,p],T[2]=[m,k],T[3]=[b,k],h=h||N;var I=this.getVDOArrays();d.verticesData=I.verticesData,d.fragmentData=I.fragmentData,d.indexData=I.indexData,d.collectVertexDataForFill(P,h,w,T,this.currentContextState.filterType,this.currentFaceVector)}},{key:"fill",value:function(){var t=o.default.getInstance().convertStringToColor(this.currentContextState.fillStyle),e=this.currentContextState.globalAlpha,n=this[S],r=new s.default(s.default.ACTION_FILL),a=this.getVDOArrays();r.verticesData=a.verticesData,r.fragmentData=a.fragmentData,r.indexData=a.indexData,this[D].push(r),r.collectVertexDataForFill(n,t,e*t[3],[0,0],this.currentContextState.filterType,this.currentFaceVector)}},{key:"measureText",value:function(t,e){if(null==e){var n=this.fontFamily;if(n=n.trim().toLocaleLowerCase(),null==(e=this.fontManager.getBMFont(n)))throw new Error("TieLiFa can not find the font:"+n+",you can register the BM Font with API")}for(var r=t,a=0,i=this.fontSize/e.size,u=e.chars[" ".charCodeAt(0)],l=0;l<r.length;l++){var o=r.charCodeAt(l),s=e.chars[o];null!=s?a+=s.xadvance:a+=u.xadvance}return{width:a*i}}},{key:"fillText",value:function(t,e,n,r){var a=this.fontFamily;a=a.trim().toLocaleLowerCase();var i=this.fontManager.getBMFont(a);if(null==i)throw new Error("TieLiFa can not find the font:"+a+",you can register the BM Font with API");var u=t,l=this.fontSize,s=l/i.size;i.common.base;this.save(),this.translate(e,n),this.scale(s,s),this.translate(-e,-n);var f=o.default.getInstance().convertStringToColor(this.currentContextState.fillStyle),h=this.textBaseline,c=this.textAlign,d=this.measureText(t,i),y=1,v=d.width;if(null!=r&&r<d.width){if(0==r)return;y=r/d.width,v=r}"end"!=c&&"right"!=c||(e-=v/s),"center"==c&&(e-=v/s/2),"bottom"==h&&(n-=l/s),"middle"==h&&(n-=l/2/s);for(var g=i.chars[_],x=0;x<u.length;x++){var b=u.charCodeAt(x),p=i.chars[b];if(null!=p){var m=p.height,k=p.width;k*=y;var M=this.fontManager.getFontImage(a,p.page);null!=M&&null!=M&&(b!=_&&this.drawImage(M,p.x,p.y,p.width,p.height,e+p.xoffset*y,n+p.yoffset,k,m,0,f),e+=p.xadvance*y)}else e+=g.xadvance*y}this.restore()}},{key:"fillRect",value:function(t,e,n,r,a){a=a||0,this.beginPath(),this.rect(t,e,n,r,a),this.currentPath.subPathArray[this.currentPath.subPathNumber-2].isRegularRect=!0,this.fill()}},{key:"strokeRect",value:function(t,e,n,r,a){a=a||0,this.beginPath(),this.rect(t,e,n,r,a),this.stroke()}},{key:"stroke",value:function(){var t=o.default.getInstance().convertStringToColor(this.currentContextState.strokeStyle),e=this.currentContextState.globalAlpha,n=this[S],r=this.currentContextState.lineWidth,a=this.currentContextState.filterType,i=new s.default(s.default.ACTION_FILL),u=this.getVDOArrays();i.verticesData=u.verticesData,i.fragmentData=u.fragmentData,i.indexData=u.indexData,this[D].push(i),i.collectVertexDataForStroke(n,t,e*t[3],[0,0],r,a,this.currentFaceVector)}},{key:"createImageData",value:function(t,e){if(1==arguments.length){var n=t;t=n.width,e=n.height}var r=new Uint8ClampedArray(t*e*4);return new ImageData(r,t,e)}},{key:"applyCurrentTransform",value:function(t){var e=this.currentContextState.transformMatrix,n=C[0];return n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=1,c.default.multiplyWithVertex(e,n,n),{x:n[0],y:n[1],z:n[2]}}},{key:"drawGraphics",value:function(t,e,n){if(null==this._tempGraphics){for(var r=0;r<t.actionList.length;r++){var a=t.actionList[r],i=new s.default(a.type);if(i.textureIndex=a.textureIndex,i.renderPointNumber=a.renderPointNumber,null!=e&&null!=n){if(0!=e||0!=n){var u=c.default.translation(e,n,0);c.default.multiply(u,this.currentContextState.transformMatrix,u),i=u}}else i.applyMatrix=this.currentContextState.transformMatrix;this[D].push(i)}var l=this.getVDOArrays(),o=l.verticesData.currentIndex,f=this._painedGraphicsMap[t];if(null==f){l.verticesData.append(t.verticesData),l.fragmentData.append(t.fragmentData),f={start:l.indexData.currentIndex,length:t.indexData.currentIndex};for(var h=0;h<t.indexData.currentIndex;h++)l.indexData.addIndex(t.indexData.getIndex(h)+o);this._painedGraphicsMap[t]=f}else for(var d=0;d<f.length;d++){var y=l.indexData.getIndex(d+f.start);l.indexData.addIndex(y)}}}},{key:"getVDOArrays",value:function(){return this.currentVDOArrays}},{key:"setVDOArrays",value:function(t,e,n,r){this.currentVDOArrays.verticesData=t,this.currentVDOArrays.fragmentData=e,this.currentVDOArrays.transformMatrixData=n,this.currentVDOArrays.indexData=r}},{key:"startGraphics",value:function(t,e){if(null==this._tempGraphics){e=e||4,this._tempPathArray=this[S],this[S]=[],this[S].push(new u.default);var n=new a.default(new i.default);this[T].push(n),null!=t?(t.verticesData.init(),t.fragmentData.init(),t.indexData.init(),t.actionList.length=0):t={verticesData:new d.default(e),fragmentData:new y.default(e),indexData:new m.default(e),transformMatrixData:null,actionList:[]},this.tempVDOArrays.verticesData=t.verticesData,this.tempVDOArrays.fragmentData=t.fragmentData,this.tempVDOArrays.indexData=t.indexData,this._tempGraphics=t,this._tempActionList=this[D],this[D]=t.actionList,this.setVDOArrays(this.tempVDOArrays.verticesData,this.tempVDOArrays.fragmentData,null,this.tempVDOArrays.indexData)}}},{key:"endGraphics",value:function(){this[T].pop(),this[S]=this._tempPathArray,this[D]=this._tempActionList,this.currentVDOArrays.verticesData=this.verticesData,this.currentVDOArrays.fragmentData=this.fragmentData,this.currentVDOArrays.transformMatrixData=this.transformMatrixData,this.currentVDOArrays.indexData=this.indexData,this._tempPathArray=null,this._tempActionList=null,this.tempVDOArrays.verticesData=null,this.tempVDOArrays.fragmentData=null,this.tempVDOArrays.indexData=null,this.tempVDOArrays.transformMatrixData=null;var t=this._tempGraphics;return this._tempGraphics=null,t}},{key:"loadBMFont",value:function(t,e){e=e||{},this.fontManager.loadBMFont(t,this.webglRender.textureManager,this.gl,e)}},{key:"turnOnLight",value:function(){this.webglRender.enableLight(!0)}},{key:"turnOffLight",value:function(){this.webglRender.enableLight(!1)}},{key:"setLightPosition",value:function(t,e,n){this.webglRender.setLightPosition(t,e,n)}},{key:"fillOrStroke",value:function(t,e){null!=t&&(this.fillStyle=t,this.fill()),null!=e&&(this.strokeStyle=e,this.stroke())}},{key:"fillStripe",value:function(t,e,n,r,a,i){if(null==i&&(i=!0),i){for(var u=[],l=0;l<t.length;l++){var o=this.applyCurrentTransform(t[l]);u.push(o)}t=u}var s={getX:function(e){return t[e].x},getY:function(e){return t[e].y},getZ:function(e){var n=t[e].z;return null==n?0:n},getPointsNum:function(){return t.length}};this._rawFillLine(s,e,n,r,void 0,a)}},{key:"_rawFillLine",value:function(t,e,n,r,a,i){var u=t.getPointsNum();if(!(u<2)){var l=this.getVDOArrays(),f=this.currentFaceVector;r=r||this.currentContextState.globalAlpha,a=a||this.currentContextState.filterType,n=n||this.currentContextState.fillStyle;var h=o.default.getInstance().convertStringToColor(n),c=l.verticesData.currentIndex,d=null;i&&(d=this.webglRender.textureManager.getTexture(i,this.gl,!0));var y=0,v=0;null!=d&&(y=d.width/(u-1),v=d.height);for(var g={setPoint:function(t,e){l.verticesData.setVerticesCoor(t.x,t.y,t.z,e+c)},addPoint:function(t,e,n){if(null!=l.verticesData&&l.verticesData.addVerticesData(t.x,t.y,t.z,f[0],f[1],f[2]),null!=l.fragmentData){var i=[0,0];null!=d&&(0==e?(0==n&&(i[0]=e*y,i[1]=0),3==n&&(i[0]=e*y,i[1]=v)):(0==n&&(i[0]=(e-1)*y+y,i[1]=0),3==n&&(i[0]=(e-1)*y+y,i[1]=v)),1==n&&(i[0]=e*y+y,i[1]=0),2==n&&(i[0]=e*y+y,i[1]=v)),l.fragmentData.addFragmentData(h[0],h[1],h[2],r,i[0],i[1],-1,a)}}},x=k.default.generateRectanglesPoints(e,!1,f,g,t),b=0;b<x;b++){var p=4*b;l.indexData.addIndex(c+p),l.indexData.addIndex(c+p+1),l.indexData.addIndex(c+p+2),l.indexData.addIndex(c+p+2),l.indexData.addIndex(c+p+3),l.indexData.addIndex(c+p)}var m=new s.default(s.default.ACTION_FILL);m.textureIndex=-1,null!=d&&(m.textureIndex=d.index),m.renderPointNumber=6*x,this[D].push(m)}}},{key:"drawRectangle",value:function(t,e,n,r,a,i){this.save(),this.beginPath(),this.rect(t,e,n,r),this.currentPath.subPathArray[this.currentPath.subPathNumber-2].isRegularRect=!0,this.fillOrStroke(a,i),this.restore()}},{key:"drawEllipse",value:function(t,e,n,r,a,i,u){u=u||0,this.save(),this.beginPath(),this.ellipse(t,e,n,r,u,0,h.default.PI2,!1),this.closePath(),this.fillOrStroke(a,i),this.restore()}},{key:"drawCircle",value:function(t,e,n,r,a){this.drawEllipse(t,e,n,n,r,a,0)}},{key:"draw",value:function(){null==this._tempGraphics&&(this.webglRender.initRending(),this.webglRender.executeRenderAction(this[D]),this[D]=[],this.verticesData.init(),this.fragmentData.init(),this.transformMatrixData.init(),this.indexData.init(),this._painedGraphicsMap={})}},{key:"loadImage",value:function(t,e,n,r){this.webglRender.textureManager.registerTexture(t,this.gl,null,e,n,r)}},{key:"getTexture",value:function(t,e){return this.webglRender.textureManager.getTextureById(t,e)}},{key:"clearImageCatches",value:function(){this.webglRender.textureManager.cleanImageData()}},{key:"currentContextState",get:function(){if(0==this[T].length){var t=new a.default(new i.default);this[T].push(t)}return this[T][this[T].length-1]}},{key:"currentPath",get:function(){return 0==this[S].length&&this[S].push(new u.default),this[S][this[S].length-1]}},{key:"canvas",get:function(){return this[P]}},{key:"strokeStyle",set:function(t){this.currentContextState.strokeStyle=t},get:function(){return this.currentContextState.strokeStyle}},{key:"currentFaceVector",get:function(){var t=this.currentContextState.transformMatrix,e=g.default.TEMP_VECTORS[0],n=g.default.TEMP_VECTORS[1];return e.x=A[0],e.y=A[1],e.z=A[2],e.value[3]=1,n.x=E[0],n.y=E[1],n.z=E[2],n.value[3]=1,c.default.isIdentity(t)||(c.default.multiplyWithVertex(t,A,e.value),c.default.multiplyWithVertex(t,E,n.value)),this.currentFaceNormal[0]=e.x-n.x,this.currentFaceNormal[1]=e.y-n.y,this.currentFaceNormal[2]=e.z-n.z,this.currentFaceNormal}},{key:"fontFamily",get:function(){return this.currentContextState.canvasDrawingStyle.fontFamily},set:function(t){this.currentContextState.canvasDrawingStyle.fontFamily=t}},{key:"fontSize",get:function(){return this.currentContextState.canvasDrawingStyle.fontSize},set:function(t){this.currentContextState.canvasDrawingStyle.fontSize=t}},{key:"fillStyle",set:function(t){this.currentContextState.fillStyle=t},get:function(){return this.currentContextState.fillStyle}},{key:"globalAlpha",set:function(t){this.currentContextState.globalAlpha=t},get:function(){return this.currentContextState.globalAlpha}},{key:"lineWidth",set:function(t){this.currentContextState.lineWidth=t},get:function(){return this.currentContextState.lineWidth}},{key:"textAlign",get:function(){return this.currentContextState.textAlign},set:function(t){this.currentContextState.textAlign=t}},{key:"textBaseline",get:function(){return this.currentContextState.textBaseline},set:function(t){this.currentContextState.textBaseline=t}},{key:"filterType",get:function(){return this.currentContextState.filterType},set:function(t){this.currentContextState.filterType=t}}],[{key:"Normal_Filter",get:function(){return a.default.Normal_Filter}},{key:"GaussianBlur_Filter",get:function(){return a.default.GaussianBlur_Filter}},{key:"Unsharpen_Filter",get:function(){return a.default.Unsharpen_Filter}},{key:"Sharpness_Filter",get:function(){return a.default.Sharpen_Filter}},{key:"Sharpen_Filter",get:function(){return a.default.Sharpen_Filter}},{key:"EdgeDetect_Filter",get:function(){return a.default.EdgeDetect_Filter}},{key:"SobelHorizontal_Filter",get:function(){return a.default.SobelHorizontal_Filter}},{key:"SobelVertical_Filter",get:function(){return a.default.SobelVertical_Filter}},{key:"PrevitHorizontal_Filter",get:function(){return a.default.PrevitHorizontal_Filter}},{key:"PrevitVertical_Filter",get:function(){return a.default.PrevitVertical_Filter}},{key:"BoxBlur_Filter",get:function(){return a.default.BoxBlur_Filter}},{key:"TriangleBlur_Filter",get:function(){return a.default.TriangleBlur_Filter}},{key:"Emboss_Filter",get:function(){return a.default.Emboss_Filter}}]),t}();e.default=O},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=u(n(1)),i=u(n(0));function u(t){return t&&t.__esModule?t:{default:t}}var l=0,o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvasDrawingStyle=e,this.matrixIndex=0,this.fillStyle="#000000",this.strokeStyle="#000000",this.globalAlpha=1,this.id=-1,this.matrix=a.default.identity(),this.filterType=l,this.dirty=!1}return r(t,[{key:"setTransformMatrix",value:function(t){a.default.copy(t,this.matrix)}},{key:"applyTransform",value:function(t){var e=this.matrix;a.default.multiply(e,e,t)}},{key:"translate",value:function(t,e,n){if(void 0===n&&(n=0),!(i.default.equals(t,0)&&i.default.equals(e,0)&&i.default.equals(n,0))){var r=a.default.TEMP_MAT4[0];a.default.translationMatrix(r,t,e,n),this.applyTransform(r)}}},{key:"rotateZ",value:function(t){if(!i.default.equals(t,0)){var e=a.default.TEMP_MAT4[0];a.default.rotationZMatrix(e,t),this.applyTransform(e)}}},{key:"rotateX",value:function(t){if(!i.default.equals(t,0)){var e=a.default.TEMP_MAT4[0];a.default.rotationXMatrix(e,t),this.applyTransform(e)}}},{key:"rotateY",value:function(t){if(!i.default.equals(t,0)){var e=a.default.TEMP_MAT4[0];a.default.rotationYMatrix(e,t),this.applyTransform(e)}}},{key:"scale",value:function(t,e,n){if(void 0===n&&(n=1),!(i.default.equals(t,1)&&i.default.equals(e,1)&&i.default.equals(n,1))){var r=a.default.TEMP_MAT4[0];a.default.scalingMatrix(r,t,e,n),this.applyTransform(r)}}},{key:"clone",value:function(){var e=new t(this.canvasDrawingStyle.clone());return e.fillStyle=this.fillStyle,e.strokeStyle=this.strokeStyle,e.globalAlpha=this.globalAlpha,e.filterType=this.filterType,e.setTransformMatrix(this.transformMatrix),e}},{key:"transformMatrixId",get:function(){return t.matrixList.length-1}},{key:"transformMatrix",get:function(){return this.matrix}},{key:"lineWidth",get:function(){return this.canvasDrawingStyle.lineWidth},set:function(t){this.canvasDrawingStyle.lineWidth=t}},{key:"textAlign",get:function(){return this.canvasDrawingStyle.textAlign},set:function(t){this.canvasDrawingStyle.textAlign=t}},{key:"textBaseline",get:function(){return this.canvasDrawingStyle.textBaseline},set:function(t){this.canvasDrawingStyle.textBaseline=t}}],[{key:"Normal_Filter",get:function(){return l}},{key:"GaussianBlur_Filter",get:function(){return 1}},{key:"Unsharpen_Filter",get:function(){return 2}},{key:"Sharpness_Filter",get:function(){return 4}},{key:"Sharpen_Filter",get:function(){return 4}},{key:"EdgeDetect_Filter",get:function(){return 5}},{key:"SobelHorizontal_Filter",get:function(){return 6}},{key:"SobelVertical_Filter",get:function(){return 7}},{key:"PrevitHorizontal_Filter",get:function(){return 8}},{key:"PrevitVertical_Filter",get:function(){return 9}},{key:"BoxBlur_Filter",get:function(){return 10}},{key:"TriangleBlur_Filter",get:function(){return 11}},{key:"Emboss_Filter",get:function(){return 12}}]),t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var a=Symbol("线宽度,默认1"),i=Symbol('线连接样式，"butt", "round", "square" (默认: "butt")'),u=Symbol('线连接样式，"round", "bevel", "miter" (默认: "miter")'),l=Symbol("默认10"),o=Symbol('文字字体大小等，默认"10px sans-serif"'),s=Symbol('文字对齐,"start", "end", "left", "right", "center" (默认: "start")'),f=Symbol('文字纵向对齐，"top", "hanging", "middle", "alphabetic", "ideographic", "bottom" (默认: "alphabetic")'),h=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this[a]=1,this[i]="butt",this[u]="miter",this[l]=10,this.font="10px sans-serif",this.textAlign="start",this.textBaseline="alphabetic",this.fontFamily="Arial",this.fontSize=32}return r(t,[{key:"clone",value:function(){var e=new t;return e.textBaseline=this.textBaseline,e.textAlign=this.textAlign,e.font=this.font,e.lineCap=this.lineCap,e.lineJoin=this.lineJoin,e.lineWidth=this.lineWidth,e.fontFamily=this.fontFamily,e.fontSize=this.fontSize,e}},{key:"lineCap",get:function(){return this[i]},set:function(t){this[i]=t}},{key:"lineWidth",get:function(){return this[a]},set:function(t){this[a]=t}},{key:"lineJoin",get:function(){return this[u]},set:function(t){this[u]=t}},{key:"miterLimit",get:function(){return this[l]},set:function(t){this[l]=t}},{key:"font",get:function(){return this[o]},set:function(t){this[o]=t}},{key:"textAlign",get:function(){return this[s]},set:function(t){this[s]=t}},{key:"textBaseline",get:function(){return this[f]},set:function(t){this[f]=t}}]),t}();e.default=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.subPathArray=[]}return r(t,[{key:"addSubPath",value:function(t){this.subPathArray.push(t)}},{key:"clean",value:function(){this.subPathArray=[]}},{key:"subPathNumber",get:function(){return this.subPathArray.length}},{key:"lastSubPath",get:function(){if(0!=this.subPathNumber)return this.subPathArray[this.subPathNumber-1]}}]),t}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var a=Symbol("当前的点所在的索引位置"),i=Symbol("点的坐标值数组,每三个为一组，分别是x,y,z"),u=Symbol("点的坐标值数组，每两个为一组，分别是stateId,matrixId"),l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this[a]=0,this[i]=[],this[u]=[],this.isClosed=!1,this.isRegularRect=!1}return r(t,[{key:"init",value:function(){this.isClosed=!1,this[a]=0}},{key:"getPointX",value:function(t){return t*=3,this[i][t]}},{key:"getPointY",value:function(t){return t*=3,this[i][t+1]}},{key:"getPointZ",value:function(t){return t*=3,this[i][t+2]}},{key:"getPointStateId",value:function(t){return t*=2,this[u][t]}},{key:"getPointMatrixId",value:function(t){return t*=2,this[u][t+1]}},{key:"getPointMatrixData",value:function(t){return[this.getPointStateId(t),this.getPointMatrixId(t)]}},{key:"setPoint",value:function(t,e,n,r,a){a=a||0;t*=3,this[i][t]=e,this[i][t+1]=n,this[i][t+2]=r}},{key:"addPoint",value:function(t,e,n,r){r=r||0;var u=this[a];3*u>=this[i].length?(this[i].push(t),this[i].push(e),this[i].push(n)):(this[i][u]=t,this[i][u+1]=e,this[i][u+2]=n),this[a]++}},{key:"close",value:function(){this.isClosed=!0}},{key:"clean",value:function(){this[i]=[],this[u]=[],this.isClosed=!1}},{key:"pointsCoordinateArray",get:function(){return this[i]}},{key:"pointsNumber",get:function(){return this[a]}}]),t}();e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(18),u=(r=i)&&r.__esModule?r:{default:r};var l=void 0,o=function(){function t(){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),l)return l;l=this,this.colorMap={}}return a(t,[{key:"convertStringToColor",value:function(e){var n=this.colorMap[e];return null!=n?n:(e=e.toLowerCase(),t.isRGBAString(e)?this.rgba2vec(e):t.isHSLAString(e)?this.hsla2vet3(e):this.getVec(e,e,1))}},{key:"hsla2vet3",value:function(t){var e=t,n=this.colorMap[e];if(null!=n)return n;var r=1;if(3==(t=(t=t.match(new RegExp(",","g")))||[]).length){var a=(t=e).lastIndexOf(","),i=t.lastIndexOf(")"),u=t.substring(a+1,i);r=parseFloat(u),t=t.substring(0,a),t+=")"}else t=e;t=t.replace("a","");var l=w3color(t);return l.valid?(n=[l.r,l.g,l.b,r],this.colorMap[e]=n,n):[0,0,0,1]}},{key:"rgba2vec",value:function(t){var e=t,n=this.colorMap[e];if(null!=n)return n;var r=1;if(3==(t=(t=t.match(new RegExp(",","g")))||[]).length){var a=(t=e).lastIndexOf(","),i=t.lastIndexOf(")"),u=t.substring(a+1,i);r=parseFloat(u),t=t.substring(0,a),t+=")"}else t=e;return t=t.replace("a",""),this.getVec(t,e,r)}},{key:"getVec",value:function(t,e,n){var r=this.colorMap[e];if(null!=r)return r;var a=new u.default(t);if(a.valid){var i=a.toRgb(),l=[i.r,i.g,i.b,n];return null==this.colorMap[e]&&(this.colorMap[e]=l),l}return[0,0,0,1]}}],[{key:"getInstance",value:function(){return l||(l=new t),l}},{key:"isRGBAString",value:function(t){return!(!t||0!=t.indexOf("rgba"))}},{key:"isHSLAString",value:function(t){return!(!t||0!=t.indexOf("hsla"))}}]),t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var u=function(){function t(e,n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this instanceof t?"object"==(void 0===e?"undefined":r(e))?e:(this.attachValues(t.toColorObject(e)),void(n&&(n.style.backgroundColor=this.toRgbString()))):new t(e,n)}return a(t,[{key:"attachValues",value:function(t){this.red=t.red,this.green=t.green,this.blue=t.blue,this.hue=t.hue,this.sat=t.sat,this.lightness=t.lightness,this.whiteness=t.whiteness,this.blackness=t.blackness,this.cyan=t.cyan,this.magenta=t.magenta,this.yellow=t.yellow,this.black=t.black,this.ncol=t.ncol,this.opacity=t.opacity,this.valid=t.valid}},{key:"toRgbString",value:function(){return"rgb("+this.red+", "+this.green+", "+this.blue+")"}},{key:"toRgbaString",value:function(){return"rgba("+this.red+", "+this.green+", "+this.blue+", "+this.opacity+")"}},{key:"toHwbString",value:function(){return"hwb("+this.hue+", "+Math.round(100*this.whiteness)+"%, "+Math.round(100*this.blackness)+"%)"}},{key:"toHwbStringDecimal",value:function(){return"hwb("+this.hue+", "+this.whiteness+", "+this.blackness+")"}},{key:"toHwbaString",value:function(){return"hwba("+this.hue+", "+Math.round(100*this.whiteness)+"%, "+Math.round(100*this.blackness)+"%, "+this.opacity+")"}},{key:"toHslString",value:function(){return"hsl("+this.hue+", "+Math.round(100*this.sat)+"%, "+Math.round(100*this.lightness)+"%)"}},{key:"toHslStringDecimal",value:function(){return"hsl("+this.hue+", "+this.sat+", "+this.lightness+")"}},{key:"toHslaString",value:function(){return"hsla("+this.hue+", "+Math.round(100*this.sat)+"%, "+Math.round(100*this.lightness)+"%, "+this.opacity+")"}},{key:"toCmykString",value:function(){return"cmyk("+Math.round(100*this.cyan)+"%, "+Math.round(100*this.magenta)+"%, "+Math.round(100*this.yellow)+"%, "+Math.round(100*this.black)+"%)"}},{key:"toCmykStringDecimal",value:function(){return"cmyk("+this.cyan+", "+this.magenta+", "+this.yellow+", "+this.black+")"}},{key:"toNcolString",value:function(){return this.ncol+", "+Math.round(100*this.whiteness)+"%, "+Math.round(100*this.blackness)+"%"}},{key:"toNcolStringDecimal",value:function(){return this.ncol+", "+this.whiteness+", "+this.blackness}},{key:"toNcolaString",value:function(){return this.ncol+", "+Math.round(100*this.whiteness)+"%, "+Math.round(100*this.blackness)+"%, "+this.opacity}},{key:"toName",value:function(){var t,e,n,r=getColorArr("hexs");for(i=0;i<r.length;i++)if(t=parseInt(r[i].substr(0,2),16),e=parseInt(r[i].substr(2,2),16),n=parseInt(r[i].substr(4,2),16),this.red==t&&this.green==e&&this.blue==n)return getColorArr("names")[i];return""}},{key:"toHexString",value:function(){return"#"+toHex(this.red)+toHex(this.green)+toHex(this.blue)}},{key:"toRgb",value:function(){return{r:this.red,g:this.green,b:this.blue,a:this.opacity}}},{key:"toHsl",value:function(){return{h:this.hue,s:this.sat,l:this.lightness,a:this.opacity}}},{key:"toHwb",value:function(){return{h:this.hue,w:this.whiteness,b:this.blackness,a:this.opacity}}},{key:"toCmyk",value:function(){return{c:this.cyan,m:this.magenta,y:this.yellow,k:this.black,a:this.opacity}}},{key:"toNcol",value:function(){return{ncol:this.ncol,w:this.whiteness,b:this.blackness,a:this.opacity}}},{key:"isDark",value:function(t){var e=t||128;return(299*this.red+587*this.green+114*this.blue)/1e3<e}},{key:"saturate",value:function(t){var e,n,r;e=t/100||.1,this.sat+=e,this.sat>1&&(this.sat=1),n=hslToRgb(this.hue,this.sat,this.lightness),r=colorObject(n,this.opacity,this.hue,this.sat),this.attachValues(r)}},{key:"desaturate",value:function(t){var e,n,r;e=t/100||.1,this.sat-=e,this.sat<0&&(this.sat=0),n=hslToRgb(this.hue,this.sat,this.lightness),r=colorObject(n,this.opacity,this.hue,this.sat),this.attachValues(r)}},{key:"lighter",value:function(t){var e,n,r;e=t/100||.1,this.lightness+=e,this.lightness>1&&(this.lightness=1),n=hslToRgb(this.hue,this.sat,this.lightness),r=colorObject(n,this.opacity,this.hue,this.sat),this.attachValues(r)}},{key:"darker",value:function(t){var e,n,r;e=t/100||.1,this.lightness-=e,this.lightness<0&&(this.lightness=0),n=hslToRgb(this.hue,this.sat,this.lightness),r=colorObject(n,this.opacity,this.hue,this.sat),this.attachValues(r)}}],[{key:"w3color",value:function(t){function e(e,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,e){return this instanceof w3color?"object"==(void 0===t?"undefined":r(t))?t:(this.attachValues(toColorObject(t)),void(e&&(e.style.backgroundColor=this.toRgbString()))):new w3color(t,e)})},{key:"toColorObject",value:function(t){var e,n,r,a,i,u,l,o,s,f,h,c=[],d=[],y=[];if(e=(t=this.w3trim(t.toLowerCase())).substr(0,1).toUpperCase(),n=t.substr(1),o=1,"R"!=e&&"Y"!=e&&"G"!=e&&"C"!=e&&"B"!=e&&"M"!=e&&"W"!=e||isNaN(n)||6==t.length&&-1==t.indexOf(",")||(t="ncol("+t+")"),3==t.length||6==t.length||isNaN(t)||(t="ncol("+t+")"),t.indexOf(",")>0&&-1==t.indexOf("(")&&(t="ncol("+t+")"),"rgb"==t.substr(0,3)||"hsl"==t.substr(0,3)||"hwb"==t.substr(0,3)||"ncol"==t.substr(0,4)||"cmyk"==t.substr(0,4)){if("ncol"==t.substr(0,4)?(4==t.split(",").length&&-1==t.indexOf("ncola")&&(t=t.replace("ncol","ncola")),r="ncol",t=t.substr(4)):"cmyk"==t.substr(0,4)?(r="cmyk",t=t.substr(4)):(r=t.substr(0,3),t=t.substr(3)),a=3,u=!1,"a"==t.substr(0,1).toLowerCase()?(a=4,u=!0,t=t.substr(1)):"cmyk"==r&&(a=4,5==t.split(",").length&&(a=5,u=!0)),c=(t=(t=t.replace("(","")).replace(")","")).split(","),"rgb"==r){if(c.length!=a)return this.emptyObject();for(i=0;i<a;i++){if(""!=c[i]&&" "!=c[i]||(c[i]="0"),c[i].indexOf("%")>-1&&(c[i]=c[i].replace("%",""),c[i]=Number(c[i]/100),i<3&&(c[i]=Math.round(255*c[i]))),isNaN(c[i]))return this.emptyObject();parseInt(c[i])>255&&(c[i]=255),i<3&&(c[i]=parseInt(c[i])),3==i&&Number(c[i])>1&&(c[i]=1)}h={r:c[0],g:c[1],b:c[2]},1==u&&(o=Number(c[3]))}if("hsl"==r||"hwb"==r||"ncol"==r){for(;c.length<a;)c.push("0");for("hsl"!=r&&"hwb"!=r||parseInt(c[0])>=360&&(c[0]=0),i=1;i<a;i++){if(c[i].indexOf("%")>-1){if(c[i]=c[i].replace("%",""),c[i]=Number(c[i]),isNaN(c[i]))return this.emptyObject();c[i]=c[i]/100}else c[i]=Number(c[i]);Number(c[i])>1&&(c[i]=1),Number(c[i])<0&&(c[i]=0)}"hsl"==r&&(h=this.hslToRgb(c[0],c[1],c[2]),s=Number(c[0]),f=Number(c[1])),"hwb"==r&&(h=this.hwbToRgb(c[0],c[1],c[2])),"ncol"==r&&(h=this.ncolToRgb(c[0],c[1],c[2])),1==u&&(o=Number(c[3]))}if("cmyk"==r){for(;c.length<a;)c.push("0");for(i=0;i<a;i++){if(c[i].indexOf("%")>-1){if(c[i]=c[i].replace("%",""),c[i]=Number(c[i]),isNaN(c[i]))return this.emptyObject();c[i]=c[i]/100}else c[i]=Number(c[i]);Number(c[i])>1&&(c[i]=1),Number(c[i])<0&&(c[i]=0)}h=this.cmykToRgb(c[0],c[1],c[2],c[3]),1==u&&(o=Number(c[4]))}}else if("ncs"==t.substr(0,3))h=this.ncsToRgb(t);else{for(l=!1,d=this.getColorArr("names"),i=0;i<d.length;i++)if(t.toLowerCase()==d[i].toLowerCase()){y=this.getColorArr("hexs"),l=!0,h={r:parseInt(y[i].substr(0,2),16),g:parseInt(y[i].substr(2,2),16),b:parseInt(y[i].substr(4,2),16)};break}if(0==l){for(3==(t=t.replace("#","")).length&&(t=t.substr(0,1)+t.substr(0,1)+t.substr(1,1)+t.substr(1,1)+t.substr(2,1)+t.substr(2,1)),i=0;i<t.length;i++)if(!this.isHex(t.substr(i,1)))return this.emptyObject();for(c[0]=parseInt(t.substr(0,2),16),c[1]=parseInt(t.substr(2,2),16),c[2]=parseInt(t.substr(4,2),16),i=0;i<3;i++)if(isNaN(c[i]))return this.emptyObject();h={r:c[0],g:c[1],b:c[2]}}}return this.colorObject(h,o,s,f)}},{key:"colorObject",value:function(t,e,n,r){var a,i,u,l,o,s,f;return t?(e||(e=1),a=this.rgbToHsl(t.r,t.g,t.b),i=this.rgbToHwb(t.r,t.g,t.b),u=this.rgbToCmyk(t.r,t.g,t.b),s=n||a.h,f=r||a.s,l=this.hueToNcol(s),o={red:t.r,green:t.g,blue:t.b,hue:s,sat:f,lightness:a.l,whiteness:i.w,blackness:i.b,cyan:u.c,magenta:u.m,yellow:u.y,black:u.k,ncol:l,opacity:e,valid:!0},o=this.roundDecimals(o)):this.emptyObject()}},{key:"emptyObject",value:function(){return{red:0,green:0,blue:0,hue:0,sat:0,lightness:0,whiteness:0,blackness:0,cyan:0,magenta:0,yellow:0,black:0,ncol:"R",opacity:1,valid:!1}}},{key:"getColorArr",value:function(t){return"names"==t?["AliceBlue","AntiqueWhite","Aqua","Aquamarine","Azure","Beige","Bisque","Black","BlanchedAlmond","Blue","BlueViolet","Brown","BurlyWood","CadetBlue","Chartreuse","Chocolate","Coral","CornflowerBlue","Cornsilk","Crimson","Cyan","DarkBlue","DarkCyan","DarkGoldenRod","DarkGray","DarkGrey","DarkGreen","DarkKhaki","DarkMagenta","DarkOliveGreen","DarkOrange","DarkOrchid","DarkRed","DarkSalmon","DarkSeaGreen","DarkSlateBlue","DarkSlateGray","DarkSlateGrey","DarkTurquoise","DarkViolet","DeepPink","DeepSkyBlue","DimGray","DimGrey","DodgerBlue","FireBrick","FloralWhite","ForestGreen","Fuchsia","Gainsboro","GhostWhite","Gold","GoldenRod","Gray","Grey","Green","GreenYellow","HoneyDew","HotPink","IndianRed","Indigo","Ivory","Khaki","Lavender","LavenderBlush","LawnGreen","LemonChiffon","LightBlue","LightCoral","LightCyan","LightGoldenRodYellow","LightGray","LightGrey","LightGreen","LightPink","LightSalmon","LightSeaGreen","LightSkyBlue","LightSlateGray","LightSlateGrey","LightSteelBlue","LightYellow","Lime","LimeGreen","Linen","Magenta","Maroon","MediumAquaMarine","MediumBlue","MediumOrchid","MediumPurple","MediumSeaGreen","MediumSlateBlue","MediumSpringGreen","MediumTurquoise","MediumVioletRed","MidnightBlue","MintCream","MistyRose","Moccasin","NavajoWhite","Navy","OldLace","Olive","OliveDrab","Orange","OrangeRed","Orchid","PaleGoldenRod","PaleGreen","PaleTurquoise","PaleVioletRed","PapayaWhip","PeachPuff","Peru","Pink","Plum","PowderBlue","Purple","RebeccaPurple","Red","RosyBrown","RoyalBlue","SaddleBrown","Salmon","SandyBrown","SeaGreen","SeaShell","Sienna","Silver","SkyBlue","SlateBlue","SlateGray","SlateGrey","Snow","SpringGreen","SteelBlue","Tan","Teal","Thistle","Tomato","Turquoise","Violet","Wheat","White","WhiteSmoke","Yellow","YellowGreen"]:"hexs"==t?["f0f8ff","faebd7","00ffff","7fffd4","f0ffff","f5f5dc","ffe4c4","000000","ffebcd","0000ff","8a2be2","a52a2a","deb887","5f9ea0","7fff00","d2691e","ff7f50","6495ed","fff8dc","dc143c","00ffff","00008b","008b8b","b8860b","a9a9a9","a9a9a9","006400","bdb76b","8b008b","556b2f","ff8c00","9932cc","8b0000","e9967a","8fbc8f","483d8b","2f4f4f","2f4f4f","00ced1","9400d3","ff1493","00bfff","696969","696969","1e90ff","b22222","fffaf0","228b22","ff00ff","dcdcdc","f8f8ff","ffd700","daa520","808080","808080","008000","adff2f","f0fff0","ff69b4","cd5c5c","4b0082","fffff0","f0e68c","e6e6fa","fff0f5","7cfc00","fffacd","add8e6","f08080","e0ffff","fafad2","d3d3d3","d3d3d3","90ee90","ffb6c1","ffa07a","20b2aa","87cefa","778899","778899","b0c4de","ffffe0","00ff00","32cd32","faf0e6","ff00ff","800000","66cdaa","0000cd","ba55d3","9370db","3cb371","7b68ee","00fa9a","48d1cc","c71585","191970","f5fffa","ffe4e1","ffe4b5","ffdead","000080","fdf5e6","808000","6b8e23","ffa500","ff4500","da70d6","eee8aa","98fb98","afeeee","db7093","ffefd5","ffdab9","cd853f","ffc0cb","dda0dd","b0e0e6","800080","663399","ff0000","bc8f8f","4169e1","8b4513","fa8072","f4a460","2e8b57","fff5ee","a0522d","c0c0c0","87ceeb","6a5acd","708090","708090","fffafa","00ff7f","4682b4","d2b48c","008080","d8bfd8","ff6347","40e0d0","ee82ee","f5deb3","ffffff","f5f5f5","ffff00","9acd32"]:void 0}},{key:"roundDecimals",value:function(t){return t.red=Number(t.red.toFixed(0)),t.green=Number(t.green.toFixed(0)),t.blue=Number(t.blue.toFixed(0)),t.hue=Number(t.hue.toFixed(0)),t.sat=Number(t.sat.toFixed(2)),t.lightness=Number(t.lightness.toFixed(2)),t.whiteness=Number(t.whiteness.toFixed(2)),t.blackness=Number(t.blackness.toFixed(2)),t.cyan=Number(t.cyan.toFixed(2)),t.magenta=Number(t.magenta.toFixed(2)),t.yellow=Number(t.yellow.toFixed(2)),t.black=Number(t.black.toFixed(2)),t.ncol=t.ncol.substr(0,1)+Math.round(Number(t.ncol.substr(1))),t.opacity=Number(t.opacity.toFixed(2)),t}},{key:"hslToRgb",value:function(t,e,n){var r,a;return t/=60,r=2*n-(a=n<=.5?n*(e+1):n+e-n*e),{r:255*hueToRgb(r,a,t+2),g:255*hueToRgb(r,a,t),b:255*hueToRgb(r,a,t-2)}}},{key:"hueToRgb",value:function(t,e,n){return n<0&&(n+=6),n>=6&&(n-=6),n<1?(e-t)*n+t:n<3?e:n<4?(e-t)*(4-n)+t:t}},{key:"hwbToRgb",value:function(t,e,n){var r,a,i,u=[];for(a=hslToRgb(t,1,.5),u[0]=a.r/255,u[1]=a.g/255,u[2]=a.b/255,(i=e+n)>1&&(e=Number((e/i).toFixed(2)),n=Number((n/i).toFixed(2))),r=0;r<3;r++)u[r]*=1-e-n,u[r]+=e,u[r]=Number(255*u[r]);return{r:u[0],g:u[1],b:u[2]}}},{key:"cmykToRgb",value:function(t,e,n,r){return{r:255-255*Math.min(1,t*(1-r)+r),g:255-255*Math.min(1,e*(1-r)+r),b:255-255*Math.min(1,n*(1-r)+r)}}},{key:"ncolToRgb",value:function(t,e,n){var r,a,i;if(i=t,isNaN(t.substr(0,1))){if(r=t.substr(0,1).toUpperCase(),""==(a=t.substr(1))&&(a=0),a=Number(a),isNaN(a))return!1;"R"==r&&(i=0+.6*a),"Y"==r&&(i=60+.6*a),"G"==r&&(i=120+.6*a),"C"==r&&(i=180+.6*a),"B"==r&&(i=240+.6*a),"M"==r&&(i=300+.6*a),"W"==r&&(i=0,e=1-a/100,n=a/100)}return hwbToRgb(i,e,n)}},{key:"hueToNcol",value:function(t){for(;t>=360;)t-=360;return t<60?"R"+t/.6:t<120?"Y"+(t-60)/.6:t<180?"G"+(t-120)/.6:t<240?"C"+(t-180)/.6:t<300?"B"+(t-240)/.6:t<360?"M"+(t-300)/.6:void 0}},{key:"ncsToRgb",value:function(t){var e,n,r,a,i,u,l,o,s,f,h,c,d,y,v,g,x;if(-1==(t=(t=(t=(t=(t=w3trim(t).toUpperCase()).replace("(","")).replace(")","")).replace("NCS","NCS ")).replace(/  /g," ")).indexOf("NCS")&&(t="NCS "+t),null===(t=t.match(/^(?:NCS|NCS\sS)\s(\d{2})(\d{2})-(N|[A-Z])(\d{2})?([A-Z])?$/)))return!1;if(e=parseInt(t[1],10),n=parseInt(t[2],10),"N"!=(r=t[3])&&"Y"!=r&&"R"!=r&&"B"!=r&&"G"!=r)return!1;if(a=parseInt(t[4],10)||0,"N"!==r){i=1.05*e-5.25,u=n,"Y"===r&&a<=60?s=1:"Y"===r&&a>60||"R"===r&&a<=80?(l="Y"===r?a-60:a+40,s=(Math.sqrt(14884-Math.pow(l,2))-22)/100):"R"===r&&a>80||"B"===r?s=0:"G"===r&&(l=a-170,s=(Math.sqrt(33800-Math.pow(l,2))-70)/100),"Y"===r&&a<=80?o=0:"Y"===r&&a>80||"R"===r&&a<=60?(l="Y"===r?a-80+20.5:a+20+20.5,o=(104-Math.sqrt(11236-Math.pow(l,2)))/100):"R"===r&&a>60||"B"===r&&a<=80?(l="R"===r?a-60-60:a+40-60,o=(Math.sqrt(1e4-Math.pow(l,2))-10)/100):"B"===r&&a>80||"G"===r&&a<=40?(l="B"===r?a-80-131:a+20-131,o=(122-Math.sqrt(19881-Math.pow(l,2)))/100):"G"===r&&a>40&&(o=0);var b=void 0;"Y"===r?b=(85-.85*a)/100:"R"===r&&a<=60?b=0:"R"===r&&a>60?(l=a-60+35,b=(67.5-Math.sqrt(5776-Math.pow(l,2)))/100):"B"===r&&a<=60?(l=1*a-68.5,b=(6.5+Math.sqrt(7044.5-Math.pow(l,2)))/100):"B"===r&&a>60||"G"===r&&a<=60?b=.9:"G"===r&&a>60&&(b=(90-1/8*(l=a-60))/100),c=((l=(s+b+o)/3)-o)*(100-u)/100+o,d=1/((f=(l-s)*(100-u)/100+s)>(h=(l-b)*(100-u)/100+b)&&f>c?f:h>f&&h>c?h:c>f&&c>h?c:(f+h+c)/3),(v=parseInt(f*d*(100-i)/100*255,10))>255&&(v=255),(g=parseInt(h*d*(100-i)/100*255,10))>255&&(g=255),(x=parseInt(c*d*(100-i)/100*255,10))>255&&(x=255),v<0&&(v=0),g<0&&(g=0),x<0&&(x=0)}else(y=parseInt(255*(1-e/100),10))>255&&(y=255),y<0&&(y=0),v=y,g=y,x=y;return{r:v,g:g,b:x}}},{key:"rgbToHsl",value:function(t,e,n){var r,a,i,u,l,o,s=[];for(s[0]=t/255,s[1]=e/255,s[2]=n/255,r=s[0],a=s[0],l=0,i=0;i<s.length-1;i++)s[i+1]<=r&&(r=s[i+1]),s[i+1]>=a&&(a=s[i+1],l=i+1);return 0==l&&(o=(s[1]-s[2])/(a-r)),1==l&&(o=2+(s[2]-s[0])/(a-r)),2==l&&(o=4+(s[0]-s[1])/(a-r)),isNaN(o)&&(o=0),(o*=60)<0&&(o+=360),u=(r+a)/2,{h:o,s:r==a?0:u<.5?(a-r)/(a+r):(a-r)/(2-a-r),l:u}}},{key:"rgbToHwb",value:function(t,e,n){t/=255,e/=255,n/=255;var r=Math.max(t,e,n),a=Math.min(t,e,n),i=r-a;return{h:0==i?0:t==r?(e-n)/i%6*360:e==r?((n-t)/i+2)%6*360:((t-e)/i+4)%6*360,w:a,b:1-r}}},{key:"rgbToCmyk",value:function(t,e,n){var r,a,i,u;return t/=255,e/=255,n/=255,1==(u=1-Math.max(t,e,n))?(r=0,a=0,i=0):(r=(1-t-u)/(1-u),a=(1-e-u)/(1-u),i=(1-n-u)/(1-u)),{c:r,m:a,y:i,k:u}}},{key:"toHex",value:function(t){for(var e=t.toString(16);e.length<2;)e="0"+e;return e}},{key:"cl",value:function(t){console.log(t)}},{key:"w3trim",value:function(t){return t.replace(/^\s+|\s+$/g,"")}},{key:"isHex",value:function(t){return"0123456789ABCDEFabcdef".indexOf(t)>-1}}]),t}();e.default=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=u(n(20)),i=u(n(5));function u(t){return t&&t.__esModule?t:{default:t}}var l=[0,1,2],o=[0,1,2,2,3,0],s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type=e,this.textureIndex=-1,this.verticesData=null,this.fragmentData=null,this.transformData=null,this.renderPointNumber=0,this.isRect=!1,this.indexData=null,this.applyMatrix=null,this.applyColor=null,this.applyOpacity=null}return r(t,[{key:"collectVertexDataForStroke",value:function(t,e,n,r,a,u,l){for(var o=this,s=this,f={setPoint:function(t,e){s.verticesData.setVerticesCoor(t.x,t.y,t.z,e+f.offset)},addPoint:function(t){null!=s.verticesData&&s.verticesData.addVerticesData(t.x,t.y,t.z,l[0],l[1],l[2]),null!=s.fragmentData&&s.fragmentData.addFragmentData(e[0],e[1],e[2],n,r[0],r[1],-1,u),null!=s.transformData&&s.transformData.addMatrixIndex(0)}},h=0;h<t.length;h++)for(var c=t[h],d=function(t){var e=c.subPathArray[t];if(e.pointsNumber<2)return"continue";f.offset=o.verticesData.currentIndex;for(var n=e.pointsCoordinateArray,r={getX:function(t){return n[t*=3]},getY:function(t){return n[(t*=3)+1]},getZ:function(t){return n[(t*=3)+2]},getPointsNum:function(){return n.length/3}},u=i.default.generateRectanglesPoints(a,e.isClosed,l,f,r),s=0;s<u;s++){var h=4*s;o.indexData.addIndex(f.offset+h),o.indexData.addIndex(f.offset+h+1),o.indexData.addIndex(f.offset+h+2),o.indexData.addIndex(f.offset+h+2),o.indexData.addIndex(f.offset+h+3),o.indexData.addIndex(f.offset+h)}o.renderPointNumber+=6*u},y=0;y<c.subPathNumber;y++)d(y)}},{key:"collectVertexDataForFill",value:function(t,e,n,r,i,u){for(var s=0;s<t.length;s++){var f=t[s];if(0!=f.subPathNumber)for(var h=0;h<f.subPathNumber;h++){var c=f.subPathArray[h];if(!(c.pointsNumber<3)){var d=void 0,y=c.pointsCoordinateArray,v=c.pointsNumber;if(3==v)d=l;else if(4==v&&c.isRegularRect)d=o;else if(3*v==y.length)d=a.default.earcut(y,null,3);else{var g=y.slice(0,3*v);d=a.default.earcut(g,null,3)}if(this.renderPointNumber+=d.length,0!=d.length){var x=this.verticesData.currentIndex,b=void 0;for(b=0;b<v;b++){if(null!=this.verticesData&&this.verticesData.addVerticesData(c.getPointX(b),c.getPointY(b),c.getPointZ(b),u[0],u[1],u[2]),null!=this.fragmentData){var p=void 0;p=r[0]instanceof Array?r[b]:r,this.fragmentData.addFragmentData(e[0],e[1],e[2],n,p[0],p[1],this.textureIndex,i)}null!=this.transformData&&this.transformData.addMatrixIndex(0);var m=d[b];this.indexData.addIndex(m+x)}for(var k=b;k<d.length;k++){var M=d[k];this.indexData.addIndex(M+x)}}}}}}}],[{key:"ACTION_STROKE",get:function(){return 0}},{key:"ACTION_FILL",get:function(){return 1}}]),t}();e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(21),u=(r=i)&&r.__esModule?r:{default:r};var l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return a(t,null,[{key:"earcut",value:function(t,e,n){n=n||2;var r=e&&e.length,a=r?e[0]*n:t.length,i=this.linkedList(t,0,a,n,!0),u=[];if(!i||i.next===i.prev)return u;var l=void 0,o=void 0,s=void 0,f=void 0,h=void 0,c=void 0,d=void 0;if(r&&(i=this.eliminateHoles(t,e,i,n)),t.length>80*n){l=s=t[0],o=f=t[1];for(var y=n;y<a;y+=n)(h=t[y])<l&&(l=h),(c=t[y+1])<o&&(o=c),h>s&&(s=h),c>f&&(f=c);d=0!==(d=Math.max(s-l,f-o))?1/d:0}return this.earcutLinked(i,u,n,l,o,d),u}},{key:"linkedList",value:function(e,n,r,a,i){var u,l;if(i===t.signedArea(e,n,r,a)>0)for(u=n;u<r;u+=a)l=this.insertNode(u,e[u],e[u+1],l);else for(u=r-a;u>=n;u-=a)l=this.insertNode(u,e[u],e[u+1],l);return l&&t.equals(l,l.next)&&(this.removeNode(l),l=l.next),l}},{key:"filterPoints",value:function(e,n){if(!e)return e;n||(n=e);var r,a=e;do{if(r=!1,a.steiner||!t.equals(a,a.next)&&0!==t.area(a.prev,a,a.next))a=a.next;else{if(this.removeNode(a),(a=n=a.prev)===a.next)break;r=!0}}while(r||a!==n);return n}},{key:"earcutLinked",value:function(t,e,n,r,a,i,u){if(t){!u&&i&&this.indexCurve(t,r,a,i);for(var l,o,s=t;t.prev!==t.next;)if(l=t.prev,o=t.next,i?this.isEarHashed(t,r,a,i):this.isEar(t))e.push(l.i/n),e.push(t.i/n),e.push(o.i/n),this.removeNode(t),t=o.next,s=o.next;else if((t=o)===s){u?1===u?(t=this.cureLocalIntersections(t,e,n),this.earcutLinked(t,e,n,r,a,i,2)):2===u&&this.splitEarcut(t,e,n,r,a,i):this.earcutLinked(this.filterPoints(t),e,n,r,a,i,1);break}}}},{key:"isEar",value:function(e){var n=e.prev,r=e,a=e.next;if(this.area(n,r,a)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(this.pointInTriangle(n.x,n.y,r.x,r.y,a.x,a.y,i.x,i.y)&&t.area(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}},{key:"isEarHashed",value:function(e,n,r,a){var i=e.prev,u=e,l=e.next;if(this.area(i,u,l)>=0)return!1;for(var o=i.x<u.x?i.x<l.x?i.x:l.x:u.x<l.x?u.x:l.x,s=i.y<u.y?i.y<l.y?i.y:l.y:u.y<l.y?u.y:l.y,f=i.x>u.x?i.x>l.x?i.x:l.x:u.x>l.x?u.x:l.x,h=i.y>u.y?i.y>l.y?i.y:l.y:u.y>l.y?u.y:l.y,c=this.zOrder(o,s,n,r,a),d=this.zOrder(f,h,n,r,a),y=e.prevZ,v=e.nextZ;y&&y.z>=c&&v&&v.z<=d;){if(y!==e.prev&&y!==e.next&&this.pointInTriangle(i.x,i.y,u.x,u.y,l.x,l.y,y.x,y.y)&&t.area(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,v!==e.prev&&v!==e.next&&this.pointInTriangle(i.x,i.y,u.x,u.y,l.x,l.y,v.x,v.y)&&t.area(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;y&&y.z>=c;){if(y!==e.prev&&y!==e.next&&this.pointInTriangle(i.x,i.y,u.x,u.y,l.x,l.y,y.x,y.y)&&t.area(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;v&&v.z<=d;){if(v!==e.prev&&v!==e.next&&this.pointInTriangle(i.x,i.y,u.x,u.y,l.x,l.y,v.x,v.y)&&t.area(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}},{key:"cureLocalIntersections",value:function(e,n,r){var a=e;do{var i=a.prev,u=a.next.next;!t.equals(i,u)&&this.intersects(i,a,a.next,u)&&this.locallyInside(i,u)&&this.locallyInside(u,i)&&(n.push(i.i/r),n.push(a.i/r),n.push(u.i/r),this.removeNode(a),this.removeNode(a.next),a=e=u),a=a.next}while(a!==e);return a}},{key:"splitEarcut",value:function(t,e,n,r,a,i){var u=t;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&this.isValidDiagonal(u,l)){var o=this.splitPolygon(u,l);return u=this.filterPoints(u,u.next),o=this.filterPoints(o,o.next),this.earcutLinked(u,e,n,r,a,i),void this.earcutLinked(o,e,n,r,a,i)}l=l.next}u=u.next}while(u!==t)}},{key:"eliminateHoles",value:function(t,e,n,r){var a,i,u,l,o,s=[];for(a=0,i=e.length;a<i;a++)u=e[a]*r,l=a<i-1?e[a+1]*r:t.length,(o=this.linkedList(t,u,l,r,!1))===o.next&&(o.steiner=!0),s.push(this.getLeftmost(o));for(s.sort(this.compareX),a=0;a<s.length;a++)this.eliminateHole(s[a],n),n=this.filterPoints(n,n.next);return n}},{key:"compareX",value:function(t,e){return t.x-e.x}},{key:"eliminateHole",value:function(t,e){if(e=this.findHoleBridge(t,e)){var n=this.splitPolygon(e,t);this.filterPoints(n,n.next)}}},{key:"findHoleBridge",value:function(t,e){var n,r=e,a=t.x,i=t.y,u=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var l=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(l<=a&&l>u){if(u=l,l===a){if(i===r.y)return r;if(i===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(a===u)return n.prev;var o,s=n,f=n.x,h=n.y,c=1/0;for(r=n.next;r!==s;)a>=r.x&&r.x>=f&&a!==r.x&&this.pointInTriangle(i<h?a:u,i,f,h,i<h?u:a,i,r.x,r.y)&&((o=Math.abs(i-r.y)/(a-r.x))<c||o===c&&r.x>n.x)&&this.locallyInside(r,t)&&(n=r,c=o),r=r.next;return n}},{key:"indexCurve",value:function(t,e,n,r){var a=t;do{null===a.z&&(a.z=this.zOrder(a.x,a.y,e,n,r)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==t);a.prevZ.nextZ=null,a.prevZ=null,this.sortLinked(a)}},{key:"sortLinked",value:function(t){var e,n,r,a,i,u,l,o,s=1;do{for(n=t,t=null,i=null,u=0;n;){for(u++,r=n,l=0,e=0;e<s&&(l++,r=r.nextZ);e++);for(o=s;l>0||o>0&&r;)0!==l&&(0===o||!r||n.z<=r.z)?(a=n,n=n.nextZ,l--):(a=r,r=r.nextZ,o--),i?i.nextZ=a:t=a,a.prevZ=i,i=a;n=r}i.nextZ=null,s*=2}while(u>1);return t}},{key:"zOrder",value:function(t,e,n,r,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*a)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*a)|e<<8))|e<<4))|e<<2))|e<<1))<<1}},{key:"getLeftmost",value:function(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}},{key:"pointInTriangle",value:function(t,e,n,r,a,i,u,l){return(a-u)*(e-l)-(t-u)*(i-l)>=0&&(t-u)*(r-l)-(n-u)*(e-l)>=0&&(n-u)*(i-l)-(a-u)*(r-l)>=0}},{key:"isValidDiagonal",value:function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!this.intersectsPolygon(t,e)&&this.locallyInside(t,e)&&this.locallyInside(e,t)&&this.middleInside(t,e)}},{key:"area",value:function(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}},{key:"equals",value:function(t,e){return t.x===e.x&&t.y===e.y}},{key:"intersects",value:function(e,n,r,a){return!!(t.equals(e,n)&&t.equals(r,a)||t.equals(e,a)&&t.equals(r,n))||t.area(e,n,r)>0!=t.area(e,n,a)>0&&t.area(r,a,e)>0!=t.area(r,a,n)>0}},{key:"intersectsPolygon",value:function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&this.intersects(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}},{key:"locallyInside",value:function(e,n){return t.area(e.prev,e,e.next)<0?t.area(e,n,e.next)>=0&&t.area(e,e.prev,n)>=0:t.area(e,n,e.prev)<0||t.area(e,e.next,n)<0}},{key:"middleInside",value:function(t,e){var n=t,r=!1,a=(t.x+e.x)/2,i=(t.y+e.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&a<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}},{key:"splitPolygon",value:function(t,e){var n=new u.default(t.i,t.x,t.y),r=new u.default(e.i,e.x,e.y),a=t.next,i=e.prev;return t.next=e,e.prev=t,n.next=a,a.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}},{key:"insertNode",value:function(t,e,n,r){var a=new u.default(t,e,n);return r?(a.next=r.next,a.prev=r,r.next.prev=a,r.next=a):(a.prev=a,a.next=a),a}},{key:"removeNode",value:function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}},{key:"signedArea",value:function(t,e,n,r){for(var a=0,i=e,u=n-r;i<n;i+=r)a+=(t[u]-t[i])*(t[i+1]+t[u+1]),u=i;return a}},{key:"deviation",value:function(t,e,n,r){var a=e&&e.length,i=a?e[0]*n:t.length,u=Math.abs(this.signedArea(t,0,i,n));if(a)for(var l=0,o=e.length;l<o;l++){var s=e[l]*n,f=l<o-1?e[l+1]*n:t.length;u-=Math.abs(this.signedArea(t,s,f,n))}var h=0;for(l=0;l<r.length;l+=3){var c=r[l]*n,d=r[l+1]*n,y=r[l+2]*n;h+=Math.abs((t[c]-t[y])*(t[d+1]-t[c+1])-(t[c]-t[d])*(t[y+1]-t[c+1]))}return 0===u&&0===h?0:Math.abs((h-u)/u)}},{key:"flatten",value:function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,a=0;a<t.length;a++){for(var i=0;i<t[a].length;i++)for(var u=0;u<e;u++)n.vertices.push(t[a][i][u]);a>0&&(r+=t[a-1].length,n.holes.push(r))}return n}}]),t}();e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.i=e,this.x=n,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=u(n(7)),i=u(n(1));function u(t){return t&&t.__esModule?t:{default:t}}var l=Symbol("WebGL的program"),o=Symbol("转换矩阵变量可用的最大数量"),s=function(){function t(e,n,r,a,u,l,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gl=e,this.DEBUG_DRAW_COUNT=0,this.defaultTransformMatrix=i.default.identity(),this.orthoProjectionMatrix=i.default.identity(),this.perspectiveMatrix=i.default.identity(),a=a||0,r=r||e.getParameter(this.gl.MAX_TEXTURE_SIZE);var f=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS);n=n||Math.floor((f-4)/4),n=2,this[o]=n,this.enableDepthTest=s||!1,this.textureManager=null,this.verticesData=null,this.fragmentData=null,this.indexData=null,this.transformMatrixData=null,this.canvasWidth=-1,this.canvasHeight=-1,this.lightPosition=new Float32Array(3),this.lightPosition[0]=e.canvas.width/2,this.lightPosition[1]=e.canvas.height/2,this.lightPosition[2]=0,this.projectionType=a,this.fov=u,this.init(),this.textureManager.maxHeight=r,this.textureManager.maxWidth=this.textureManager.maxHeight,l=l||!1,this.enableLight(l)}return r(t,[{key:"enableLight",value:function(t){var e=0;e=t?1:0,this.gl.uniform1f(this.shaderInformation.enableLight,e)}},{key:"clean",value:function(){this.DEBUG_DRAW_COUNT=0,this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}},{key:"initRending",value:function(){var t=this.gl;t.viewport(0,0,t.canvas.width,t.canvas.height)}},{key:"setUniformTransformMatrix",value:function(t,e){this.gl.uniformMatrix4fv(this.shaderInformation.transformMatrixArray[e],!1,t)}},{key:"prepareWebGLBuffer",value:function(){var t=this.gl,e=this.shaderInformation;t.enableVertexAttribArray(e.vertexAttribute),t.bindBuffer(t.ARRAY_BUFFER,e.verticesBuffer),t.bufferData(t.ARRAY_BUFFER,this.verticesData.buffer,t.DYNAMIC_DRAW);var n=3,r=t.FLOAT,a=!1,i=32,u=0;t.vertexAttribPointer(e.vertexAttribute,n,r,a,i,u),r=t.FLOAT,n=3,u=16,a=!0,t.vertexAttribPointer(e.normalAttribute,n,r,a,i,u),t.enableVertexAttribArray(e.colorAttribute),t.enableVertexAttribArray(e.textureCoordAttribute),t.bindBuffer(t.ARRAY_BUFFER,e.fragmentBuffer),t.bufferData(t.ARRAY_BUFFER,this.fragmentData.buffer,t.DYNAMIC_DRAW),r=t.UNSIGNED_BYTE,i=this.fragmentData.singleDataByteLength,n=3,u=0,a=!1,t.vertexAttribPointer(e.colorAttribute,n,r,a,i,u),r=t.UNSIGNED_BYTE,i=this.fragmentData.singleDataByteLength,n=1,u=3,a=!1,t.vertexAttribPointer(e.filterTypeAttribute,n,r,a,i,u),r=t.FLOAT,n=1,u=4,t.vertexAttribPointer(e.alphaAttribute,n,r,a,i,u),r=t.FLOAT,n=2,u=8,t.vertexAttribPointer(e.textureCoordAttribute,n,r,a,i,u),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.indexDataBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indexData.dataArray,t.DYNAMIC_DRAW)}},{key:"executeRenderAction",value:function(t){this.prepareWebGLBuffer();for(var e=void 0,n=0,r=0,a=0;a<t.length;a++){var i=t[a];null==e&&(e=i),i.applyMatrix!=e.applyMatrix?(this.renderVertices(n,r,e.textureIndex,e.applyMatrix),e=i,n+=r,r=i.renderPointNumber):(i.textureIndex!=e.textureIndex&&-1!=i.textureIndex&&-1!=e.textureIndex&&(this.renderVertices(n,r,e.textureIndex,e.applyMatrix),e=i,n+=r,r=0),-1==e.textureIndex&&-1!=i.textureIndex&&(e=i),r+=i.renderPointNumber)}null!=e&&this.renderVertices(n,r,e.textureIndex,e.applyMatrix)}},{key:"renderVertices",value:function(t,e,n,r){if(0!=e){var a=this.gl;if(this.initProjectionMatrix(),null!=r){var u=i.default.identity();i.default.multiply(u,r,this.defaultTransformMatrix),a.uniformMatrix4fv(this.shaderInformation.transformMatrixArray[0],!1,u)}this.gl.uniform3f(this.shaderInformation.lightPosition,this.lightPosition[0],this.lightPosition[1],this.lightPosition[2]),this.configTexture(n),a.drawElements(a.TRIANGLES,e,a.UNSIGNED_SHORT,2*t),this.DEBUG_DRAW_COUNT++}}},{key:"initProjectionMatrix",value:function(){var t=this.gl;if(this.canvasHeight!=t.canvas.height&&this.canvasWidth!=t.canvas.width){var e=Math.tan(this.fov*Math.PI/180),n=-t.canvas.height/(2*e);i.default.identityMatrix(this.defaultTransformMatrix),i.default.translationMatrix(this.defaultTransformMatrix,0,0,n),t.uniformMatrix4fv(this.shaderInformation.transformMatrixArray[0],!1,this.defaultTransformMatrix);var r=void 0;if(0==this.projectionType)r=i.default.orthoProjection(0,0,t.canvas.width,t.canvas.height,1,Math.abs(2*n),this.orthoProjectionMatrix);else{var a=Math.atan2(t.canvas.height/2,Math.abs(n));r=i.default.perspective3(2*a,t.canvas.width,t.canvas.height,1,Math.abs(2*n),this.perspectiveMatrix)}t.uniformMatrix4fv(this.shaderInformation.perspectiveMatrix,!1,r),this.canvasHeight=t.canvas.height,this.canvasWidth=t.canvas.width}}},{key:"setLightPosition",value:function(t,e,n){this.lightPosition[0]=t,this.lightPosition[1]=e,this.lightPosition[2]=n}},{key:"configTexture",value:function(t){null==t&&(t=-1);var e=this.gl,n=this.shaderInformation;e.uniform1i(n.textureLocation,0);var r=void 0,a=void 0;-1==t?(r=n.blackTexture,a={width:1,height:1}):(r=this.textureManager.textureArray[t],a=this.textureManager.imageDataArray[t]),e.uniform2f(n.singleCanvas,a.width,a.height),e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,r)}},{key:"createShaderProgram",value:function(){var t=this.gl,e=this.loadShader(t.VERTEX_SHADER,this.getVertexShaderSource(this.maxTransformMatrixNum)),n=this.loadShader(t.FRAGMENT_SHADER,"\n  precision mediump float;\n  varying vec4 currentColor;\n  varying vec2 v_texcoord;\n  varying vec3 normal;\n  varying vec3 v_position;\n  varying float v_filterType;\n  uniform vec2 singleCanvas;\n  uniform vec3 u_lightPosition;\n  uniform float enableLight;\n  uniform sampler2D u_texture;\n  \n  void getNormalFilter(inout float filter[9]){\n        filter[0] = 0.0;\n        filter[1] = 0.0;\n        filter[2] = 0.0;\n        filter[3] = 0.0;\n        filter[4] = 1.0;\n        filter[5] = 0.0;\n        filter[6] = 0.0;\n        filter[7] = 0.0;\n        filter[8] = 0.0;\n  }\n  \n  void getGaussianBlurFilter(inout float filter[9]){\n        filter[0] = 0.045;\n        filter[1] = 0.122;\n        filter[2] = 0.045;\n        filter[3] = 0.122;\n        filter[4] = 0.332;\n        filter[5] = 0.122;\n        filter[6] = 0.045;\n        filter[7] = 0.122;\n        filter[8] = 0.045;\n  }\n  \n  void getUnsharpenFilter(inout float filter[9]){\n        filter[0] = -1.0;\n        filter[1] = -1.0;\n        filter[2] = -1.0;\n        filter[3] = -1.0;\n        filter[4] = 9.0;\n        filter[5] = -1.0;\n        filter[6] = -1.0;\n        filter[7] = -1.0;\n        filter[8] = -1.0;\n  }\n  \n  void getSharpnessFilter(inout float filter[9]){\n        filter[0] = 0.0;\n        filter[1] = -1.0;\n        filter[2] = 0.0;\n        filter[3] = -1.0;\n        filter[4] = 5.0;\n        filter[5] = -1.0;\n        filter[6] = 0.0;\n        filter[7] = -1.0;\n        filter[8] = 0.0;\n  }\n  \n   void getSharpenFilter(inout float filter[9]){\n        filter[0] = -0.125;\n        filter[1] = -0.125;\n        filter[2] = -0.125;\n        filter[3] = -0.125;\n        filter[4] =  2.0;\n        filter[5] = -0.125;\n        filter[6] = -0.125;\n        filter[7] = -0.125;\n        filter[8] = -0.125;\n  }\n  \n  void getEdgeDetectFilter(inout float filter[9]){\n        filter[0] = -5.0;\n        filter[1] = -5.0;\n        filter[2] = -5.0;\n        filter[3] = -5.0;\n        filter[4] =  39.0;\n        filter[5] = -5.0;\n        filter[6] = -5.0;\n        filter[7] = -5.0;\n        filter[8] = -5.0;\n  }\n  \n  void getSobelHorizontalFilter(inout float filter[9]){\n        filter[0] = 1.0;\n        filter[1] = 2.0;\n        filter[2] = 1.0;\n        filter[3] = 0.0;\n        filter[4] =  0.0;\n        filter[5] = 0.0;\n        filter[6] = -1.0;\n        filter[7] = -2.0;\n        filter[8] = -1.0;\n  }\n  \n  void getSobelVerticalFilter(inout float filter[9]){\n        filter[0] = 1.0;\n        filter[1] = 0.0;\n        filter[2] = -1.0;\n        filter[3] = 2.0;\n        filter[4] =  0.0;\n        filter[5] = -2.0;\n        filter[6] = 1.0;\n        filter[7] = 0.0;\n        filter[8] = -1.0;\n  }\n  \n  void getPrevitHorizontalFilter(inout float filter[9]){\n        filter[0] = 1.0;\n        filter[1] = 1.0;\n        filter[2] = 1.0;\n        filter[3] = 0.0;\n        filter[4] = 0.0;\n        filter[5] = 0.0;\n        filter[6] = -1.0;\n        filter[7] = -1.0;\n        filter[8] = -1.0;\n  }\n  \n  void getPrevitVerticalFilter(inout float filter[9]){\n        filter[0] = 1.0;\n        filter[1] = 0.0;\n        filter[2] = -1.0;\n        filter[3] = 1.0;\n        filter[4] = 0.0;\n        filter[5] = -1.0;\n        filter[6] = 1.0;\n        filter[7] = 0.0;\n        filter[8] = -1.0;\n  }\n  \n  void getBoxBlurFilter(inout float filter[9]){\n        filter[0] = 0.111;\n        filter[1] = 0.111;\n        filter[2] = 0.111;\n        filter[3] = 0.111;\n        filter[4] = 0.111;\n        filter[5] = 0.111;\n        filter[6] = 0.111;\n        filter[7] = 0.111;\n        filter[8] = 0.111;\n  }\n  \n  void getTriangleBlurFilter(inout float filter[9]){\n        filter[0] = 0.0625;\n        filter[1] = 0.125;\n        filter[2] = 0.0625;\n        filter[3] = 0.125;\n        filter[4] = 0.25;\n        filter[5] = 0.125;\n        filter[6] = 0.0625;\n        filter[7] = 0.125;\n        filter[8] = 0.0625;\n  }\n  \n  void getEmbossFilter(inout float filter[9]){\n        filter[0] = -2.0;\n        filter[1] = -1.0;\n        filter[2] = 0.0;\n        filter[3] = -1.0;\n        filter[4] = 1.0;\n        filter[5] = 1.0;\n        filter[6] = 0.0;\n        filter[7] = 1.0;\n        filter[8] = 2.0;\n  }\n  \n  void filter3(in float kernel[9],in vec2 coord,in vec2 onePixel, inout vec4 colorSum){\n        float offset = -1.0;\n        for(float i = 0.0 ; i < 3.0;i++){\n            for(float j =0.0;j < 3.0;j++){\n                colorSum += texture2D(u_texture, coord + onePixel * vec2(offset + j, offset+ i)) * kernel[int(i*3.0+j)];\n            }\n        }\n  }\n  \n  void filter5(in float kernel[25],in vec2 coord,in vec2 onePixel, inout vec4 colorSum){\n        float offset = -2.0;\n        for(float i = 0.0 ; i < 5.0;i++){\n            for(float j =0.0;j < 5.0;j++){\n                colorSum += texture2D(u_texture, coord + onePixel * vec2(offset + j, offset+ i)) * kernel[int(i*5.0+j)];\n            }\n        }\n  }\n  \n  void main() {\n        vec2 coord = vec2(v_texcoord.x / singleCanvas.x , v_texcoord.y/singleCanvas.y);\n        vec2 onePixel = vec2(1.0/singleCanvas.x, 1.0/singleCanvas.y);\n        vec4 color = currentColor;\n        float opacity = texture2D(u_texture, coord).a * color.a;\n        float kernel3[9];\n        float kernel5[25];\n        vec4 colorSum = vec4(0.0,0.0,0.0,0.0);\n        \n        if(int(v_filterType) == 0){\n            getNormalFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 1){\n            getGaussianBlurFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 2){\n            getUnsharpenFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }\n        else\n        if(int(v_filterType) == 3){\n            getSharpnessFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 4){\n            getSharpenFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 5){\n            getEdgeDetectFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 6){\n            getSobelHorizontalFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 7){\n            getSobelVerticalFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 8){\n            getPrevitHorizontalFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 9){\n            getPrevitVerticalFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 10){\n            getBoxBlurFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 11){\n            getTriangleBlurFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 12){\n            getEmbossFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }\n\n        \n        // colorSum.w = opacity;\n        // colorSum = texture2D(u_texture, coord);\n        vec3 r_normal = normalize(normal);    \n        vec3 forward = u_lightPosition - v_position;\n        vec3 lightLocation = normalize(forward);    \n        gl_FragColor = color * colorSum;//texture2D(u_texture, coord);\n        gl_FragColor.w = opacity;\n        if(enableLight == 1.0){\n            gl_FragColor.rgb *= abs(dot(r_normal,lightLocation));\n        }\n  }\n  "),r=t.createProgram();return t.attachShader(r,e),t.attachShader(r,n),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS)?(t.useProgram(r),r):(console.error("无法初始化Program: "+t.getProgramInfoLog(r)),t.deleteProgram(r),null)}},{key:"init",value:function(){var t=this.gl;this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.BLEND),this.enableDepthTest?t.enable(t.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this[l]=this.createShaderProgram();var e=this[l];this.shaderInformation=this.initShaderInformation(e),this.textureManager=new a.default(801,801,10,4)}},{key:"initShaderInformation",value:function(t){var e=this.gl,n=e.getAttribLocation(t,"u_texCoord");e.enableVertexAttribArray(n);var r=e.getAttribLocation(t,"u_filterType");e.enableVertexAttribArray(r);var a=e.getAttribLocation(t,"a_position");e.enableVertexAttribArray(a);var i=e.getAttribLocation(t,"a_normal");e.enableVertexAttribArray(i);var u=e.getAttribLocation(t,"color");e.enableVertexAttribArray(u);var l=e.getAttribLocation(t,"alpha");e.enableVertexAttribArray(l);for(var o=e.getUniformLocation(t,"perspective_matrix"),s=new Array(this.maxTransformMatrixNum),f=0;f<s.length;f++)s[f]=e.getUniformLocation(t,"transform_matrix_array["+f+"]");var h=e.getUniformLocation(t,"singleCanvas"),c=e.getUniformLocation(t,"u_lightPosition"),d=e.getUniformLocation(t,"enableLight"),y=e.getUniformLocation(t,"u_texture"),v=e.createBuffer(),g=e.createBuffer(),x=e.createBuffer(),b=e.createBuffer(),p=e.createTexture();e.bindTexture(e.TEXTURE_2D,p);var m=new Uint8Array([255,255,255,255]);return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,m),e.bindTexture(e.TEXTURE_2D,null),{vertexAttribute:a,normalAttribute:i,colorAttribute:u,filterTypeAttribute:r,alphaAttribute:l,textureCoordAttribute:n,verticesBuffer:v,fragmentBuffer:x,matrixIndexBuffer:g,indexDataBuffer:b,perspectiveMatrix:o,transformMatrixArray:s,singleCanvas:h,textureLocation:y,blackTexture:p,lightPosition:c,enableLight:d,webgl:e}}},{key:"loadShader",value:function(t,e){var n=this.gl,r=n.createShader(t);return n.shaderSource(r,e),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS)?r:(console.error("着色器编译错误: "+n.getShaderInfoLog(r)),n.deleteShader(r),null)}},{key:"getVertexShaderSource",value:function(t){return" attribute vec3 color;\n     attribute vec4 a_position;\n     attribute vec3 a_normal;\n     attribute float alpha;\n     attribute vec2 u_texCoord;\n     attribute float u_filterType;\n     varying vec3 v_position;\n     varying float v_filterType;\n     attribute float transform_matrix_index;\n     varying vec2 v_texcoord;\n     varying vec4 currentColor;\n     varying vec3 normal;\n     uniform mat4 perspective_matrix;\n     uniform mat4 transform_matrix_array["+t+"];\n     void main() {\n            normal = a_normal;\n            float ft = u_filterType;\n            v_filterType = u_filterType + 0.5;\n            vec4 yuandian = vec4(0,0,0,1);\n            v_texcoord = u_texCoord;\n            vec4 new_position = transform_matrix_array[0] * a_position;\n            v_position = vec3(new_position.xyz);\n            vec4 finalPosition = perspective_matrix* new_position;\n            currentColor = vec4 (color.xyz/255.0,alpha);\n            gl_Position = finalPosition;\n    }"}},{key:"maxTransformMatrixNum",get:function(){return this[o]}}]),t}();e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"undefined"!=typeof wx?wx.createCanvas():document.createElement("canvas")}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var a=Symbol("当前顶点游标位置"),i=Symbol("Float32的typed数组"),u=Symbol("存储顶点数组的buffer"),l=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this[u]=new ArrayBuffer(4*e*2*4),this[i]=new Float32Array(this[u]),this[a]=0}return r(t,[{key:"init",value:function(){this[a]=0}},{key:"setVerticesData",value:function(t,e,n,r,a,u,l){4*(l*=8)>=this.totalByteLength&&this.resize(2*this.totalByteLength),this[i][l]=t,this[i][l+1]=e,this[i][l+2]=n,this[i][l+4]=r,this[i][l+5]=a,this[i][l+6]=u}},{key:"setVerticesCoor",value:function(t,e,n,r){4*(r*=8)>=this.totalByteLength&&this.resize(2*this.totalByteLength),this[i][r]=t,this[i][r+1]=e,this[i][r+2]=n}},{key:"getVerticesData",value:function(t){return t*=8,[this[i][t],this[i][t+1],this[i][t+2],this[i][t+4],this[i][t+5],this[i][t+6]]}},{key:"getVerticesPositionData",value:function(t){return t*=8,[this[i][t],this[i][t+1],this[i][t+2]]}},{key:"getVerticesNormalData",value:function(t){return t*=8,[this[i][t+4],this[i][t+5],this[i][t+6]]}},{key:"addVerticesData",value:function(t,e,n,r,i,u){var l=this[a];this.setVerticesData(t,e,n,r,i,u,l),this[a]++}},{key:"resize",value:function(t){if(!(t<=this.totalByteLength)){var e=this[u];this[u]=new ArrayBuffer(t);var n=new Uint8Array(e);new Uint8Array(this[u]).set(n,0),this[i]=new Float32Array(this[u])}}},{key:"append",value:function(t){var e=this.currentIndex,n=t.totalByteLength;this.resize(n+32*e);var r=new Uint8Array(t.buffer);new Uint8Array(this[u]).set(r,32*e),this[a]+=t.currentIndex}},{key:"singleDataByteLength",get:function(){return 32}},{key:"totalByteLength",get:function(){return this[u].byteLength}},{key:"buffer",get:function(){return this[u]}},{key:"currentIndex",get:function(){return this[a]}}]),t}();e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=(i(n(9)),i(n(0)));function i(t){return t&&t.__esModule?t:{default:t}}var u=16,l=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.buffer=new ArrayBuffer(e*u),this.dv=new DataView(this.buffer),this.currentIndex=0,this.isLittleEndian=a.default.littleEndian}return r(t,[{key:"setFragmentData",value:function(t,e,n,r,a,i,u,l,o){o*=this.singleDataByteLength,this.dv.setUint8(o,t),this.dv.setUint8(o+1,e),this.dv.setUint8(o+2,n),this.dv.setUint8(o+3,l),o+=4,this.dv.setFloat32(o,r,this.isLittleEndian),this.dv.setFloat32(o+4,a,this.isLittleEndian),this.dv.setFloat32(o+8,i,this.isLittleEndian)}},{key:"init",value:function(){this.currentIndex=0}},{key:"resize",value:function(t){if(!(t<=this.totalByteLength)){var e=this.buffer;this.buffer=new ArrayBuffer(t);var n=new Uint8Array(e);new Uint8Array(this.buffer).set(n,0),this.dv=new DataView(this.buffer)}}},{key:"append",value:function(t){var e=this.currentIndex,n=t.totalByteLength;this.resize(n+e*u);var r=new Uint8Array(t.buffer);new Uint8Array(this.buffer).set(r,e*u),this.currentIndex+=t.currentIndex}},{key:"addFragmentData",value:function(t,e,n,r,a,i,u,l){var o=this.currentIndex;o*this.singleDataByteLength>=this.totalByteLength&&this.resize(2*this.totalByteLength),this.setFragmentData(t,e,n,r,a,i,u,l,o),this.currentIndex++}},{key:"totalByteLength",get:function(){return this.buffer.byteLength}},{key:"singleDataByteLength",get:function(){return u}}]),t}();e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(9),u=(r=i)&&r.__esModule?r:{default:r};var l=4,o=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,l))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,u.default),a(e,[{key:"setMatrixIndex",value:function(t,e){this.setData(t,e)}},{key:"addMatrixIndex",value:function(t){var e=this.currentIndex;e*this.singleDataByteLength>=this.totalByteLength&&this.resize(2*this.totalByteLength),this.setMatrixIndex(t,e),this.currentIndex++}},{key:"getMatrixIndex",value:function(t){return this.getData(t)}}]),e}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(28),l=(r=u)&&r.__esModule?r:{default:r};var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pageImages=[],this.fontImageMap={},this.fontMap={},this.loadCount=0}return i(t,[{key:"getBMFont",value:function(t){return this.fontMap[t.trim()]}},{key:"getFontImage",value:function(t,e){return this.fontImageMap[t.trim()][e]}},{key:"loadBMFont",value:function(t,e,n,r){r=r||{},t=t.replace(/\\/g,"/");var i="",u=t.lastIndexOf("/");-1!=u&&(i=t.slice(0,u),i+="/");var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="text";var s=this;o.onload=function(t){if(200==o.status){var u=function(){var t=0,a=o.responseText,u=l.default.parseXML(a),f=u.pages.length;if(null==u){if(r.fail)return r.fail("can not parse xml fnt file,make sure it's xml type"),{v:void 0}}else!function(){var a=u.fontFamily.toLocaleLowerCase().trim();u.isBold&&(a+="_bold"),u.isItalic&&(a+="_italic"),s.fontMap[a]=u,s.fontImageMap[a]={},t=0;for(var l=0;l<u.pages.length;l++){var o=u.pages[l],h=new Image;h.pageId=o.id,h.onload=function(i){var u=i.target;s.fontImageMap[a][u.pageId]=u,e.registerImageData(u,n,!0),++t==f&&r.success&&r.success()},h.onerror=function(t){r.fail&&r.fail("cant load image",t)},h.src=i+o.file}}()}();if("object"===(void 0===u?"undefined":a(u)))return u.v}else r.fail&&r.fail(o.statusText)},o.send(null),r.complete&&r.complete()}},{key:"initDefaultFont",value:function(t,e){}}]),t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return r(t,null,[{key:"parseXML",value:function(t){var e=(new DOMParser).parseFromString(t,"text/xml");if(null==e.getElementsByTagName("font"))return null;var n={fontFamily:null,size:0,isBold:!1,isItalic:!1,charset:null,isUnicode:!1,stretchH:0,isSmooth:!1,aa:0,leftPadding:0,topPadding:0,rightPadding:0,bottomPadding:0,leftSpacing:0,rightSpacing:0,outline:0},r=e.getElementsByTagName("info");if(null==r||0==r.length)return null;var a=r[0];n.fontFamily=a.getAttribute("face"),n.size=Number.parseInt(a.getAttribute("size")),n.isBold=1==Number.parseInt(a.getAttribute("bold")),n.isItalic=1==Number.parseInt(a.getAttribute("italic")),n.charset=a.getAttribute("charset"),n.isUnicode=1==Number.parseInt(a.getAttribute("unicode")),n.stretchH=Number.parseInt(a.getAttribute("stretchH")),n.isSmooth=1==Number.parseInt(a.getAttribute("smooth")),n.aa=Number.parseInt(a.getAttribute("aa"));var i=a.getAttribute("padding").split(",");n.leftPadding=Number.parseInt(i[0]),n.rightPadding=Number.parseInt(i[1]),n.topPadding=Number.parseInt(i[2]),n.bottomPadding=Number.parseInt(i[3]);var u=a.getAttribute("spacing").split(",");n.leftSpacing=Number.parseInt(u[0]),n.rightSpacing=Number.parseInt(u[1]),n.outline=Number.parseInt(a.getAttribute("outline"));var l=e.getElementsByTagName("common");if(null==l||0==l.length)return null;var o=l[0],s={lineHeight:0,base:0,scaleW:0,scaleH:0,pages:0,packed:0,alphaChnl:0,redChnl:0,greenChnl:0,blueChnl:0};s.lineHeight=Number.parseInt(o.getAttribute("lineHeight")),s.base=Number.parseInt(o.getAttribute("base")),s.scaleW=Number.parseInt(o.getAttribute("scaleW")),s.scaleH=Number.parseInt(o.getAttribute("scaleH")),s.pages=Number.parseInt(o.getAttribute("pages")),s.alphaChnl=Number.parseInt(o.getAttribute("alphaChnl")),s.redChnl=Number.parseInt(o.getAttribute("redChnl")),s.greenChnl=Number.parseInt(o.getAttribute("greenChnl")),s.blueChnl=Number.parseInt(o.getAttribute("blueChnl")),n.common=s;var f=e.getElementsByTagName("pages");if(null==f||0==f.length)return null;var h=f[0];n.pages=[];for(var c=0;c<h.childNodes.length;c++){var d=h.childNodes[c];if(d.nodeType==Node.ELEMENT_NODE){var y={};y.file=d.getAttribute("file"),y.id=Number.parseInt(d.getAttribute("id")),n.pages.push(y)}}var v=e.getElementsByTagName("chars");if(null==v||0==v.length)return n;var g=v[0];n.charsCount=Number.parseInt(g.getAttribute("count")),n.chars=[];for(var x=0;x<g.childNodes.length;x++){var b=g.childNodes[x];if(b.nodeType!=Node.TEXT_NODE){var p={};p.id=Number.parseInt(b.getAttribute("id")),p.x=Number.parseInt(b.getAttribute("x")),p.y=Number.parseInt(b.getAttribute("y")),p.width=Number.parseInt(b.getAttribute("width")),p.height=Number.parseInt(b.getAttribute("height")),p.xoffset=Number.parseInt(b.getAttribute("xoffset")),p.yoffset=Number.parseInt(b.getAttribute("yoffset")),p.xadvance=Number.parseInt(b.getAttribute("xadvance")),p.page=Number.parseInt(b.getAttribute("page")),p.chnl=Number.parseInt(b.getAttribute("chnl")),n.chars[p.id]=p}}var m=e.getElementsByTagName("kernings");if(null==m||0==m.length)return n;var k=m[0];n.kerningsCount=Number.parseInt(k.getAttribute("count")),n.kernings=[];for(var M=0;M<k.childNodes.length;M++){var w=k.childNodes[M];if(w.nodeType!=Node.TEXT_NODE){var P={};P.first=Number.parseInt(w.getAttribute("first")),P.second=Number.parseInt(w.getAttribute("second")),P.amount=Number.parseInt(w.getAttribute("amount")),n.kernings.push(P)}}return n.kernings.sort(function(t,e){return t.first-e.first==0?t.second-e.second:t.first-e.first}),n}}]),t}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var a=Symbol("当前顶点游标位置"),i=Symbol("Int16的typed数组"),u=Symbol("存储顶点数组的buffer"),l=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this[u]=new ArrayBuffer(2*e),this[i]=new Uint16Array(this[u]),this[a]=0}return r(t,[{key:"init",value:function(){this[a]=0}},{key:"setIndex",value:function(t,e){2*e>=this.totalByteLength&&this.resize(2*this.totalByteLength),this[i][e]=t}},{key:"getIndex",value:function(t){return this[i][t]}},{key:"addIndex",value:function(t){var e=this[a];this.setIndex(t,e),this[a]++}},{key:"resize",value:function(t){if(!(t<=this.totalByteLength)){var e=this[u];this[u]=new ArrayBuffer(t);var n=new Uint8Array(e);new Uint8Array(this[u]).set(n,0),this[i]=new Uint16Array(this[u])}}},{key:"append",value:function(t){var e=this.currentIndex,n=t.totalByteLength;this.resize(n+2*e);var r=new Uint8Array(t.buffer);new Uint8Array(this.buffer).set(r,2*e),this[a]+=t.currentIndex}},{key:"dataArray",get:function(){return this[i]}},{key:"singleDataByteLength",get:function(){return 2}},{key:"totalByteLength",get:function(){return this[u].byteLength}},{key:"buffer",get:function(){return this[u]}},{key:"currentIndex",get:function(){return this[a]}}]),t}();e.default=l}]).default});